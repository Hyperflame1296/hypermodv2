let translation=window.i18nextify.init({autorun:!1});if("multiplayerpiano.com"===location.host){let e=new URL("https://multiplayerpiano.net/"+location.search);throw localStorage.token&&e.searchParams.set("token",localStorage.token),location.replace(e),new Error("Redirecting to multiplayerpiano.net")}if("multiplayerpiano.net"===location.host){let e=new URL(location.href),t=e.searchParams.get("token");if(t)throw localStorage.token=t,e.searchParams.delete("token"),location.replace(e),new Error("Finalizing redirect.")}$(function(){translation.start(),console.log("%cWelcome to MPP's developer console!","color:blue; font-size:20px;"),console.log("%cCheck out the source code: https://github.com/mppnet/frontend/tree/main/client\nGuide for coders and bot developers: https://docs.google.com/document/d/1OrxwdLD1l1TE8iau6ToETVmnLuLXyGBhA0VfAY1Lf14/edit?usp=sharing","color:gray; font-size:12px;");var e,t=window.location.hash&&window.location.hash.match(/^(?:#.+)*#test(?:#.+)*$/i),i=window.location.hash&&window.location.hash.match(/^(?:#.+)*#seeowncursor(?:#.+)*$/i),n=window.location.hash&&window.location.hash.match(/^(?:#.+)*#midivolumetest(?:#.+)*$/i);Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,i=Number(arguments[1])||0;for((i=i<0?Math.ceil(i):Math.floor(i))<0&&(i+=t);i<t;i++)if(i in this&&this[i]===e)return i;return-1}),window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/30)};let o=new HyperMod;class a{constructor(e,t,i,n){this.x=e,this.y=t,this.w=i,this.h=n,this.x2=e+i,this.y2=t+n}contains(e,t){return e>=this.x&&e<=this.x2&&t>=this.y&&t<=this.y2}}let s={"Notes in C Major":["C","D","E","F","G","A","B","C"],"Notes in D Major":["D","E","G♭","G","A","B","D♭","D"],"Notes in E Major":["E","G♭","A♭","A","B","D♭","E♭","E"],"Notes in F Major":["F","G","A","B♭","C","D","E","F"],"Notes in G Major":["G","A","B","C","D","E","G♭","G"],"Notes in A Major":["A","B","D♭","D","E","G♭","A♭","A"],"Notes in B Major":["B","D♭","E♭","E","G♭","A♭","B♭","B"],"Notes in C# / Db Major":["D♭","E♭","F","G♭","A♭","B♭","C","D♭"],"Notes in D# / Eb Major":["E♭","F","G","A♭","B♭","C","D","E♭"],"Notes in F# / Gb Major":["G♭","A♭","B♭","B","D♭","E♭","F","G♭"],"Notes in G# / Ab Major":["A♭","B♭","C","D♭","E♭","F","G","A♭"],"Notes in A# / Bb Major":["B♭","C","D","E♭","F","G","A","B♭"],"Notes in A Minor":["A","B","C","D","E","F","G","A"],"Notes in A# / Bb Minor":["B♭","C","D♭","E♭","F","G♭","A♭","B♭"],"Notes in B Minor":["B","D♭","D","E","G♭","G","A","B"],"Notes in C Minor":["C","D","E♭","F","G","A♭","B♭","C"],"Notes in C# / Db Minor":["D♭","E♭","E","G♭","A♭","A","B","D♭"],"Notes in D Minor":["D","E","F","G","A","B♭","C","D"],"Notes in D# / Eb Minor":["E♭","F","G♭","A♭","B♭","B","D♭","E♭"],"Notes in E Minor":["E","G♭","G","A","B","C","D","E"],"Notes in F Minor":["F","G","A♭","B♭","C","D♭","E♭","F"],"Notes in F# / Gb Minor":["G♭","A♭","A","B","D♭","D","E","G♭"],"Notes in G Minor":["G","A","B♭","C","D","E♭","F","G"],"Notes in G# / Ab Minor":["A♭","B♭","B","D♭","E♭","E","G♭","A♭"]};class r{init(e){return this.volume=.6,this.sounds={},this.paused=!0,this}load(e,t,i){}play(){}stop(){}setVolume(e){this.volume=e}resume(){this.paused=!1}}class l extends r{constructor(){super(),this.threshold=0,o.lsSettings.removeWorkerTimer||(this.worker=new Worker("threads/timer.js"),this.worker.onmessage=e=>{e.data.args&&(0==e.data.args.action?this.actualPlay(e.data.args.id,e.data.args.vol,e.data.args.time,e.data.args.part_id):this.actualStop(e.data.args.id,e.data.args.time,e.data.args.part_id))})}init(e){return r.prototype.init.call(this),this.context=new AudioContext({latencyHint:"interactive"}),this.masterGain=this.context.createGain(),this.masterGain.connect(this.context.destination),this.masterGain.gain.value=this.volume,this.limiterNode=this.context.createDynamicsCompressor(),this.limiterNode.threshold.value=-10,this.limiterNode.knee.value=0,this.limiterNode.ratio.value=20,this.limiterNode.attack.value=0,this.limiterNode.release.value=.1,this.limiterNode.connect(this.masterGain),this.pianoGain=this.context.createGain(),this.pianoGain.gain.value=.5,this.pianoGain.connect(this.limiterNode),this.synthGain=this.context.createGain(),this.synthGain.gain.value=.5,this.synthGain.connect(this.limiterNode),this.playings={},e&&setTimeout(e,0),this}load(e,t,i){try{fetch(t).then(t=>{if(!t.ok)throw new Error("http error: "+t.status);t.arrayBuffer().then(t=>{this.context.decodeAudioData(t).then(t=>{this.sounds[e]=t,i?.()})})})}catch(e){console.error(`${e}\n${e.stack}`),new Ne({id:"audio-download-error",title:"Problem",text:"For some reason, an audio download failed:"+e.message,target:"#piano",duration:1e4})}}actualPlay(e,t,i,n){if(!this.paused&&this.sounds.hasOwnProperty(e)&&!(this.volume<=0)){var o=this.context.createBufferSource();o.buffer=this.sounds[e];var a=this.context.createGain();if(a.gain.value=t,o.connect(a),a.connect(this.pianoGain),o.start(i),this.playings[e]){let t=this.playings[e];t.gain.gain.setValueAtTime(t.gain.gain.value,i),t.gain.gain.linearRampToValueAtTime(0,i+.2),t.source.stop(i+.21),et&&t.voice&&t.voice.stop(i)}this.playings[e]={source:o,gain:a,part_id:n},et&&(this.playings[e].voice=new ut(e,i))}}play(e,t,i,n){if(this.sounds.hasOwnProperty(e)&&!(this.volume<=0)){var a=this.context.currentTime+i/1e3,s=i-this.threshold;s<=0?this.actualPlay(e,t,a,n):o.lsSettings.removeWorkerTimer||!this.worker?setTimeout(()=>{this.actualPlay(e,t,a,n)},s):this.worker.postMessage({delay:s,args:{action:0,id:e,vol:t,time:a,part_id:n}})}}actualStop(e,t,i){if(!(this.volume<=0)&&this.playings.hasOwnProperty(e)&&this.playings[e]&&this.playings[e].part_id===i){var n=this.playings[e].gain.gain;n.setValueAtTime(n.value,t),n.linearRampToValueAtTime(.1*n.value,t+.16),n.linearRampToValueAtTime(0,t+.4),this.playings[e].source.stop(t+.41),this.playings[e].voice&&this.playings[e].voice.stop(t),this.playings[e]=null}}stop(e,t,i){if(!(this.volume<=0)){var n=this.context.currentTime+t/1e3,a=t-this.threshold;a<=0?this.actualStop(e,n,i):o.lsSettings.removeWorkerTimer||!this.worker?setTimeout(()=>{this.actualStop(e,n,i)},a):this.worker.postMessage({delay:a,args:{action:1,id:e,time:n,part_id:i}})}}setVolume(e){r.prototype.setVolume.call(this,e),this.masterGain.gain.value=this.volume}resume(){this.paused=!1,this.context.resume()}}class c{init(e){return this.piano=e,this.resize(),this}resize(e,t){void 0===e&&(e=$(this.piano.rootElement).width()),void 0===t&&(t=Math.floor(.2*e)),$(this.piano.rootElement).css({height:t+"px",marginTop:Math.floor($(window).height()/2-t/2)+"px"}),this.width=e*window.devicePixelRatio,this.height=t*window.devicePixelRatio}visualize(e,t){}}class d extends c{constructor(){super()}static translateMouseEvent(e){var t=e.target,i=0,n=0;do{if(!t)break;i+=t.offsetLeft,n+=t.offsetTop}while(t=t.offsetParent);return{x:(e.pageX-i)*window.devicePixelRatio,y:(e.pageY-n)*window.devicePixelRatio}}init(e){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),e.rootElement.append(this.canvas),this.piano=e,this.resize();var t=()=>{this.redraw(),requestAnimationFrame(t)};t();var i=null;return $(e.rootElement).mousedown(e=>{oe||e.preventDefault();var t=d.translateMouseEvent(e),n=this.getHit(t.x,t.y);n&&(w(n.key.note,n.v),i=n.key)}),e.rootElement.addEventListener("touchstart",e=>{for(var t in oe||e.preventDefault(),e.changedTouches){var n=d.translateMouseEvent(e.changedTouches[t]),o=this.getHit(n.x,n.y);o&&(w(o.key.note,o.v),i=o.key)}},!1),$(window).mouseup(()=>{i&&b(i.note),i=null}),this}resize(e,t){var i;(void 0===e&&(e=$(this.piano.rootElement).width()),void 0===t&&(t=Math.floor(.2*e)),$(this.piano.rootElement).css({height:t+"px",marginTop:Math.floor($(window).height()/2-t/2)+"px"}),this.width=e*window.devicePixelRatio,this.height=t*window.devicePixelRatio,this.width<104&&(this.width=104),this.height<.2*this.width&&(this.height=Math.floor(.2*this.width)),this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.width=this.width/window.devicePixelRatio+"px",this.canvas.style.height=this.height/window.devicePixelRatio+"px",this.whiteKeyWidth=Math.floor(this.width/52),this.whiteKeyHeight=Math.floor(.9*this.height),this.blackKeyWidth=Math.floor(.75*this.whiteKeyWidth),this.blackKeyHeight=Math.floor(.5*this.height),this.blackKeyOffset=Math.floor(this.whiteKeyWidth-this.blackKeyWidth/2),this.keyMovement=Math.floor(.015*this.whiteKeyHeight),this.whiteBlipWidth=Math.floor(.7*this.whiteKeyWidth),this.whiteBlipHeight=Math.floor(.8*this.whiteBlipWidth),this.whiteBlipX=Math.floor((this.whiteKeyWidth-this.whiteBlipWidth)/2),this.whiteBlipY=Math.floor(this.whiteKeyHeight-1.2*this.whiteBlipHeight),this.blackBlipWidth=Math.floor(.7*this.blackKeyWidth),this.blackBlipHeight=Math.floor(.8*this.blackBlipWidth),this.blackBlipY=Math.floor(this.blackKeyHeight-1.2*this.blackBlipHeight),this.blackBlipX=Math.floor((this.blackKeyWidth-this.blackBlipWidth)/2),this.whiteKeyRender=document.createElement("canvas"),this.whiteKeyRender.width=this.whiteKeyWidth,this.whiteKeyRender.height=this.height+10,(l=this.whiteKeyRender.getContext("2d")).createLinearGradient&&!o.lsSettings.removeKeyGradients)?((i=l.createLinearGradient(0,0,0,this.whiteKeyHeight)).addColorStop(0,"#eee"),i.addColorStop(.75,"#fff"),i.addColorStop(1,"#dad4d4"),l.fillStyle=i):l.fillStyle="#fff";(l.strokeStyle="#000",l.lineJoin="round",l.lineCap="round",l.lineWidth=10,l.strokeRect(l.lineWidth/2,l.lineWidth/2,this.whiteKeyWidth-l.lineWidth,this.whiteKeyHeight-l.lineWidth),l.lineWidth=4,l.fillRect(l.lineWidth/2,l.lineWidth/2,this.whiteKeyWidth-l.lineWidth,this.whiteKeyHeight-l.lineWidth),this.blackKeyRender=document.createElement("canvas"),this.blackKeyRender.width=this.blackKeyWidth+10,this.blackKeyRender.height=this.blackKeyHeight+10,(l=this.blackKeyRender.getContext("2d")).createLinearGradient&&!o.lsSettings.removeKeyGradients)?((i=l.createLinearGradient(0,0,0,this.blackKeyHeight)).addColorStop(0,"#000"),i.addColorStop(1,"#444"),l.fillStyle=i):l.fillStyle="#000";if(l.strokeStyle="#222",l.lineJoin="round",l.lineCap="round",l.lineWidth=8,l.strokeRect(l.lineWidth/2,l.lineWidth/2,this.blackKeyWidth-l.lineWidth,this.blackKeyHeight-l.lineWidth),l.lineWidth=4,l.fillRect(l.lineWidth/2,l.lineWidth/2,this.blackKeyWidth-l.lineWidth,this.blackKeyHeight-l.lineWidth),!o.lsSettings.removeKeyShadows){this.shadowRender=[];for(var n=2*-this.canvas.height,s=0;s<2;s++){var r=document.createElement("canvas");this.shadowRender[s]=r,r.width=this.canvas.width,r.height=this.canvas.height;var l=r.getContext("2d"),c=!!s;for(var d in l.lineJoin="round",l.lineCap="round",l.lineWidth=1,l.shadowColor="rgba(0, 0, 0, 0.5)",l.shadowBlur=3*this.keyMovement,l.shadowOffsetY=-n+this.keyMovement,c?l.shadowOffsetX=this.keyMovement:(l.shadowOffsetX=0,l.shadowOffsetY=-n+this.keyMovement),this.piano.keys){if(this.piano.keys.hasOwnProperty(d))(h=this.piano.keys[d]).sharp==c&&(h.sharp?l.fillRect(this.blackKeyOffset+this.whiteKeyWidth*h.spatial+l.lineWidth/2,n+l.lineWidth/2,this.blackKeyWidth-l.lineWidth,this.blackKeyHeight-l.lineWidth):l.fillRect(this.whiteKeyWidth*h.spatial+l.lineWidth/2,n+l.lineWidth/2,this.whiteKeyWidth-l.lineWidth,this.whiteKeyHeight-l.lineWidth))}}}for(var d in this.piano.keys){var h;if(this.piano.keys.hasOwnProperty(d))(h=this.piano.keys[d]).sharp?h.rect=new a(this.blackKeyOffset+this.whiteKeyWidth*h.spatial,0,this.blackKeyWidth,this.blackKeyHeight):h.rect=new a(this.whiteKeyWidth*h.spatial,0,this.whiteKeyWidth,this.whiteKeyHeight)}}visualize(e,t){let i=o.lsSettings.blipLimit;e.timePlayed=Date.now(),o.lsSettings.enableBlipLimit&&e.blips.length>=i&&e.blips.shift(),e.blips.push({time:e.timePlayed,color:t})}redraw(){var e=Date.now(),t=e-1e3,i=e-100,n=e-1e3;o.lsSettings.removeKeyFade||this.ctx.save(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(var a=0;a<2;a++){o.lsSettings.removeKeyFade||(this.ctx.globalAlpha=1),!o.lsSettings.removeKeyShadows&&this.shadowRender&&this.ctx.drawImage(this.shadowRender[a],0,0);var r=!!a;for(var l in this.piano.keys){if(!this.piano.keys.hasOwnProperty(l))continue;var c=this.piano.keys[l];if(c.sharp!=r)continue;o.lsSettings.removeKeyFade||(c.loaded?c.timeLoaded>t?this.ctx.globalAlpha=(e-c.timeLoaded)/1e3*.8+.2:this.ctx.globalAlpha=1:this.ctx.globalAlpha=.2);var d=0;c.timePlayed>i&&!o.lsSettings.removeNoteBouncing&&(d=Math.floor(this.keyMovement-(e-c.timePlayed)/100*this.keyMovement));var h=Math.floor(c.sharp?this.blackKeyOffset+this.whiteKeyWidth*c.spatial:this.whiteKeyWidth*c.spatial),u=c.sharp?this.blackKeyRender:this.whiteKeyRender;this.ctx.drawImage(u,h,d);var m=c.baseNote[0].toUpperCase();r&&(m+="#"),m+=c.octave+1,Q&&(this.ctx.font=(c.sharp?this.blackKeyWidth:this.whiteKeyWidth)/2+"px Arial",this.ctx.fillStyle=c.sharp?"white":"black",this.ctx.textAlign="center",m.includes("#")&&this.ctx.fillText(m,h+(c.sharp?this.blackKeyWidth:this.whiteKeyWidth)/2,d+(c.sharp?this.blackKeyHeight:this.whiteKeyHeight)-30-this.ctx.lineWidth),m=(m=(m=(m=(m=m.replace("C#","D♭")).replace("D#","E♭")).replace("F#","G♭")).replace("G#","A♭")).replace("A#","B♭"),this.ctx.fillText(m,h+(c.sharp?this.blackKeyWidth:this.whiteKeyWidth)/2,d+(c.sharp?this.blackKeyHeight:this.whiteKeyHeight)-10-this.ctx.lineWidth));let a=s[Z];if(a&&c.loaded){let e=(m=(m=(m=(m=(m=m.replace("C#","D♭")).replace("D#","E♭")).replace("F#","G♭")).replace("G#","A♭")).replace("A#","B♭")).slice(0,-1);if(a.includes(e)){let e=this.ctx.globalAlpha;o.lsSettings.removeKeyFade||(this.ctx.globalAlpha=.3),this.ctx.fillStyle="#0f0",c.sharp?this.ctx.fillRect(h,d,this.blackKeyWidth,this.blackKeyHeight):this.ctx.fillRect(h,d,this.whiteKeyWidth,this.whiteKeyHeight),o.lsSettings.removeKeyFade||(this.ctx.globalAlpha=e)}}if(c.blips.length){var p,f;c.sharp?(h+=this.blackBlipX,d=this.blackBlipY,p=this.blackBlipWidth,f=this.blackBlipHeight):(h+=this.whiteBlipX,d=this.whiteBlipY,p=this.whiteBlipWidth,f=this.whiteBlipHeight);for(var v=0;v<c.blips.length;v++){var g=c.blips[v];if(g.time>n){let t=Math.round(255*(1-(e-g.time)/1e3*1)).toString(16).padStart(2,"0");this.ctx.fillStyle=g.color+t,this.ctx.fillRect(h,d,p,f)}else c.blips.splice(v,1),--v;d-=Math.floor(1.1*f)}}}}o.lsSettings.removeKeyFade||this.ctx.restore()}renderNoteLyrics(){for(var e in this.noteLyrics)if(this.noteLyrics.hasOwnProperty(Xe)){this.noteLyrics[e],x,this.whiteKeyHeight;this.ctx.fillStyle=key.lyric.color;var t=this.ctx.globalAlpha;o.lsSettings.removeKeyFade||(this.ctx.globalAlpha=t-(now-key.lyric.time)/1e3*t),this.ctx.fillRect(x,y,10,10)}}getHit(e,t){for(var i=0;i<2;i++){var n=!i;for(var o in this.piano.keys)if(this.piano.keys.hasOwnProperty(o)){var a=this.piano.keys[o];if(a.sharp==n&&a.rect?.contains(e,t)){var s=t/(a.sharp?this.blackKeyHeight:this.whiteKeyHeight);return s+=.25,(s*=.5)>1&&(s=1),{key:a,v:s}}}}return null}isSupported(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}}class h{constructor(e,t){this.note=e+t,this.baseNote=e,this.octave=t,this.sharp=-1!=e.indexOf("s"),this.loaded=!1,this.timeLoaded=0,this.domElement=null,this.timePlayed=0,this.blips=[],this.lastHitTime=0,this.lastColor="#ffffff"}}var u=new class{constructor(e){this.rootElement=e}init(){window.AudioContext=window.AudioContext||window.webkitAudioContext||void 0,this.audio=(new l).init(),this.renderer=(new d).init(this),this.keys={};var e=0,i=0,n=0,o=[2,1,2,1,1],a=(t,a)=>{var s=new h(t,a);this.keys[s.note]=s,s.sharp?(s.spatial=i,i+=o[n%5],++n):(s.spatial=e,++e)};if(t)a("c",2);else{a("a",-1),a("as",-1),a("b",-1);for(var s="c cs d ds e f fs g gs a as b".split(" "),r=0;r<7;r++)for(var c in s)a(s[c],r);a("c",7)}return window.addEventListener("resize",()=>{this.renderer.resize()}),this}play(t,i,n,a,s){if(o.lsSettings.trackNPS&&o.npsTracker.noteOn(),this.keys.hasOwnProperty(t)&&n){var r=this.keys[t];r.lastHitTime=performance.now()+a,r.lastColor=n.color,r.loaded&&this.audio.volume>0&&this.audio.play(r.note,i,a,n.id),e&&e(r.note,100*i,a,n.id),setTimeout(()=>{if(this.renderer.visualize(r,n.color),!o.lsSettings.removeNameBouncing){var e=$(n.nameDiv);e.addClass("play"),setTimeout(function(){e.removeClass("play")},30)}},a||0)}}stop(t,i,n){if(this.keys.hasOwnProperty(t)){var o=this.keys[t];o.loaded&&this.audio.volume>0&&this.audio.stop(o.note,n,i.id),e&&e(o.note,0,n,i.id)}}}($("#piano")[0]).init(),m=new class{constructor(e){this.initialized=!1,this.keys=e.keys,this.loading={},this.notification,this.packs=[],this.piano=e,this.soundSelection=localStorage.soundSelection??"mppclassic",this.addPack({name:"MPP Classic",keys:Object.keys(this.piano.keys),ext:".mp3",url:"assets/sounds/mppclassic/"})}addPack(e,t){this.loading[e.url||e]=!0;let i=i=>{if(void 0!==this.packs.find(e=>i.name===e.name))return console.warn(`Woah woah woah, pack '${e.name??e}' already exists!`);"/"!=i.url.substr(i.url.length-1)&&(i.url=i.url+"/");let n=document.createElement("li");n.classList="pack",n.innerText=i.name+" ("+i.keys.length+" keys)",n.onclick=()=>{this.loadPack(i.name),this.notification.close()},i.html=n,this.packs.push(i),this.packs.sort(),t&&this.loadPack(i.name),delete this.loading[i.url]};if("string"==typeof e){let t=!0;e.match(/^(http|https):\/\//i)&&(t=!1),$.getJSON(e+"/info.json").done(t=>{t.url=e,i(t)})}else i(e)}addPacks(e){for(var t=0;e.length>t;t++)this.addPack(e[t])}init(){if(this.initialized)return console.warn("Sound selector already initialized!");$("#sound-btn").on("click",()=>{if(null!=document.getElementById("Notification-Sound-Selector"))return this.notification.close();for(var e=document.createElement("ul"),t=0;this.packs.length>t;t++){var i=this.packs[t];i.name==this.soundSelection?i.html.classList="pack enabled":i.html.classList="pack",i.html.setAttribute("translated",""),e.appendChild(i.html)}this.notification=new Ne({title:"Sound Selector",html:e,id:"Sound-Selector",duration:-1,target:"#sound-btn"})}),this.initialized=!0,this.loadPack(this.soundSelection,!0)}loadPack(e,t){if(e=this.packs.find(t=>e===t.name)){if("string"==typeof e)return console.warn("Sound pack does not exist! Loading default pack..."),this.loadPack("MPP Classic");if(e.name!==this.soundSelection||t){if(e.keys.length!=Object.keys(this.piano.keys).length){this.piano.keys={};for(var i=0;e.keys.length>i;i++)this.piano.keys[e.keys[i]]=this.keys[e.keys[i]];this.piano.renderer.resize()}for(var i in this.piano.keys)this.piano.keys.hasOwnProperty(i)&&(()=>{var t=this.piano.keys[i];t.loaded=!1;let n=!0;e.url.match(/^(http|https):\/\//i),this.piano.audio.load(t.note,e.url+t.note+e.ext,function(){t.loaded=!0,t.timeLoaded=Date.now()})})();localStorage&&(localStorage.soundSelection=e.name),this.soundSelection=e.name}}}removePack(e){for(var t=0;this.packs.length>t;t++){var i=this.packs[t];if(i.name==e){this.packs.splice(t,1),i.name==this.soundSelection&&this.loadPack(this.packs[0].name);break}}console.warn("Sound pack not found!")}}(u);m.addPacks(["assets/sounds/Emotional/","assets/sounds/Emotional_2.0/","assets/sounds/GreatAndSoftPiano/","assets/sounds/HardAndToughPiano/","assets/sounds/HardPiano/","assets/sounds/Harp/","assets/sounds/Harpsicord/","assets/sounds/LoudAndProudPiano/","assets/sounds/MLG/","assets/sounds/Music_Box/","assets/sounds/NewPiano/","assets/sounds/Orchestra/","assets/sounds/Piano2/","assets/sounds/PianoSounds/","assets/sounds/Rhodes_MK1/","assets/sounds/SoftPiano/","assets/sounds/Steinway_Grand/","assets/sounds/Untitled/","assets/sounds/Vintage_Upright/","assets/sounds/Vintage_Upright_Soft/"]),m.init();var p=!1,f=!1,v={},g={};function w(e,t){!M.preventsPlaying()&&Te.spend(1)&&(v[e]=!0,g[e]=!0,u.play(e,void 0!==t?t:.5,M.getOwnParticipant(),0),M.startNote(e,t))}function b(e){v[e]&&(v[e]=!1,!p&&!f||et?Te.spend(1)&&(u.stop(e,M.getOwnParticipant(),0),M.stopNote(e),g[e]=!1):g[e]=!0)}function k(){f=!0}function C(){if(f=!1,!p)for(var e in g)g.hasOwnProperty(e)&&g[e]&&!v[e]&&(g[e]=!1,Te.spend(1)&&(u.stop(e,M.getOwnParticipant(),0),M.stopNote(e)))}function S(e,t=window.location.href){e=e.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}if("multiplayerpiano.com"===window.location.hostname){$("#chat-input")[0].autocomplete="off";let e=document.createElement("a");e.href="https://docs.google.com/document/d/1wQvGwQdaI8PuEjSWxKDDThVIoAlCYIxQOyfyi4o6HcM/edit?usp=sharing",e.title="Multiplayer Piano Rules",e.target="_blank";let t=document.createElement("button");t.style="height: 24px; font-size: 12px; background: #111; border: 1px solid #444; padding: 5px; cursor: pointer; line-height: 12px; border-radius: 2px; -webkit-border-radius: 2px; -moz-border-radius: 2px; overflow: hidden; white-space: nowrap; color: #fff; position: absolute; right: 6px; top: 0px; z-index: 20001;",t.innerText="Rules",e.appendChild(t),document.body.appendChild(e)}function E(){let e=decodeURIComponent(window.location.search).replace("?c=","");return"/"==e.substr(0,1)&&(e=e.substr(1)),e||(e=S("c")),e||(e="lobby"),e}var D,P=E();if("discord"===S("callback")){var T=S("code");T&&(D={type:"discord",code:T}),history.pushState({name:"lobby"},"Piano > lobby","/"),P="lobby"}var M=new Client("wss://mppclone.com");D&&M.setLoginInfo(D),M.setChannel(P),M.on("disconnect",function(e){});var A,L,B,_,N=!0,O=!1,I=!1;window.addEventListener("focus",function(e){N=!0,O=!1,I=!1;var t=Object.keys(MPP.client.ppl).length;document.title=t>0?"Piano ("+t+")":"Multiplayer Piano"}),window.addEventListener("blur",function(e){N=!1}),M.on("status",function(e){$("#status").text(e)}),M.on("count",function(e){if(e>0){if($("#status").html('<span class="number" translated>'+e+"</span> "+window.i18nextify.i18next.t("people are playing",{count:e})),!N&&(O||I))return;document.title="Piano ("+e+")"}else document.title="Multiplayer Piano"}),function(){let e=!1;M.on("hi",function(t){if(!e){e=!0,t.motd||(t.motd="This site makes a lot of sound! You may want to adjust the volume before continuing."),document.getElementById("motd-text").innerHTML=t.motd,We("#motd"),$(document).off("keydown",Re);var i=function(e){((e.path||e.composedPath&&e.composedPath()).includes(document.getElementById("motd"))||e.target===document.getElementById("motd"))&&He(),document.removeEventListener("click",i),u.audio.resume()};document.addEventListener("click",i),M.permissions.clearChat&&$("#clearchat-btn").show(),M.permissions.vanish?$("#vanish-btn").show():$("#vanish-btn").hide()}})}(),function(){function e(e){var i;Boolean(e.nameDiv)?(i=e.nameDiv,$(i).empty()):((i=document.createElement("div")).addEventListener("mousedown",e=>A(e,i)),i.addEventListener("touchstart",e=>A(e,i)),i.style.display="none",$(i).fadeIn(2e3),i.id="namediv-"+e._id,i.className="name",i.participantId=e.id,$("#names")[0].appendChild(i),e.nameDiv=i),i.style.backgroundColor=e.color||"#777";var o="object"==typeof e.tag?e.tag.text:e.tag;"BOT"===o&&(i.title="This is an authorized bot."),"MOD"===o&&(i.title="This user is an official moderator of the site."),"ADMIN"===o&&(i.title="This user is an official administrator of the site."),"OWNER"===o&&(i.title="This user is the owner of the site."),"MEDIA"===o&&(i.title="This is a well known person on Twitch, Youtube, or another platform."),"DEV"===o&&(i.title="This user has contributed code to the site."),t(e);var a=!1;if(e.vanished){a=!0;var s=document.createElement("div");s.className="nametag",s.textContent="VANISH",s.style.backgroundColor="#00ffcc",s.id="namevanish-"+e._id,e.nameDiv.appendChild(s)}if(e.tag){a=!0;var r=document.createElement("div");r.className="nametag",r.textContent=o||"",r.style.backgroundColor=n(e.tag),r.id="nametag-"+e._id,e.nameDiv.appendChild(r)}if(e.afk){var l=document.createElement("div");l.className="nametag",l.textContent="AFK",l.style.backgroundColor="#00000040",l.style["margin-left"]="5px",l.style["margin-right"]="0px",l.style.float="right",l.id="afktag-"+e._id,e.nameDiv.appendChild(l)}var c=document.createElement("div");c.className="nametext",c.textContent=e.name||"",c.id="nametext-"+e._id,a&&(c.style.float="left"),e.nameDiv.appendChild(c),e.nameDiv.setAttribute("translated","");var d=$("#names .name");d.sort(function(e,t){return e.id>t.id?1:e.id<t.id?-1:0}),$("#names").html(d)}function t(e){e.id===M.participantId?$(e.nameDiv).addClass("me"):$(e.nameDiv).removeClass("me"),M.channel.crown&&M.channel.crown.participantId===e.id?($(e.nameDiv).addClass("owner"),$(e.cursorDiv).addClass("owner")):($(e.nameDiv).removeClass("owner"),$(e.cursorDiv).removeClass("owner")),-1!==G.indexOf(e._id)?$(e.nameDiv).addClass("muted-notes"):$(e.nameDiv).removeClass("muted-notes"),-1!==F.indexOf(e._id)?$(e.nameDiv).addClass("muted-chat"):$(e.nameDiv).removeClass("muted-chat")}function n(e){return"object"==typeof e?e.color:"BOT"===e?"#55f":"OWNER"===e?"#a00":"ADMIN"===e?"#f55":"MOD"===e?"#0a0":"MEDIA"===e?"#f5f":"#777"}function o(e){let t=M.ppl[e.id];ce(t)||t&&t.cursorDiv&&(X?t.cursorDiv.style.transform="translate3d("+e.x+"vw, "+e.y+"vh, 0)":(t.cursorDiv.style.left=e.x+"%",t.cursorDiv.style.top=e.y+"%"))}M.on("participant added",function(t){if(!ce(t)){t.displayX=150,t.displayY=50;var o="object"==typeof t.tag?t.tag.text:t.tag;if(e(t),M.participantId===t.id&&!i||ee.includes(t.id)||te)t.cursorDiv=void 0;else{var a;if((a=document.createElement("div")).className="cursor",a.style.display="none",t.cursorDiv=$("#cursors")[0].appendChild(a),$(t.cursorDiv).fadeIn(2e3),(a=document.createElement("div")).className="name",a.style.backgroundColor=t.color||"#777",t.tag){var s=document.createElement("span");s.className="curtag",s.textContent=o||"",s.style.backgroundColor=n(t.tag),s.id="nametag-"+t._id,a.appendChild(s)}var r=document.createElement("span");r.className="nametext",r.textContent=t.name||"",a.setAttribute("translated",""),a.appendChild(r),t.cursorDiv.appendChild(a)}}}),M.on("participant removed",function(e){if(!ce(e)){var t=$(e.nameDiv),i=$(e.cursorDiv);i.fadeOut(2e3),t.fadeOut(2e3,function(){t.remove(),i.remove(),e.nameDiv=void 0,e.cursorDiv=void 0})}}),M.on("participant update",function(t){if(!ce(t)){var i=t.name||"",n=t.color||"#777";e(t),$(t.cursorDiv).find(".name .nametext").text(i),$(t.cursorDiv).find(".name").css("background-color",n)}}),M.on("ch",function(e){for(var i in M.ppl){if(M.ppl.hasOwnProperty(i))t(M.ppl[i])}}),M.on("participant added",function(e){ce(e)||t(e)}),M.on("m",o),M.on("participant added",o)}(),B=$('<div id="crown"></div>').appendTo(document.body).hide(),_=$("<span></span>").appendTo(B),B.click(function(){M.sendArray([{m:"chown",id:M.participantId}])}),M.on("ch",function(e){if(e.ch.crown){var t=e.ch.crown;if(t.participantId&&M.ppl[t.participantId])B.hide();else{var i=t.time+2e3-M.serverTimeOffset,n=t.time+15e3-M.serverTimeOffset;_.text(""),B.show(),i-Date.now()<=0?B.css({left:t.endPos.x+"%",top:t.endPos.y+"%"}):(B.css({left:t.startPos.x+"%",top:t.startPos.y+"%"}),B.addClass("spin"),B.animate({left:t.endPos.x+"%",top:t.endPos.y+"%"},2e3,"linear",function(){B.removeClass("spin")})),clearInterval(L),L=setInterval(function(){var e=Date.now();if(e>=i){var t=n-e;t>0?_.text(Math.ceil(t/1e3)+"s"):(_.text(""),clearInterval(L))}},1e3)}}else B.hide()}),M.on("disconnect",function(){B.fadeOut(2e3)}),M.on("n",function(e){var t=e.t-M.serverTimeOffset+1e3-Date.now(),i=M.findParticipantById(e.p);if(-1===G.indexOf(i._id))for(var n=0;n<e.n.length;n++){var o=e.n[n],a=t+(o.d||0);if(a<0)a=0;else if(a>1e4)continue;if(o.s)u.stop(o.n,i,a);else{var s=void 0!==o.v?parseFloat(o.v):.5;s?s<0?s=0:s>1&&(s=1):s=0,u.play(o.n,s,i,a),et&&u.stop(o.n,i,a+1e3)}}});var K=0,R=-10,W=0,H=-10;setInterval(function(){if(Math.abs(K-R)>.1||Math.abs(W-H)>.1){R=K,H=W,M.sendArray([{m:"m",x:K,y:W}]),i&&M.emit("m",{m:"m",id:M.participantId,x:K,y:W});var e=M.getOwnParticipant();e&&(e.x=K,e.y=W)}},50),$(document).mousemove(function(e){K=(e.pageX/$(window).width()*100).toFixed(2),W=(e.pageY/$(window).height()*100).toFixed(2)}),M.on("ch",function(e){M.isOwner()||M.permissions.chsetAnywhere?$("#room-settings-btn").show():$("#room-settings-btn").hide(),M.channel.settings.lobby||!M.permissions.chownAnywhere&&M.channel.settings.owner_id!==M.user._id?$("#getcrown-btn").hide():$("#getcrown-btn").show()}),$("#room-settings-btn").click(function(e){if(M.channel&&(M.isOwner()||M.permissions.chsetAnywhere)){var t=M.channel.settings;We("#room-settings"),setTimeout(function(){$("#room-settings .checkbox[name=visible]").prop("checked",t.visible),$("#room-settings .checkbox[name=chat]").prop("checked",t.chat),$("#room-settings .checkbox[name=crownsolo]").prop("checked",t.crownsolo),$("#room-settings .checkbox[name=nocussing]").prop("checked",t["no cussing"]),$("#room-settings input[name=color]").val(t.color),$("#room-settings input[name=color2]").val(t.color2),$("#room-settings .checkbox[name=noindex]").prop("checked",t.noindex),$("#room-settings .checkbox[name=allowBots]").prop("checked",t.allowBots),$("#room-settings input[name=limit]").val(t.limit)},100)}}),$("#room-settings .submit").click(function(){var e={visible:$("#room-settings .checkbox[name=visible]").is(":checked"),chat:$("#room-settings .checkbox[name=chat]").is(":checked"),crownsolo:$("#room-settings .checkbox[name=crownsolo]").is(":checked"),"no cussing":$("#room-settings .checkbox[name=nocussing]").is(":checked"),noindex:$("#room-settings .checkbox[name=noindex]").is(":checked"),allowBots:$("#room-settings .checkbox[name=allowBots]").is(":checked"),color:$("#room-settings input[name=color]").val(),color2:$("#room-settings input[name=color2]").val(),limit:$("#room-settings input[name=limit]").val()};M.setChannelSettings(e),He()}),$("#room-settings .drop-crown").click(function(){He(),confirm("This will drop the crown...!")&&M.sendArray([{m:"chown"}])}),$("#clearchat-btn").click(function(e){confirm("Are you sure you want to clear chat?")&&M.sendArray([{m:"clearchat"}])}),$("#getcrown-btn").click(function(e){M.sendArray([{m:"chown",id:MPP.client.getOwnParticipant().id}])}),$("#vanish-btn").click(function(e){M.sendArray([{m:"v",vanish:!M.getOwnParticipant().vanished}])}),M.on("participant update",e=>{e._id===M.getOwnParticipant()._id&&(e.vanished?$("#vanish-btn").text("Unvanish"):$("#vanish-btn").text("Vanish"))}),M.on("participant added",e=>{e._id===M.getOwnParticipant()._id&&(e.vanished?$("#vanish-btn").text("Unvanish"):$("#vanish-btn").text("Vanish"))}),M.on("notification",function(e){new Ne(e)}),M.on("ch",function(e){var t=e.ch._id.toLowerCase();"spin"===t||"/spin"===t.substr(-5)?$("#piano").addClass("spin"):$("#piano").removeClass("spin")}),M.on("ch",function(e){let t="",i=!1;e.ch.settings.crownsolo&&(i=!0,t+='<p>This room is set to "only the owner can play."</p>'),e.ch.settings["no cussing"]&&(i=!0,t+='<p>This room is set to "no cussing."</p>');let n=$("#room-notice");i?(n.html(t),n.is(":hidden")&&n.fadeIn(1e3)):n.is(":visible")&&n.fadeOut(1e3)}),M.on("disconnect",function(){$("#room-notice").fadeOut(1e3)});var G=(localStorage.pianoMutes?localStorage.pianoMutes:"").split(",").filter(e=>e),F=(localStorage.chatMutes?localStorage.chatMutes:"").split(",").filter(e=>e),j="true"==localStorage.showIdsInChat,z="true"==localStorage.showTimestampsInChat,V="true"==localStorage.noChatColors,U="true"==localStorage.noBackgroundColor,Y=!localStorage.outputOwnNotes||"true"==localStorage.outputOwnNotes,q="true"==localStorage.virtualPianoLayout,X="true"==localStorage.smoothCursor,J="true"==localStorage.showChatTooltips,Q="true"==localStorage.showPianoNotes,Z=localStorage.highlightScaleNotes,ee=(localStorage.cursorHides?localStorage.cursorHides:"").split(",").filter(e=>e),te="true"==localStorage.hideAllCursors,ie="true"==localStorage.hidePiano,ne="true"==localStorage.hideChat,oe="true"==localStorage.noPreventDefault,ae="true"==localStorage.hideBotUsers,se=11===(new Date).getMonth()&&"false"!==localStorage.snowflakes,re=!localStorage.disableMIDIDrumChannel||"true"==localStorage.disableMIDIDrumChannel;function le(){let e=document.querySelector(".snowflakes");e.style.visibility=se?"visible":"hidden"}function ce(e){return!!ae&&(e?!(!e.tag||"BOT"!==e.tag.text):void 0)}le(),ie?$("#piano").hide():$("#piano").show(),ne?$("#chat").hide():$("#chat").show(),X?$("#cursors").attr("smooth-cursors",""):$("#cursors").removeAttr("smooth-cursors"),function(){new Color("#000000"),new Color("#000000");function e(e,t){var i=new Color(e),n=new Color(t||e);t||n.add(-64,-64,-64);var o=document.getElementById("bottom");document.body.style.setProperty("--color",i.toHexa()),document.body.style.setProperty("--color2",n.toHexa()),o.style.setProperty("--color",i.toHexa()),o.style.setProperty("--color2",n.toHexa())}function t(){e("#220022","#000022")}window.setBackgroundColor=e,window.setBackgroundColorToDefault=t,t(),M.on("ch",function(i){U?t():i.ch.settings&&(i.ch.settings.color?e(i.ch.settings.color,i.ch.settings.color2):t())})}();var de=document.getElementById("volume-slider");de.value=u.audio.volume,$("#volume-label").text("Volume: "+Math.floor(100*u.audio.volume)+"%"),de.addEventListener("input",function(e){var t=+de.value;u.audio.setVolume(t),window.localStorage&&(localStorage.volume=t),$("#volume-label").text("Volume: "+Math.floor(100*t)+"%")});var he=function(e,t){this.note=e,this.octave=t||0},ue=function(e,t){return{note:new he(e,t),held:!1}},me={MPP:{65:ue("gs"),90:ue("a"),83:ue("as"),88:ue("b"),67:ue("c",1),70:ue("cs",1),86:ue("d",1),71:ue("ds",1),66:ue("e",1),78:ue("f",1),74:ue("fs",1),77:ue("g",1),75:ue("gs",1),188:ue("a",1),76:ue("as",1),190:ue("b",1),191:ue("c",2),222:ue("cs",2),49:ue("gs",1),81:ue("a",1),50:ue("as",1),87:ue("b",1),69:ue("c",2),52:ue("cs",2),82:ue("d",2),53:ue("ds",2),84:ue("e",2),89:ue("f",2),55:ue("fs",2),85:ue("g",2),56:ue("gs",2),73:ue("a",2),57:ue("as",2),79:ue("b",2),80:ue("c",3),189:ue("cs",3),173:ue("cs",3),219:ue("d",3),187:ue("ds",3),61:ue("ds",3),221:ue("e",3)},VP:{112:ue("c",-1),113:ue("d",-1),114:ue("e",-1),115:ue("f",-1),116:ue("g",-1),117:ue("a",-1),118:ue("b",-1),49:ue("c"),50:ue("d"),51:ue("e"),52:ue("f"),53:ue("g"),54:ue("a"),55:ue("b"),56:ue("c",1),57:ue("d",1),48:ue("e",1),81:ue("f",1),87:ue("g",1),69:ue("a",1),82:ue("b",1),84:ue("c",2),89:ue("d",2),85:ue("e",2),73:ue("f",2),79:ue("g",2),80:ue("a",2),65:ue("b",2),83:ue("c",3),68:ue("d",3),70:ue("e",3),71:ue("f",3),72:ue("g",3),74:ue("a",3),75:ue("b",3),76:ue("c",4),90:ue("d",4),88:ue("e",4),67:ue("f",4),86:ue("g",4),66:ue("a",4),78:ue("b",4),77:ue("c",5)}},pe=q?me.VP:me.MPP,fe=!1,ve=0;function ge(e){if(!e.target.type){var t=parseInt(e.keyCode);if(void 0!==pe[t]){var i=pe[t];if(!i.held){i.held=!0;var n=i.note,o=1+n.octave;q||(e.shiftKey?++o:fe||e.ctrlKey?--o:e.altKey&&(o+=2)),n=n.note+o;var a=Object.keys(u.keys).indexOf(n);if(void 0===(n=q&&e.shiftKey?Object.keys(u.keys)[a+ve+1]:Object.keys(u.keys)[a+ve]))return;w(n,Pe())}return 3==++Ie&&(Ke=!0,window.gKnowsYouCanUseKeyboardTimeout&&clearTimeout(gKnowsYouCanUseKeyboardTimeout),localStorage&&(localStorage.knowsYouCanUseKeyboard=!0),window.gKnowsYouCanUseKeyboardNotification&&gKnowsYouCanUseKeyboardNotification.close()),oe||e.preventDefault(),e.stopPropagation(),!1}20==t?(fe=!0,oe||e.preventDefault()):32===t?(k(),oe||e.preventDefault()):38===t&&ve<=100?(ve+=12,we()):40===t&&ve>=-100?(ve-=12,we()):39===t&&ve<100?(ve++,we()):37===t&&ve>-100?(ve--,we()):9==t?oe||e.preventDefault():8==t&&(p=!p,oe||e.preventDefault())}}function we(){new Ne({title:"Transposing",html:"Transpose level: "+ve,target:"#midi-btn",duration:1500})}function ye(e){if(!e.target.type){var t=parseInt(e.keyCode);if(void 0!==pe[t]){var i=pe[t];if(i.held){i.held=!1;var n=i.note,o=1+n.octave;q||(e.shiftKey?++o:fe||e.ctrlKey?--o:e.altKey&&(o+=2)),n=n.note+o;var a=Object.keys(u.keys).indexOf(n);if(void 0===(n=q&&e.shiftKey?Object.keys(u.keys)[a+ve+1]:Object.keys(u.keys)[a+ve]))return;b(n)}return oe||e.preventDefault(),e.stopPropagation(),!1}20==t?(fe=!1,oe||e.preventDefault()):32===t&&(C(),oe||e.preventDefault())}}function be(e){if(!e.target.type)return oe||e.preventDefault(),e.stopPropagation(),27==e.keyCode||e.keyCode,!1}var xe=function(e){$e()},ke=!1;function $e(){ke||(ke=!0,$("#piano").off("mousedown",xe),$("#piano").off("touchstart",xe),$(document).on("keydown",ge),$(document).on("keyup",ye),$(window).on("keypress",be))}function Ce(){ke&&(ke=!1,$(document).off("keydown",ge),$(document).off("keyup",ye),$(window).off("keypress",be),$("#piano").on("mousedown",xe),$("#piano").on("touchstart",xe))}$e();var Se,Ee,De,Pe=function(){return.1+W/100*.6},Te=(Se=0,Ee=$("#quota .value"),new NoteQuota(function(e){var t=e/this.max*100;t<=Se?Ee.stop(!0,!0).css("width",t.toFixed(0)+"%"):Ee.stop(!0,!0).animate({width:t.toFixed(0)+"%"},2e3,"linear"),Se=t}));o.lsSettings.forceInfNoteQuota?(M.on("nq",function(e){Te.setParams(NoteQuota.PARAMS_INFINITE)}),M.on("disconnect",function(){Te.setParams(NoteQuota.PARAMS_INFINITE)})):(M.on("nq",function(e){Te.setParams(e)}),M.on("disconnect",function(){Te.setParams(NoteQuota.PARAMS_OFFLINE)}));var Me,Ae=!1,Le="true"===localStorage.knowsHowToDm;M.on("participant removed",e=>{Ae&&e._id===De._id&&(ze.endDM(),ze.endDM())});var Be,_e=!1;M.on("participant removed",e=>{_e&&e._id===Me._id&&MPP.chat.cancelReply()}),function(){A=function(e,t){var n=t,o=$(n);if(o&&o.hasClass("name")){o.addClass("play");var a=n.participantId;if(a==M.participantId)We("#rename","input[name=name]"),setTimeout(function(){$("#rename input[name=name]").val(M.ppl[M.participantId].name),$("#rename input[name=color]").val(M.ppl[M.participantId].color)},100);else if(a){var s=M.ppl[a]||null;s&&(i(s),e.stopPropagation())}}};var e=function(e){$("#names .name").removeClass("play")};document.body.addEventListener("mouseup",e),document.body.addEventListener("touchend",e);var t=function(){$(".participant-menu").remove(),$(".participantSpotlight").hide(),document.removeEventListener("mousedown",t),document.removeEventListener("touchstart",t)},i=function(e){if(e){t(),document.addEventListener("mousedown",t),document.addEventListener("touchstart",t),$("#"+e.id).find(".enemySpotlight").show();var i=$('<div class="participant-menu"></div>');$("body").append(i);var n=$(e.nameDiv),o=n.position();i.css({top:o.top+n.height()+15,left:o.left+6,background:e.color||"black"}),i.on("mousedown touchstart",function(e){e.stopPropagation();var n=$(e.target);n.hasClass("menu-item")&&(n.addClass("clicked"),i.fadeOut(200,function(){t()}))}),$('<div class="info"></div>').appendTo(i).text(e._id).on("mousedown touchstart",t=>{navigator.clipboard.writeText(e._id),t.target.innerText="Copied!",setTimeout(()=>{t.target.innerText=e._id},2500)}),-1==G.indexOf(e._id)?$(`<div class="menu-item">${window.i18nextify.i18next.t("Mute Notes")}</div>`).appendTo(i).on("mousedown touchstart",function(t){G.push(e._id),localStorage&&(localStorage.pianoMutes=G.join(",")),$(e.nameDiv).addClass("muted-notes")}):$(`<div class="menu-item">${window.i18nextify.i18next.t("Unmute Notes")}</div>`).appendTo(i).on("mousedown touchstart",function(t){for(var i;-1!=(i=G.indexOf(e._id));)G.splice(i,1);localStorage&&(localStorage.pianoMutes=G.join(",")),$(e.nameDiv).removeClass("muted-notes")}),-1==F.indexOf(e._id)?$(`<div class="menu-item">${window.i18nextify.i18next.t("Mute Chat")}</div>`).appendTo(i).on("mousedown touchstart",function(t){F.push(e._id),localStorage&&(localStorage.chatMutes=F.join(",")),$(e.nameDiv).addClass("muted-chat")}):$(`<div class="menu-item">${window.i18nextify.i18next.t("Unmute Chat")}</div>`).appendTo(i).on("mousedown touchstart",function(t){for(var i;-1!=(i=F.indexOf(e._id));)F.splice(i,1);localStorage&&(localStorage.chatMutes=F.join(",")),$(e.nameDiv).removeClass("muted-chat")}),G.indexOf(e._id)>=0&&F.indexOf(e._id)>=0||$(`<div class="menu-item">${window.i18nextify.i18next.t("Mute Completely")}</div>`).appendTo(i).on("mousedown touchstart",function(t){G.push(e._id),localStorage&&(localStorage.pianoMutes=G.join(",")),F.push(e._id),localStorage&&(localStorage.chatMutes=F.join(",")),$(e.nameDiv).addClass("muted-notes"),$(e.nameDiv).addClass("muted-chat")}),(G.indexOf(e._id)>=0||F.indexOf(e._id)>=0)&&$(`<div class="menu-item">${window.i18nextify.i18next.t("Unmute Completely")}</div>`).appendTo(i).on("mousedown touchstart",function(t){for(var i;-1!=(i=G.indexOf(e._id));)G.splice(i,1);for(;-1!=(i=F.indexOf(e._id));)F.splice(i,1);localStorage&&(localStorage.pianoMutes=G.join(",")),localStorage&&(localStorage.chatMutes=F.join(",")),$(e.nameDiv).removeClass("muted-notes"),$(e.nameDiv).removeClass("muted-chat")}),Ae&&De._id===e._id?$(`<div class="menu-item">${window.i18nextify.i18next.t("End Direct Message")}</div>`).appendTo(i).on("mousedown touchstart",function(e){ze.endDM()}):$(`<div class="menu-item">${window.i18nextify.i18next.t("Direct Message")}</div>`).appendTo(i).on("mousedown touchstart",function(t){Le||(localStorage.knowsHowToDm=!0,Le=!0,new Ne({target:"#piano",duration:2e4,title:window.i18nextify.i18next.t("How to DM"),text:window.i18nextify.i18next.t("After you click the button to direct message someone, future chat messages will be sent to them instead of to everyone. To go back to talking in public chat, send a blank chat message, or click the button again.")})),ze.startDM(e)}),-1==ee.indexOf(e._id)?$(`<div class="menu-item">${window.i18nextify.i18next.t("Hide Cursor")}</div>`).appendTo(i).on("mousedown touchstart",function(t){ee.push(e._id),localStorage&&(localStorage.cursorHides=ee.join(",")),$(e.cursorDiv).hide()}):$(`<div class="menu-item">${window.i18nextify.i18next.t("Show Cursor")}</div>`).appendTo(i).on("mousedown touchstart",function(t){for(var i;-1!=(i=ee.indexOf(e._id));)ee.splice(i,1);localStorage&&(localStorage.cursorHides=ee.join(",")),$(e.cursorDiv).show()}),$(`<div class="menu-item">${window.i18nextify.i18next.t("Mention")}</div>`).appendTo(i).on("mousedown touchstart",function(t){$("#chat-input")[0].value+="@"+e.id+" ",setTimeout(()=>{$("#chat-input").focus()},1)}),(M.isOwner()||M.permissions.chownAnywhere)&&(M.channel.settings.lobby||$(`<div class="menu-item give-crown">${window.i18nextify.i18next.t("Give Crown")}</div>`).appendTo(i).on("mousedown touchstart",function(t){confirm("Give room ownership to "+e.name+"?")&&M.sendArray([{m:"chown",id:e.id}])}),$(`<div class="menu-item kickban">${window.i18nextify.i18next.t("Kickban")}</div>`).appendTo(i).on("mousedown touchstart",function(t){var i=prompt("How many minutes? (0-300)","30");if(null!==i){var n=60*(i=parseFloat(i)||0)*1e3;M.sendArray([{m:"kickban",_id:e._id,ms:n}])}})),M.permissions.siteBan&&$(`<div class="menu-item site-ban">${window.i18nextify.i18next.t("Site Ban")}</div>`).appendTo(i).on("mousedown touchstart",function(t){We("#siteban"),setTimeout(function(){$("#siteban input[name=id]").val(e._id),$("#siteban input[name=reasonText]").val("Discrimination against others"),$("#siteban input[name=reasonText]").attr("disabled",!0),$("#siteban select[name=reasonSelect]").val("Discrimination against others"),$("#siteban input[name=durationNumber]").val(5),$("#siteban input[name=durationNumber]").attr("disabled",!1),$("#siteban select[name=durationUnit]").val("hours"),$("#siteban textarea[name=note]").val(""),$("#siteban p[name=errorText]").text(""),M.permissions.siteBanAnyReason?$("#siteban select[name=reasonSelect] option[value=custom]").attr("disabled",!1):$("#siteban select[name=reasonSelect] option[value=custom]").attr("disabled",!0)},100)}),M.permissions.usersetOthers&&$(`<div class="menu-item set-color">${window.i18nextify.i18next.t("Set Color")}</div>`).appendTo(i).on("mousedown touchstart",function(t){var i=prompt("What color?",e.color);null!==i&&M.sendArray([{m:"setcolor",_id:e._id,color:i}])}),M.permissions.usersetOthers&&$(`<div class="menu-item set-name">${window.i18nextify.i18next.t("Set Name")}</div>`).appendTo(i).on("mousedown touchstart",function(t){var i=prompt("What name?",e.name);null!==i&&M.sendArray([{m:"setname",_id:e._id,name:i}])}),i.fadeIn(100)}}}();var Ne=function(e){if(this instanceof Ne==!1)throw"yeet";EventEmitter.call(this);e=e||{};this.id="Notification-"+(e.id||Math.random()),this.title=e.title||"",this.text=e.text||"",this.html=e.html||"",this.target=$(e.target||"#piano"),this.duration=e.duration||3e4,this.class=e.class||"classic";var t=this,i=$("#"+this.id);return i.length>0&&i.remove(),this.domElement=$('<div class="notification"><div class="notification-body"><div class="title"></div><div class="text"></div></div><div class="x" translated>X</div></div>'),this.domElement[0].id=this.id,this.domElement.addClass(this.class),this.domElement.find(".title").text(this.title),this.text.length>0?this.domElement.find(".text").text(this.text):this.html instanceof HTMLElement?this.domElement.find(".text")[0].appendChild(this.html):this.html.length>0&&this.domElement.find(".text").html(this.html),document.body.appendChild(this.domElement.get(0)),this.position(),this.onresize=function(){t.position()},window.addEventListener("resize",this.onresize),this.domElement.find(".x").click(function(){t.close()}),this.duration>0&&setTimeout(function(){t.close()},this.duration),this};mixin(Ne.prototype,EventEmitter.prototype),Ne.prototype.constructor=Ne,Ne.prototype.position=function(){var e=this.target.offset(),t=e.left-this.domElement.width()/2+this.target.width()/4,i=e.top-this.domElement.height()-8,n=this.domElement.width();t+n>$("body").width()&&(t-=t+n-$("body").width()),t<0&&(t=0),this.domElement.offset({left:t,top:i})},Ne.prototype.close=function(){var e=this;window.removeEventListener("resize",this.onresize),this.domElement.fadeOut(500,function(){e.domElement.remove(),e.emit("close")})};var Oe,Ie=0,Ke=!1;function Re(e){27==e.keyCode&&(He(),oe||e.preventDefault(),e.stopPropagation())}function We(e,t){ze&&ze.blur(),Ce(),$(document).on("keydown",Re),$("#modal #modals > *").hide(),$("#modal").fadeIn(250),$(e).show(),setTimeout(function(){$(e).find(t).focus()},100),Oe=e}function He(){$(document).off("keydown",Re),$("#modal").fadeOut(100),$("#modal #modals > *").hide(),$e(),Oe=null}localStorage&&localStorage.knowsYouCanUseKeyboard&&(Ke=!0),Ke||(window.gKnowsYouCanUseKeyboardTimeout=setTimeout(function(){window.gKnowsYouCanUseKeyboardNotification=new Ne({title:window.i18nextify.i18next.t("Did you know!?!"),text:window.i18nextify.i18next.t("You can play the piano with your keyboard, too.  Try it!"),target:"#piano",duration:1e4})},3e4)),window.localStorage&&(localStorage.volume?(de.value=localStorage.volume,u.audio.setVolume(localStorage.volume),$("#volume-label").html(window.i18nextify.i18next.t("Volume")+"<span translated>: "+Math.floor(100*u.audio.volume)+"%</span>")):localStorage.volume=u.audio.volume,window.gHasBeenHereBefore=localStorage.gHasBeenHereBefore||!1,gHasBeenHereBefore,localStorage.gHasBeenHereBefore=!0),$("#room > .info").text("--"),M.on("ch",function(e){var t=e.ch,i=$("#room > .info");i.text(t._id),t.settings.lobby?i.addClass("lobby"):i.removeClass("lobby"),t.settings.chat?i.removeClass("no-chat"):i.addClass("no-chat"),t.settings.crownsolo?i.addClass("crownsolo"):i.removeClass("crownsolo"),t.settings["no cussing"]?i.addClass("no-cussing"):i.removeClass("no-cussing"),t.settings.visible?i.removeClass("not-visible"):i.addClass("not-visible")}),M.on("ls",function(e){for(var t in e.u)if(e.u.hasOwnProperty(t)){var i=e.u[t],n=$('#room .info[roomid="'+(i.id+"").replace(/[\\"']/g,"\\$&").replace(/\u0000/g,"\\0")+'"]');0==n.length&&((n=$('<div class="info"></div>')).attr("roomname",i._id),n.attr("roomid",i.id),$("#room .more").append(n)),n.attr("translated",""),n.text(i.count+"/"+("limit"in i.settings?i.settings.limit:20)+" "+i._id),i.settings.lobby?n.addClass("lobby"):n.removeClass("lobby"),i.settings.chat?n.removeClass("no-chat"):n.addClass("no-chat"),i.settings.crownsolo?n.addClass("crownsolo"):n.removeClass("crownsolo"),i.settings["no cussing"]?n.addClass("no-cussing"):n.removeClass("no-cussing"),i.settings.visible?n.removeClass("not-visible"):n.addClass("not-visible"),i.banned?n.addClass("banned"):n.removeClass("banned")}}),$("#room").on("click",function(e){if(e.stopPropagation(),$(e.target).hasClass("info")&&$(e.target).parents(".more").length){$("#room .more").fadeOut(250);var t=$(e.target).attr("roomname");return void 0!==t&&Fe(t,"right"),!1}$(e.target).hasClass("new")&&We("#new-room","input[name=name]");var i=function(e){$(e.target).is("#room .more")||($(document).off("mousedown",i),$("#room .more").fadeOut(250),M.sendArray([{m:"-ls"}]))};$(document).on("mousedown",i),$("#room .more .info").remove(),$("#room .more").show(),M.sendArray([{m:"+ls"}])}),$("#new-room-btn").on("click",function(e){e.stopPropagation(),We("#new-room","input[name=name]")}),$("#play-alone-btn").on("click",function(e){e.stopPropagation(),Fe("Room"+Math.floor(1e12*Math.random()),"right",{visible:!1}),setTimeout(function(){new Ne({id:"share",title:window.i18nextify.i18next.t("Playing alone"),html:window.i18nextify.i18next.t("You are playing alone in a room by yourself, but you can always invite friends by sending them the link.")+'<br><a href="'+location.href+'">'+location.href+"</a>",duration:25e3})},1e3)}),$("#account-btn").on("click",function(e){e.stopPropagation(),We("#account"),M.accountInfo?($("#account #account-info").show(),"discord"===M.accountInfo.type&&($("#account #avatar-image").prop("src",M.accountInfo.avatar),$("#account #logged-in-user-text").text(M.accountInfo.username+"#"+M.accountInfo.discriminator))):$("#account #account-info").hide()});var Ge=$("#modal .bg")[0];function Fe(e,t,i,n){i||(i={}),t||(t="right"),void 0===n&&(n=!0);var o="left"==t?"right":"left";if(e||(e="lobby"),!M.channel||M.channel._id!==e){if(n){let t="/?c="+encodeURIComponent(e).replace("'","%27");if(!window.history||!history.pushState)return void(window.location=t);history.pushState({depth:je+=1,name:e},"Piano > "+e,t)}M.setChannel(e,i);var a=0;$("#piano").addClass("ease-out").addClass("slide-"+o),setTimeout(function(){$("#piano").removeClass("ease-out").removeClass("slide-"+o).addClass("slide-"+t)},a+=100),setTimeout(function(){$("#piano").addClass("ease-in").removeClass("slide-"+t)},a+=100),setTimeout(function(){$("#piano").removeClass("ease-in")},a+=100)}}$(Ge).on("click",function(e){e.target==Ge&&He()}),function(){function e(){var e=$("#new-room .text[name=name]").val(),t={visible:$("#new-room .checkbox[name=visible]").is(":checked"),chat:!0};$("#new-room .text[name=name]").val(""),He(),Fe(e,"right",t),setTimeout(function(){new Ne({id:"share",title:window.i18nextify.i18next.t("Created a Room"),html:window.i18nextify.i18next.t("You can invite friends to your room by sending them the link.")+'<br><a href="'+location.href+'">'+location.href+"</a>",duration:25e3})},1e3)}$("#new-room .submit").click(function(t){e()}),$("#new-room .text[name=name]").keypress(function(t){if(13==t.keyCode)e();else{if(27!=t.keyCode)return;He()}return oe||t.preventDefault(),t.stopPropagation(),!1})}();var je=0;$(window).on("popstate",function(e){var t=e.state?e.state.depth:0,i=t<=je?"left":"right";je=t,Fe(E(),i,null,!1)}),function(){function e(){var e={name:$("#rename input[name=name]").val(),color:$("#rename input[name=color]").val()};He(),M.sendArray([{m:"userset",set:e}])}$("#rename .submit").click(function(t){e()}),$("#rename .text[name=name]").keypress(function(t){if(13==t.keyCode)e();else{if(27!=t.keyCode)return;He()}return oe||t.preventDefault(),t.stopPropagation(),!1})}(),function(){function e(){var e={m:"siteban"};e.id=$("#siteban .text[name=id]").val();var t,i=$("#siteban select[name=durationUnit]").val();if("permanent"===i){if(!M.permissions.siteBanAnyDuration)return void $("#siteban p[name=errorText]").text("You don't have permission to ban longer than 1 month. Contact a higher staff to ban the user for longer.");e.permanent=!0}else{var n=0;switch(i){case"seconds":n=1e3;break;case"minutes":n=6e4;break;case"hours":n=36e5;break;case"days":n=864e5;break;case"weeks":n=6048e5;break;case"months":n=2592e6;break;case"years":n=31536e6}var o=n*parseFloat($("#siteban input[name=durationNumber]").val());if(o<0)return void $("#siteban p[name=errorText]").text("Invalid duration.");if(o>2592e6&&!M.permissions.siteBanAnyDuration)return void $("#siteban p[name=errorText]").text("You don't have permission to ban longer than 1 month. Contact a higher staff to ban the user for longer.");e.duration=o}if("custom"===$("#siteban select[name=reasonSelect]").val()){if(0===(t=$("#siteban .text[name=reasonText]").val()).length)return void $("#siteban p[name=errorText]").text("Please provide a reason.")}else t=$("#siteban select[name=reasonSelect]").val();e.reason=t;var a=$("#siteban textarea[name=note]").val();a&&(e.note=a),He(),M.sendArray([e])}function t(t){if(13==t.keyCode)e();else{if(27!=t.keyCode)return;He()}return oe||t.preventDefault(),t.stopPropagation(),!1}$("#siteban .submit").click(function(t){e()}),$("#siteban select[name=reasonSelect]").change(function(e){"custom"===this.value?($("#siteban .text[name=reasonText]").attr("disabled",!1),$("#siteban .text[name=reasonText]").val("")):($("#siteban .text[name=reasonText]").attr("disabled",!0),$("#siteban .text[name=reasonText]").val(this.value))}),$("#siteban select[name=durationUnit]").change(function(e){"permanent"===this.value?$("#siteban .text[name=durationNumber]").attr("disabled",!0):$("#siteban .text[name=durationNumber]").attr("disabled",!1)}),$("#siteban .text[name=id]").keypress(t),$("#siteban .text[name=reasonText]").keypress(t),$("#siteban .text[name=note]").keypress(t)}(),$("#account .logout-btn").click(function(e){delete localStorage.token,delete M.accountInfo,M.stop(),M.start(),He()}),$("#account .login-discord").click(function(e){location.replace(encodeURI(`https://discord.com/api/oauth2/authorize?client_id=926633278100877393&redirect_uri=${location.origin}/?callback=discord&response_type=code&scope=identify email`))});for(var ze=function(){M.on("ch",function(e){e.ch.settings.chat?ze.show():ze.hide()}),M.on("disconnect",function(e){}),M.on("c",function(e){if(ze.clear(),e.c)for(var t=0;t<e.c.length;t++)ze.receive(e.c[t])}),M.on("a",function(e){ze.receive(e)}),M.on("dm",function(e){ze.receive(e)}),$("#chat input").on("focus",function(e){Ce(),$("#chat").addClass("chatting"),ze.scrollToBottom()}),$(document).mousedown(function(e){!$("#chat").has(e.target).length>0&&ze.blur()}),document.addEventListener("touchstart",function(e){for(var t in e.changedTouches){var i=e.changedTouches[t];!$("#chat").has(i.target).length>0&&ze.blur()}}),$(document).on("keydown",function(e){$("#chat").hasClass("chatting")?27==e.keyCode?(ze.blur(),oe||e.preventDefault(),e.stopPropagation()):13==e.keyCode&&$("#chat input").focus():Oe||27!=e.keyCode&&13!=e.keyCode||$("#chat input").focus()}),$("#chat input").on("keydown",function(e){if(13==e.keyCode){if(MPP.client.isConnected()){var t=$(this).val();0==t.length?(Ae&&ze.endDM(),_e&&ze.cancelReply(),setTimeout(function(){ze.blur()},100)):(ze.send(t),$(this).val(""),setTimeout(function(){ze.blur()},100))}oe||e.preventDefault(),e.stopPropagation()}else 27==e.keyCode?(ze.blur(),oe||e.preventDefault(),e.stopPropagation()):9==e.keyCode&&(oe||e.preventDefault(),e.stopPropagation())});var e=[];return{startDM:function(e){Ae=!0,De=e,$("#chat-input")[0].placeholder="Direct messaging "+e.name+"."},endDM:function(){Ae=!1,$("#chat-input")[0].placeholder=window.i18nextify.i18next.t("You can chat with this thing.")},startReply:function(e,t){$(`#msg-${Be}`).css({"background-color":"unset",border:"1px solid #00000000"}),_e=!0,Me=e,Be=t,$("#chat-input")[0].placeholder=`Replying to ${e.name}`},startDmReply:function(e,t){$(`#msg-${Be}`).css({"background-color":"unset",border:"1px solid #00000000"}),_e=!0,Ae=!0,Be=t,Me=e,De=e,$("#chat-input")[0].placeholder=`Replying to ${e.name} in a DM.`},cancelReply:function(){Ae&&(Ae=!1),_e=!1,$(`#msg-${Be}`).css({"background-color":"unset",border:"1px solid #00000000"}),$("#chat-input")[0].placeholder=window.i18nextify.i18next.t("You can chat with this thing.")},show:function(){$("#chat").fadeIn()},hide:function(){$("#chat").fadeOut()},clear:function(){$("#chat li").remove()},scrollToBottom:function(){var e=$("#chat ul").get(0);e.scrollTop=e.scrollHeight-e.clientHeight},blur:function(){$("#chat").hasClass("chatting")&&($("#chat input").get(0).blur(),$("#chat").removeClass("chatting"),ze.scrollToBottom(),$e())},send:function(e){_e?Ae?(M.sendArray([{m:"dm",reply_to:Be,_id:Me._id,message:e}]),setTimeout(()=>{MPP.chat.cancelReply()},100)):(M.sendArray([{m:"a",reply_to:Be,_id:Me._id,message:e}]),setTimeout(()=>{MPP.chat.cancelReply()},100)):Ae?M.sendArray([{m:"dm",_id:De._id,message:e}]):M.sendArray([{m:"a",message:e}])},receive:function(t){if("dm"===t.m){if(-1!=F.indexOf(t.sender._id))return}else if(-1!=F.indexOf(t.p._id))return;var i=`<li id="msg-${t.id}">`,n=!1;"dm"===t.m&&t.sender._id!==M.user._id&&t.recipient._id!==M.user._id||(i+='<span class="reply"/>'),z&&(i+='<span class="timestamp"/>'),"dm"===t.m&&(t.sender._id===M.user._id?i+='<span class="sentDm"/>':t.recipient._id===M.user._id?i+='<span class="receivedDm"/>':(i+='<span class="otherDm"/>',n=!0)),n?(j&&(i+='<span class="id"/>'),i+='<span class="name"/><span class="dmArrow"/>',j&&(i+='<span class="id2"/>'),i+='<span class="name2"/><span class="message"/>'):(j&&(i+='<span class="id"/>'),i+='<span class="name"/>',t.r&&(i+='<span class="replyLink"/>'),i+='<span class="message"/>');var o=$(i);if(o.find(".reply").text("➦"),t.r){var a=e.find(e=>e.id===t.r);N||a?.p?._id===M.user._id&&(document.title="You have received a reply!",I=!0),a?(o.find(".replyLink").text(`➥ ${"dm"===a.m?a.sender.name:a.p.name}`),o.find(".replyLink").css({background:`${("dm"===a?.m?a?.sender?.color:a?.p?.color)??"gray"}`}),o.find(".replyLink").on("click",e=>{$("#chat-input").focus(),document.getElementById(`msg-${a?.id}`).scrollIntoView({behavior:"smooth"}),$(`#msg-${a?.id}`).css({border:`1px solid ${"dm"===a?.m?a.sender?.color:a.p?.color}80`,"background-color":`${"dm"===a?.m?a.sender?.color:a.p?.color}20`}),setTimeout(()=>{$(`#msg-${a?.id}`).css({"background-color":"unset",border:"1px solid #00000000"})},5e3)})):(o.find(".replyLink").text("➥ Unknown Message"),o.find(".replyLink").css({background:"gray"}))}"dm"===t.m&&(t.sender._id===M.user._id?(o.find(".sentDm").text("To"),o.find(".sentDm").css("color","#ff55ff")):t.recipient._id===M.user._id?(o.find(".receivedDm").text("From"),o.find(".receivedDm").css("color","#ff55ff")):(o.find(".otherDm").text("DM"),o.find(".otherDm").css("color","#ff55ff"),o.find(".dmArrow").text("->"),o.find(".dmArrow").css("color","#ff55ff"))),z&&o.find(".timestamp").text(new Date(t.t).toLocaleTimeString());let s=parseMarkdown(parseContent(t.a),parseUrl).replace(/@([\da-f]{24})/g,(e,t)=>{let i=M.ppl[t];if(i){let e=parseContent(i.name);return i.id===M.getOwnParticipant().id?(N||(O=!0,document.title=window.i18nextify.i18next.t("You were mentioned!")),`<span class="mention" style="background-color: ${i.color};">${e}</span>`):`@${e}`}return e});o.find(".message").html(s),"dm"===t.m?(V||o.find(".message").css("color",t.sender.color||"white"),j&&(t.sender._id===M.user._id?o.find(".id").text(t.recipient._id.substring(0,6)):o.find(".id").text(t.sender._id.substring(0,6))),t.sender._id===M.user._id?(V||o.find(".name").css("color",t.recipient.color||"white"),o.find(".name").text(t.recipient.name+":"),J&&(o[0].title=t.recipient._id)):t.recipient._id===M.user._id?(V||o.find(".name").css("color",t.sender.color||"white"),o.find(".name").text(t.sender.name+":"),J&&(o[0].title=t.sender._id)):(V||o.find(".name").css("color",t.sender.color||"white"),V||o.find(".name2").css("color",t.recipient.color||"white"),o.find(".name").text(t.sender.name),o.find(".name2").text(t.recipient.name+":"),j&&o.find(".id").text(t.sender._id.substring(0,6)),j&&o.find(".id2").text(t.recipient._id.substring(0,6)),J&&(o[0].title=t.sender._id))):(V||o.find(".message").css("color",t.p.color||"white"),V||o.find(".name").css("color",t.p.color||"white"),o.find(".name").text(t.p.name+":"),V||o.find(".message").css("color",t.p.color||"white"),j&&o.find(".id").text(t.p._id.substring(0,6)),J&&(o[0].title=t.p._id)),o.find(".id").on("click",e=>{"dm"===t.m?(navigator.clipboard.writeText(t.sender._id===M.user._id?t.recipient._id:t.sender._id),o.find(".id").text("Copied"),setTimeout(()=>{o.find(".id").text((t.sender._id===M.user._id?t.recipient._id:t.sender._id).substring(0,6))},2500)):(navigator.clipboard.writeText(t.p._id),o.find(".id").text("Copied"),setTimeout(()=>{o.find(".id").text(t.p._id.substring(0,6))},2500))}),o.find(".id2").on("click",e=>{navigator.clipboard.writeText(t.recipient._id),o.find(".id2").text("Copied"),setTimeout(()=>{o.find(".id2").text(t.recipient._id.substring(0,6))},2500)}),o.find(".reply").on("click",e=>{if("dm"!==t.m)MPP.chat.startReply(t.p,t.id,t.a),setTimeout(()=>{$(`#msg-${t.id}`).css({border:`1px solid ${"dm"===t?.m?t.sender?.color:t.p?.color}80`,"background-color":`${"dm"===t?.m?t.sender?.color:t.p?.color}20`})},100),setTimeout(()=>{$("#chat-input").focus()},100);else if("dm"===t.m){let e=t.sender._id===M.user._id?t.recipient:t.sender;M.ppl[e._id]?(MPP.chat.startDmReply(e,t.id),setTimeout(()=>{$(`#msg-${t.id}`).css({border:`1px solid ${"dm"===t?.m?t.sender?.color:t.p?.color}80`,"background-color":`${"dm"===t?.m?t.sender?.color:t.p?.color}20`})},100),setTimeout(()=>{$("#chat-input").focus()},100)):new Ne({target:"#piano",title:"User not found.",text:"The user who you are trying to reply to in a DM is not found, so a DM could not be started."})}}),$("#chat ul").append(o),e.push(t);for(var r=$("#chat ul li").get(),l=1;l<=50&&l<=r.length;l++)r[r.length-l].style.opacity=1-.03*l;if(r.length>50&&(r[0].style.display="none"),r.length>256&&(e.shift(),$(r[0]).remove()),$("#chat").hasClass("chatting")){var c=$("#chat ul").get(0);c.scrollTop>c.scrollHeight-c.offsetHeight-50&&ze.scrollToBottom()}else ze.scrollToBottom()}}}(),Ve=-12,Ue=["a-1","as-1","b-1"],Ye="c cs d ds e f fs g gs a as b".split(" "),qe=0;qe<7;qe++)for(var Xe in Ye)Ue.push(Ye[Xe]+qe);Ue.push("c7");var Je="[]";function Qe(){M.sendArray([{m:"devices",list:JSON.parse(Je)}])}M.on("connect",Qe);var Ze={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0};navigator.requestMIDIAccess&&navigator.requestMIDIAccess().then(function(t){function i(e){if(e.target.enabled){var t=15&e.data[0],i=e.data[0]>>4,n=e.data[1],o=e.data[2];if(!re||9!=t)if(8==i||9==i&&0==o)b(Ue[n-9+Ve+ve+Ze[t]]);else if(9==i)void 0!==e.target.volume&&(o*=e.target.volume),w(Ue[n-9+Ve+ve+Ze[t]],o/127);else if(11==i)p||64==n&&(o>20?k():C());else if(14==i){var a=e.data[1]+(e.data[2]<<7)-8192;a=Math.round(a/1e3),Ze[t]=a}}}function o(e){return{type:e.type,manufacturer:e.manufacturer,name:e.name,version:e.version,enabled:e.enabled,volume:e.volume}}function a(){var e=[];if(t.inputs.size>0)for(var i=t.inputs.values(),n=i.next();n&&!n.done;n=i.next()){var a=n.value;e.push(o(a))}if(t.outputs.size>0)for(var s=t.outputs.values(),r=s.next();r&&!r.done;r=s.next()){var l=r.value;e.push(o(l))}var c=JSON.stringify(e);c!==Je&&(Je=c,Qe())}function s(){if(t.inputs.size>0)for(var n=t.inputs.values(),o=n.next();o&&!o.done;o=n.next()){var s=o.value;s.onmidimessage=i,!1!==s.enabled&&(s.enabled=!0),void 0===s.volume&&(s.volume=1)}if(t.outputs.size>0){for(var r=t.outputs.values(),c=r.next();c&&!c.done;c=r.next()){var d=c.value;void 0===d.volume&&(d.volume=1)}e=function(e,i,n,o){if(Y||o!==M.participantId){var a=Ue.indexOf(e);if(-1!=a){a=a+9-Ve;for(var s=t.outputs.values(),r=s.next();r&&!r.done;r=s.next()){var l=r.value;if(l.enabled){var c=i;void 0!==l.volume&&(c*=l.volume),l.send([144,a,c],window.performance.now()+n)}}}}}}l(!1),a()}var r;function l(e){var i=document.createElement("ul");let o=JSON.parse(localStorage["hm.midiToggles"]??"{}");if(t.inputs.size>0)for(var s=t.inputs.values(),l=s.next();l&&!l.done;l=s.next()){var c=l.value;if((p=document.createElement("li")).connectionId=c.id,p.classList.add("connection"),o[c.name]&&(p.classList.add("enabled"),c.enabled=!0),p.textContent=c.name,p.addEventListener("click",function(e){for(var i=t.inputs.values(),n=i.next();n&&!n.done;n=i.next()){var s=n.value;if(s.id===e.target.connectionId)return s.enabled=!s.enabled,o[s.name]=s.enabled,localStorage["hm.midiToggles"]=JSON.stringify(o),e.target.classList.toggle("enabled"),void a()}}),n){var d=document.createElement("canvas");mixin(d,{width:16*window.devicePixelRatio,height:16*window.devicePixelRatio,className:"knob"}),p.appendChild(d),(d=new Knob(d,0,2,.01,c.volume,"volume")).canvas.style.width="16px",d.canvas.style.height="16px",d.canvas.style.float="right",d.on("change",function(e){c.volume=e.value}),d.emit("change",d)}i.appendChild(p)}else i.textContent="(none)";var h=document.createElement("ul");if(t.outputs.size>0)for(var u=t.outputs.values(),m=u.next();m&&!m.done;m=u.next()){var p,f=m.value;(p=document.createElement("li")).connectionId=f.id,p.classList.add("connection"),o[f.name]&&(p.classList.add("enabled"),f.enabled=!0),p.textContent=f.name,p.addEventListener("click",function(e){for(var i=t.outputs.values(),n=i.next();n&&!n.done;n=i.next()){var s=n.value;if(s.id===e.target.connectionId)return s.enabled=!s.enabled,o[s.name]=s.enabled,localStorage["hm.midiToggles"]=JSON.stringify(o),e.target.classList.toggle("enabled"),void a()}}),n&&(d=document.createElement("canvas"),mixin(d,{width:16*window.devicePixelRatio,height:16*window.devicePixelRatio,className:"knob"}),p.appendChild(d),(d=new Knob(d,0,2,.01,f.volume,"volume")).canvas.style.width="16px",d.canvas.style.height="16px",d.canvas.style.float="right",d.on("change",function(e){f.volume=e.value}),d.emit("change",d)),h.appendChild(p)}else h.textContent="(none)";h.setAttribute("translated",""),i.setAttribute("translated","");var v=document.createElement("div"),g=document.createElement("h1");g.textContent="Inputs",v.appendChild(g),v.appendChild(i),(g=document.createElement("h1")).textContent="Outputs",v.appendChild(g),v.appendChild(h),r=new Ne({id:"MIDI-Connections",title:"MIDI Connections",duration:e?"-1":"4500",html:v,target:"#midi-btn"})}t.addEventListener("statechange",function(e){e instanceof MIDIConnectionEvent&&s()}),s(),document.getElementById("midi-btn").addEventListener("click",function(e){document.getElementById("Notification-MIDI-Connections")?r.close():l(!0)})},function(e){}),window.onerror=function(e,t,i){},window.MPP={get press(){return w},set press(e){w=e},get release(){return b},set release(e){b=e},get pressSustain(){return k},set pressSustain(e){k=e},get releaseSustain(){return C},set releaseSustain(e){C=e},addons:{hyperMod:o},piano:u,client:M,chat:ze,noteQuota:Te,soundSelector:m,Notification:Ne};var et=!1,tt=u.audio,it=u.audio.context,nt=it.createGain();nt.gain.value=.05,nt.connect(tt.synthGain);var ot,at=["sine","square","sawtooth","triangle"],st=1,rt="square",lt=0,ct=.2,dt=.5,ht=2;function ut(e,t){var i=Ue.indexOf(e);i=i+9-Ve;var n=440*Math.pow(2,(i-69)/12);this.osc=it.createOscillator(),this.osc.type=rt,this.osc.frequency.value=n,this.gain=it.createGain(),this.gain.gain.value=0,this.osc.connect(this.gain),this.gain.connect(nt),this.osc.start(t),this.gain.gain.setValueAtTime(0,t),this.gain.gain.linearRampToValueAtTime(1,t+lt),this.gain.gain.linearRampToValueAtTime(dt,t+lt+ct)}ut.prototype.stop=function(e){this.gain.gain.linearRampToValueAtTime(0,e+ht),this.osc.stop(e+ht)},document.getElementById("synth-btn").addEventListener("click",function(){ot?ot.close():function(){var e=document.createElement("div");!function(){var t=document.createElement("input");mixin(t,{type:"button",value:window.i18nextify.i18next.t("ON/OFF"),className:et?"switched-on":"switched-off"}),t.addEventListener("click",function(e){if(et=!et,t.className=et?"switched-on":"switched-off",!et)for(var i in tt.playings)if(tt.playings.hasOwnProperty(i)){var n=tt.playings[i];n&&n.voice&&(n.voice.osc.stop(),n.voice=void 0)}}),e.appendChild(t)}();var t=document.createElement("canvas");mixin(t,{width:32*window.devicePixelRatio,height:32*window.devicePixelRatio,className:"knob"}),e.appendChild(t),(t=new Knob(t,0,100,.1,50,"mix","%")).canvas.style.width="32px",t.canvas.style.height="32px",t.on("change",function(e){var t=e.value/100;tt.pianoGain.gain.value=1-t,tt.synthGain.gain.value=t}),t.emit("change",t),function(){rt=at[st];var t=document.createElement("input");mixin(t,{type:"button",value:window.i18nextify.i18next.t(at[st])}),t.addEventListener("click",function(e){++st>=at.length&&(st=0),rt=at[st],t.value=window.i18nextify.i18next.t(rt)}),e.appendChild(t)}(),t=document.createElement("canvas"),mixin(t,{width:32*window.devicePixelRatio,height:32*window.devicePixelRatio,className:"knob"}),e.appendChild(t),(t=new Knob(t,0,1,.001,lt,"osc1 attack","s")).canvas.style.width="32px",t.canvas.style.height="32px",t.on("change",function(e){lt=e.value}),t.emit("change",t),t=document.createElement("canvas"),mixin(t,{width:32*window.devicePixelRatio,height:32*window.devicePixelRatio,className:"knob"}),e.appendChild(t),(t=new Knob(t,0,2,.001,ct,"osc1 decay","s")).canvas.style.width="32px",t.canvas.style.height="32px",t.on("change",function(e){ct=e.value}),t.emit("change",t),t=document.createElement("canvas"),mixin(t,{width:32*window.devicePixelRatio,height:32*window.devicePixelRatio,className:"knob"}),e.appendChild(t),(t=new Knob(t,0,1,.001,dt,"osc1 sustain","x")).canvas.style.width="32px",t.canvas.style.height="32px",t.on("change",function(e){dt=e.value}),t.emit("change",t),t=document.createElement("canvas"),mixin(t,{width:32*window.devicePixelRatio,height:32*window.devicePixelRatio,className:"knob"}),e.appendChild(t),(t=new Knob(t,0,2,.001,ht,"osc1 release","s")).canvas.style.width="32px",t.canvas.style.height="32px",t.on("change",function(e){ht=e.value}),t.emit("change",t),(ot=new Ne({title:"Synthesize",html:e,duration:-1,target:"#synth-btn"})).on("close",function(){var e=document.getElementById("tooltip");e&&e.parentNode.removeChild(e),ot=null})}()}),function(){if("multiplayerpiano.com"===window.location.hostname){var e;(t=document.getElementById("client-settings-btn")).addEventListener("click",function(){var t,i;e?e.close():(t=document.createElement("div"),(i=document.createElement("div")).classList="setting",i.innerText="Show user IDs in chat",j&&i.classList.toggle("enabled"),i.onclick=function(){i.classList.toggle("enabled"),localStorage.showIdsInChat=i.classList.contains("enabled"),j=i.classList.contains("enabled")},t.appendChild(i),function(){var e=document.createElement("div");e.classList="setting",e.innerText="Timestamps in chat",z&&e.classList.toggle("enabled"),e.onclick=function(){e.classList.toggle("enabled"),localStorage.showTimestampsInChat=e.classList.contains("enabled"),z=e.classList.contains("enabled")},t.appendChild(e)}(),function(){var e=document.createElement("div");e.classList="setting",e.innerText="No chat colors",V&&e.classList.toggle("enabled"),e.onclick=function(){e.classList.toggle("enabled"),localStorage.noChatColors=e.classList.contains("enabled"),V=e.classList.contains("enabled")},t.appendChild(e)}(),function(){var e=document.createElement("div");e.classList="setting",e.innerText="Force dark background",U&&e.classList.toggle("enabled"),e.onclick=function(){e.classList.toggle("enabled"),localStorage.noBackgroundColor=e.classList.contains("enabled"),U=e.classList.contains("enabled"),M.channel.settings.color&&!U?setBackgroundColor(M.channel.settings.color,M.channel.settings.color2):setBackgroundColorToDefault()},t.appendChild(e)}(),function(){var e=document.createElement("div");e.classList="setting",e.innerText="Output own notes to MIDI",Y&&e.classList.toggle("enabled"),e.onclick=function(){e.classList.toggle("enabled"),localStorage.outputOwnNotes=e.classList.contains("enabled"),Y=e.classList.contains("enabled")},t.appendChild(e)}(),function(){var e=document.createElement("div");e.classList="setting",e.innerText="Virtual Piano layout",q&&e.classList.toggle("enabled"),e.onclick=function(){e.classList.toggle("enabled"),localStorage.virtualPianoLayout=e.classList.contains("enabled"),q=e.classList.contains("enabled"),pe=q?me.VP:me.MPP},t.appendChild(e)}(),function(){var e=document.createElement("div");e.classList="setting",e.innerText="Show _id tooltips",J&&e.classList.toggle("enabled"),e.onclick=function(){e.classList.toggle("enabled"),localStorage.showChatTooltips=e.classList.contains("enabled"),J=e.classList.contains("enabled")},t.appendChild(e)}(),function(){var e=document.createElement("div");e.classList="setting",e.innerText="Show Piano Notes",Q&&e.classList.toggle("enabled"),e.onclick=function(){e.classList.toggle("enabled"),localStorage.showPianoNotes=e.classList.contains("enabled"),Q=e.classList.contains("enabled")},t.appendChild(e)}(),function(){var e=document.createElement("div");e.classList="setting",e.innerText="Enable smooth cursors",X&&e.classList.toggle("enabled"),e.onclick=function(){e.classList.toggle("enabled"),localStorage.smoothCursor=e.classList.contains("enabled"),(X=e.classList.contains("enabled"))?$("#cursors").attr("smooth-cursors",""):$("#cursors").removeAttr("smooth-cursors"),X?Object.values(M.ppl).forEach(function(e){e.cursorDiv&&(e.cursorDiv.style.left="",e.cursorDiv.style.top="",e.cursorDiv.style.transform="translate3d("+e.x+"vw, "+e.y+"vh, 0)")}):Object.values(M.ppl).forEach(function(e){e.cursorDiv&&(e.cursorDiv.style.left=e.x+"%",e.cursorDiv.style.top=e.y+"%",e.cursorDiv.style.transform="")})},t.appendChild(e)}(),function(){var e=document.createElement("select");e.classList="setting",e.style="color: inherit; width: calc(100% - 2px);",e.setAttribute("translated","");let i=Object.keys(s),n=document.createElement("option");n.value=n.innerText="No highlighted notes",n.selected=!Z,e.appendChild(n);for(let t of i){let i=document.createElement("option");i.value=t,i.innerText=t,i.selected=t===Z,e.appendChild(i)}Z&&(e.value=Z),e.onchange=function(){localStorage.highlightScaleNotes=e.value,Z=e.value},t.appendChild(e)}(),function(){var e=document.createElement("div");e.classList="setting",e.innerText="Hide all cursors",te&&e.classList.toggle("enabled"),e.onclick=function(){e.classList.toggle("enabled"),localStorage.hideAllCursors=e.classList.contains("enabled"),(te=e.classList.contains("enabled"))?$("#cursors").hide():$("#cursors").show()},t.appendChild(e)}(),(e=new Ne({title:"Client Settings",html:t,duration:-1,target:"#client-settings-btn"})).on("close",function(){var t=document.getElementById("tooltip");t&&t.parentNode.removeChild(t),e=null}))})}else{var t=document.getElementById("client-settings-btn"),i=document.getElementById("client-settings-content"),n=document.getElementsByClassName("client-settings-tablink"),o=document.getElementById("client-settings-ok-btn");function a(e,t,i,n,o,a){let s=document.createElement("input");s.type="checkbox",s.id=e,s.checked=i,s.onclick=a;let r=document.createElement("label");r.innerText=window.i18nextify.i18next.t(t+":")+" ",r.appendChild(s),o.appendChild(r),n&&o.appendChild(document.createElement("br"))}t.addEventListener("click",e=>{e.stopPropagation(),We("#client-settings")}),o.addEventListener("click",e=>{e.stopPropagation(),He()}),window.changeClientSettingsTab=(e,t)=>{i.innerHTML="";for(let e=0;e<n.length;e++)n[e].className=n[e].className.replace(" active","");switch(e.currentTarget.className+=" active",t.toLowerCase()){case"chat":var o=document.createElement("div");a("show-timestamps-in-chat","Show timestamps in chat",z,!0,o,()=>{z=!z,localStorage.showTimestampsInChat=z}),a("show-user-ids-in-chat","Show user IDs in chat",j,!0,o,()=>{j=!j,localStorage.showIdsInChat=j}),a("show-id-tooltips","Show ID tooltips",J,!0,o,()=>{J=!J,localStorage.showChatTooltips=J}),a("no-chat-colors","No chat colors",V,!0,o,()=>{V=!V,localStorage.noChatColors=V}),a("hide-chat","Hide chat",ne,!1,o,()=>{ne=!ne,localStorage.hideChat=ne,ne?$("#chat").hide():$("#chat").show()}),i.appendChild(o);break;case"midi":o=document.createElement("div");a("output-own-notes-to-midi","Output own notes to MIDI",Y,!0,o,()=>{Y=!Y,localStorage.outputOwnNotes=Y}),a("disable-midi-drum-channel","Disable MIDI Drum Channel (channel 10)",re,!0,o,()=>{re=!re,localStorage.disableMIDIDrumChannel=re}),i.appendChild(o);break;case"piano":o=document.createElement("div");a("virtual-piano-layout","Virtual Piano layout",q,!0,o,()=>{q=!q,localStorage.virtualPianoLayout=q,pe=q?me.VP:me.MPP}),a("show-piano-notes","Show piano notes",Q,!0,o,()=>{Q=!Q,localStorage.showPianoNotes=Q}),a("hide-piano","Hide piano",ie,!0,o,()=>{ie=!ie,localStorage.hidePiano=ie,ie?$("#piano").hide():$("#piano").show()});var r=document.createElement("select");r.classList="setting",r.style="width: calc(58.7% - 2px);",r.onchange=()=>{localStorage.highlightScaleNotes=r.value,Z=r.value};let e=Object.keys(s),t=document.createElement("option");t.value=t.innerText="None",t.selected=!Z,r.appendChild(t);for(let t of e){let e=document.createElement("option");e.value=t,e.innerText=t,e.selected=t===Z,r.appendChild(e)}Z&&(r.value=Z);var l=document.createElement("label");l.setAttribute("for",r.id),l.innerText="Highlighted notes: ",o.appendChild(l),o.appendChild(r),i.appendChild(o);break;case"misc":o=document.createElement("div");a("dont-use-prevent-default","Don't use prevent default",V,!0,o,()=>{oe=!oe,localStorage.noPreventDefault=oe}),a("force-dark-background","Force dark background",U,!0,o,()=>{U=!U,localStorage.noBackgroundColor=U,M.channel.settings.color&&!U?setBackgroundColor(M.channel.settings.color,M.channel.settings.color2):setBackgroundColorToDefault()}),a("enable-smooth-cursors","Enable smooth cursors",X,!0,o,()=>{X=!X,localStorage.smoothCursor=X,X?($("#cursors").attr("smooth-cursors",""),Object.values(M.ppl).forEach(function(e){e.cursorDiv&&(e.cursorDiv.style.left="",e.cursorDiv.style.top="",e.cursorDiv.style.transform="translate3d("+e.x+"vw, "+e.y+"vh, 0)")})):($("#cursors").removeAttr("smooth-cursors"),Object.values(M.ppl).forEach(function(e){e.cursorDiv&&(e.cursorDiv.style.left=e.x+"%",e.cursorDiv.style.top=e.y+"%",e.cursorDiv.style.transform="")}))}),a("hide-all-cursors","Hide all cursors",te,!0,o,()=>{te=!te,localStorage.hideAllCursors=te,te?$("#cursors").hide():$("#cursors").show()}),a("hide-bot-users","Hide all bots",ae,!0,o,()=>{ae=!ae,localStorage.hideBotUsers=ae}),11===(new Date).getMonth()&&a("snowflakes","Enable snowflakes",se,!0,o,()=>{se=!se,localStorage.snowflakes=se,le()}),i.appendChild(o)}},changeClientSettingsTab({currentTarget:document.getElementsByClassName("client-settings-tablink")[0]},"Chat")}}();var mt;!function(){mt=r;var e=["DodgerBlue","OliveDrab","Gold","Pink","SlateBlue","LightBlue","Violet","PaleGreen","SteelBlue","SandyBrown","Chocolate","Crimson"],t=!1,i=null,n=[],o=0;function a(t,i,n){return t.color=e[Math.random()*e.length|0],t.x=Math.random()*i,t.y=Math.random()*n-n,t.diameter=10*Math.random()+5,t.tilt=10*Math.random()-10,t.tiltAngleIncrement=.07*Math.random()+.05,t.tiltAngle=0,t}function s(){var e=window.innerWidth,s=window.innerHeight;window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout(e,16.6666667)};var r=document.getElementById("confetti-canvas");null===r&&((r=document.createElement("canvas")).setAttribute("id","confetti-canvas"),r.setAttribute("style","display:block;z-index:999999;pointer-events:none;position:absolute;top:0;left:0"),document.body.appendChild(r),r.width=e,r.height=s,window.addEventListener("resize",function(){r.width=window.innerWidth,r.height=window.innerHeight},!0));for(var l=r.getContext("2d");n.length<500;)n.push(a({},e,s));t=!0,null===i&&function e(){l.clearRect(0,0,window.innerWidth,window.innerHeight),0===n.length?i=null:(!function(){var e,i=window.innerWidth,s=window.innerHeight;o+=.01;for(var r=0;r<n.length;r++)e=n[r],!t&&e.y<-15?e.y=s+100:(e.tiltAngle+=e.tiltAngleIncrement,e.x+=Math.sin(o),e.y+=.5*(Math.cos(o)+e.diameter+2),e.tilt=15*Math.sin(e.tiltAngle)),(e.x>i+20||e.x<-20||e.y>s)&&(t&&n.length<=500?a(e,i,s):(n.splice(r,1),r--))}(),function(e){for(var t,i,o=0;o<n.length;o++)t=n[o],e.beginPath(),e.lineWidth=t.diameter,e.strokeStyle=t.color,e.shadowColor="rgba(0, 0, 0, .3)",e.shadowBlur=4,e.shadowOffsetY=2,e.shadowOffsetX=0,i=t.x+t.tilt,e.moveTo(i+t.diameter/2,t.y),e.lineTo(i,t.y+t.tilt+t.diameter/2),e.stroke()}(l),i=requestAnimFrame(e))}()}function r(){t=!1}}(),window!==top&&alert("Hey, it looks like you're visiting our site through another website. Consider playing Multiplayer Piano directly at https://multiplayerpiano.net"),(async()=>{let e=document.getElementById("languages");[{code:"bg",name:"Bulgarian",native:"Български"},{code:"cs",name:"Czech",native:"Česky"},{code:"de",name:"German",native:"Deutsch"},{code:"en",name:"English",native:"English"},{code:"es",name:"Spanish",native:"Español"},{code:"fr",name:"French",native:"Français"},{code:"hu",name:"Hungarian",native:"Magyar"},{code:"is",name:"Icelandic",native:"Íslenska"},{code:"ja",name:"Japanese",native:"日本語"},{code:"ko",name:"Korean",native:"한국어"},{code:"lv",name:"Latvian",native:"Latviešu"},{code:"nb",name:"Norwegian Bokmål",native:"Norsk bokmål"},{code:"nl",name:"Dutch",native:"Nederlands"},{code:"pl",name:"Polish",native:"Polski"},{code:"pt",name:"Portuguese",native:"Português"},{code:"ru",name:"Russian",native:"Русский"},{code:"sk",name:"Slovak",native:"Slovenčina"},{code:"sv",name:"Swedish",native:"Svenska"},{code:"tr",name:"Turkish",native:"Türkçe"},{code:"zh",name:"Chinese",native:"中文"}].forEach(t=>{let i=document.createElement("option");i.value=t.code,i.innerText=t.native,t.code==i18nextify.i18next.language.split("-")[0]&&(i.selected=!0),i.setAttribute("translated",""),e.appendChild(i)}),document.getElementById("lang-btn").addEventListener("click",()=>{We("#language")}),document.querySelector("#language > button").addEventListener("click",async e=>{await i18nextify.i18next.changeLanguage(document.querySelector("#languages").selectedOptions[0].value),i18nextify.forceRerender(),He()})})(),M.start()});