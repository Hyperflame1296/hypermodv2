let translation=window.i18nextify.init({autorun:!1});if("multiplayerpiano.com"===location.host){let e=new URL("https://multiplayerpiano.net/"+location.search);throw localStorage.token&&e.searchParams.set("token",localStorage.token),location.replace(e),new Error("Redirecting to multiplayerpiano.net")}if("multiplayerpiano.net"===location.host){let e=new URL(location.href),t=e.searchParams.get("token");if(t)throw localStorage.token=t,e.searchParams.delete("token"),location.replace(e),new Error("Finalizing redirect.")}$(function(){translation.start(),console.log("%cWelcome to MPP's developer console!","color:blue; font-size:20px;"),console.log("%cCheck out the source code: https://github.com/mppnet/frontend/tree/main/client\nGuide for coders and bot developers: https://docs.google.com/document/d/1OrxwdLD1l1TE8iau6ToETVmnLuLXyGBhA0VfAY1Lf14/edit?usp=sharing","color:gray; font-size:12px;");var e,t=window.location.hash&&window.location.hash.match(/^(?:#.+)*#test(?:#.+)*$/i),i=window.location.hash&&window.location.hash.match(/^(?:#.+)*#seeowncursor(?:#.+)*$/i),n=window.location.hash&&window.location.hash.match(/^(?:#.+)*#midivolumetest(?:#.+)*$/i);Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,i=Number(arguments[1])||0;for((i=i<0?Math.ceil(i):Math.floor(i))<0&&(i+=t);i<t;i++)if(i in this&&this[i]===e)return i;return-1}),window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/30)};var o=.5;let a=new HyperMod;class s{constructor(e,t,i,n){this.x=e,this.y=t,this.w=i,this.h=n,this.x2=e+i,this.y2=t+n}contains(e,t){return e>=this.x&&e<=this.x2&&t>=this.y&&t<=this.y2}}let r={"Notes in C Major":["C","D","E","F","G","A","B","C"],"Notes in D Major":["D","E","G♭","G","A","B","D♭","D"],"Notes in E Major":["E","G♭","A♭","A","B","D♭","E♭","E"],"Notes in F Major":["F","G","A","B♭","C","D","E","F"],"Notes in G Major":["G","A","B","C","D","E","G♭","G"],"Notes in A Major":["A","B","D♭","D","E","G♭","A♭","A"],"Notes in B Major":["B","D♭","E♭","E","G♭","A♭","B♭","B"],"Notes in C# / Db Major":["D♭","E♭","F","G♭","A♭","B♭","C","D♭"],"Notes in D# / Eb Major":["E♭","F","G","A♭","B♭","C","D","E♭"],"Notes in F# / Gb Major":["G♭","A♭","B♭","B","D♭","E♭","F","G♭"],"Notes in G# / Ab Major":["A♭","B♭","C","D♭","E♭","F","G","A♭"],"Notes in A# / Bb Major":["B♭","C","D","E♭","F","G","A","B♭"],"Notes in A Minor":["A","B","C","D","E","F","G","A"],"Notes in A# / Bb Minor":["B♭","C","D♭","E♭","F","G♭","A♭","B♭"],"Notes in B Minor":["B","D♭","D","E","G♭","G","A","B"],"Notes in C Minor":["C","D","E♭","F","G","A♭","B♭","C"],"Notes in C# / Db Minor":["D♭","E♭","E","G♭","A♭","A","B","D♭"],"Notes in D Minor":["D","E","F","G","A","B♭","C","D"],"Notes in D# / Eb Minor":["E♭","F","G♭","A♭","B♭","B","D♭","E♭"],"Notes in E Minor":["E","G♭","G","A","B","C","D","E"],"Notes in F Minor":["F","G","A♭","B♭","C","D♭","E♭","F"],"Notes in F# / Gb Minor":["G♭","A♭","A","B","D♭","D","E","G♭"],"Notes in G Minor":["G","A","B♭","C","D","E♭","F","G"],"Notes in G# / Ab Minor":["A♭","B♭","B","D♭","E♭","E","G♭","A♭"]};class l{init(e){return this.volume=.6,this.sounds={},this.paused=!0,this}load(e,t,i){}play(){}stop(){}setVolume(e){this.volume=e}resume(){this.paused=!1}}class c extends l{constructor(){super(),this.threshold=0,a.lsSettings.removeWorkerTimer||(this.worker=new Worker("threads/timer.js"),this.worker.onmessage=e=>{e.data.args&&(0==e.data.args.action?this.actualPlay(e.data.args.id,e.data.args.vol,e.data.args.time,e.data.args.part_id):this.actualStop(e.data.args.id,e.data.args.time,e.data.args.part_id))})}init(e){return l.prototype.init.call(this),this.context=new AudioContext({latencyHint:"interactive"}),this.masterGain=this.context.createGain(),this.masterGain.connect(this.context.destination),this.masterGain.gain.value=this.volume,this.limiterNode=this.context.createDynamicsCompressor(),this.limiterNode.threshold.value=-10,this.limiterNode.knee.value=0,this.limiterNode.ratio.value=20,this.limiterNode.attack.value=0,this.limiterNode.release.value=.1,this.limiterNode.connect(this.masterGain),this.pianoGain=this.context.createGain(),this.pianoGain.gain.value=.5,this.pianoGain.connect(this.limiterNode),this.synthGain=this.context.createGain(),this.synthGain.gain.value=.5,this.synthGain.connect(this.limiterNode),this.playings={},e&&setTimeout(e,0),this}load(e,t,i){try{fetch(t).then(t=>{if(!t.ok)throw new Error("http error: "+t.status);t.arrayBuffer().then(t=>{this.context.decodeAudioData(t).then(t=>{this.sounds[e]=t,i?.()})})})}catch(e){console.error(`${e}\n${e.stack}`),new Ke({id:"audio-download-error",title:"Problem",text:"For some reason, an audio download failed:"+e.message,target:"#piano",duration:1e4})}}actualPlay(e,t,i,n){if(!this.paused&&this.sounds.hasOwnProperty(e)&&!(this.volume<=0||a.lsSettings.disableAudioEngine)){var o=this.context.createBufferSource();o.buffer=this.sounds[e];var s=this.context.createGain();if(s.gain.value=t,o.connect(s),s.connect(this.pianoGain),o.start(i),this.playings[e]){let t=this.playings[e];t.gain.gain.setValueAtTime(t.gain.gain.value,i),t.gain.gain.linearRampToValueAtTime(0,i+.2),t.source.stop(i+.21),nt&&t.voice&&t.voice.stop(i)}this.playings[e]={source:o,gain:s,part_id:n},nt&&(this.playings[e].voice=new ft(e,i))}}play(e,t,i,n){if(this.sounds.hasOwnProperty(e)&&!(this.volume<=0||a.lsSettings.disableAudioEngine)){var o=this.context.currentTime+i/1e3,s=i-this.threshold;s<=0?this.actualPlay(e,t,o,n):a.lsSettings.removeWorkerTimer||!this.worker?setTimeout(()=>{this.actualPlay(e,t,o,n)},s):this.worker.postMessage({delay:s,args:{action:0,id:e,vol:t,time:o,part_id:n}})}}actualStop(e,t,i){if(!(this.volume<=0||a.lsSettings.disableAudioEngine)&&this.playings.hasOwnProperty(e)&&this.playings[e]&&this.playings[e].part_id===i){var n=this.playings[e].gain.gain;n.setValueAtTime(n.value,t),n.linearRampToValueAtTime(.1*n.value,t+.16),n.linearRampToValueAtTime(0,t+.4),this.playings[e].source.stop(t+.41),this.playings[e].voice&&this.playings[e].voice.stop(t),this.playings[e]=null}}stop(e,t,i){if(!(this.volume<=0||a.lsSettings.disableAudioEngine)){var n=this.context.currentTime+t/1e3,o=t-this.threshold;o<=0?this.actualStop(e,n,i):a.lsSettings.removeWorkerTimer||!this.worker?setTimeout(()=>{this.actualStop(e,n,i)},o):this.worker.postMessage({delay:o,args:{action:1,id:e,time:n,part_id:i}})}}setVolume(e){l.prototype.setVolume.call(this,e),this.masterGain.gain.value=this.volume}resume(){this.paused=!1,this.context.resume()}}class d{init(e){return this.piano=e,this.resize(),this}resize(e,t){void 0===e&&(e=$(this.piano.rootElement).width()),void 0===t&&(t=Math.floor(.2*e)),$(this.piano.rootElement).css({height:t+"px",marginTop:Math.floor($(window).height()/2-t/2)+"px"}),this.width=e*window.devicePixelRatio,this.height=t*window.devicePixelRatio}visualize(e,t){}}class h extends d{constructor(){super()}static translateMouseEvent(e){var t=e.target,i=0,n=0;do{if(!t)break;i+=t.offsetLeft,n+=t.offsetTop}while(t=t.offsetParent);return{x:(e.pageX-i)*window.devicePixelRatio,y:(e.pageY-n)*window.devicePixelRatio}}init(e){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),e.rootElement.append(this.canvas),this.piano=e,this.resize();var t=()=>{this.redraw(),requestAnimationFrame(t)};t();var i=null;return $(e.rootElement).mousedown(e=>{re||e.preventDefault();var t=h.translateMouseEvent(e),n=this.getHit(t.x,t.y);n&&(C(n.key.note,n.v),i=n.key)}),e.rootElement.addEventListener("touchstart",e=>{for(var t in re||e.preventDefault(),e.changedTouches){var n=h.translateMouseEvent(e.changedTouches[t]),o=this.getHit(n.x,n.y);o&&(C(o.key.note,o.v),i=o.key)}},!1),$(window).mouseup(()=>{i&&S(i.note),i=null}),this}resize(e,t){var i;(void 0===e&&(e=$(this.piano.rootElement).width()),void 0===t&&(t=Math.floor(.2*e)),$(this.piano.rootElement).css({height:t+"px",marginTop:Math.floor($(window).height()/2-t/2)+"px"}),this.width=e*window.devicePixelRatio,this.height=t*window.devicePixelRatio,this.width<104&&(this.width=104),this.height<.2*this.width&&(this.height=Math.floor(.2*this.width)),this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.width=this.width/window.devicePixelRatio+"px",this.canvas.style.height=this.height/window.devicePixelRatio+"px",this.whiteKeyWidth=Math.floor(this.width/52),this.whiteKeyHeight=Math.floor(.9*this.height),this.blackKeyWidth=Math.floor(.75*this.whiteKeyWidth),this.blackKeyHeight=Math.floor(.5*this.height),this.blackKeyOffset=Math.floor(this.whiteKeyWidth-this.blackKeyWidth/2),this.keyMovement=Math.floor(.015*this.whiteKeyHeight),this.whiteBlipWidth=Math.floor(.7*this.whiteKeyWidth),this.whiteBlipHeight=Math.floor(.8*this.whiteBlipWidth),this.whiteBlipX=Math.floor((this.whiteKeyWidth-this.whiteBlipWidth)/2),this.whiteBlipY=Math.floor(this.whiteKeyHeight-1.2*this.whiteBlipHeight),this.blackBlipWidth=Math.floor(.7*this.blackKeyWidth),this.blackBlipHeight=Math.floor(.8*this.blackBlipWidth),this.blackBlipY=Math.floor(this.blackKeyHeight-1.2*this.blackBlipHeight),this.blackBlipX=Math.floor((this.blackKeyWidth-this.blackBlipWidth)/2),this.whiteKeyRender=document.createElement("canvas"),this.whiteKeyRender.width=this.whiteKeyWidth,this.whiteKeyRender.height=this.height+10,(l=this.whiteKeyRender.getContext("2d")).createLinearGradient&&!a.lsSettings.removeKeyGradients)?((i=l.createLinearGradient(0,0,0,this.whiteKeyHeight)).addColorStop(0,"#eee"),i.addColorStop(.75,"#fff"),i.addColorStop(1,"#dad4d4"),l.fillStyle=i):l.fillStyle="#fff";(l.strokeStyle="#000",l.lineJoin="round",l.lineCap="round",l.lineWidth=10,l.strokeRect(l.lineWidth/2,l.lineWidth/2,this.whiteKeyWidth-l.lineWidth,this.whiteKeyHeight-l.lineWidth),l.lineWidth=4,l.fillRect(l.lineWidth/2,l.lineWidth/2,this.whiteKeyWidth-l.lineWidth,this.whiteKeyHeight-l.lineWidth),this.blackKeyRender=document.createElement("canvas"),this.blackKeyRender.width=this.blackKeyWidth+10,this.blackKeyRender.height=this.blackKeyHeight+10,(l=this.blackKeyRender.getContext("2d")).createLinearGradient&&!a.lsSettings.removeKeyGradients)?((i=l.createLinearGradient(0,0,0,this.blackKeyHeight)).addColorStop(0,"#000"),i.addColorStop(1,"#444"),l.fillStyle=i):l.fillStyle="#000";if(l.strokeStyle="#222",l.lineJoin="round",l.lineCap="round",l.lineWidth=8,l.strokeRect(l.lineWidth/2,l.lineWidth/2,this.blackKeyWidth-l.lineWidth,this.blackKeyHeight-l.lineWidth),l.lineWidth=4,l.fillRect(l.lineWidth/2,l.lineWidth/2,this.blackKeyWidth-l.lineWidth,this.blackKeyHeight-l.lineWidth),!a.lsSettings.removeKeyShadows){this.shadowRender=[];for(var n=2*-this.canvas.height,o=0;o<2;o++){var r=document.createElement("canvas");this.shadowRender[o]=r,r.width=this.canvas.width,r.height=this.canvas.height;var l=r.getContext("2d"),c=!!o;for(var d in l.lineJoin="round",l.lineCap="round",l.lineWidth=1,l.shadowColor="rgba(0, 0, 0, 0.5)",l.shadowBlur=3*this.keyMovement,l.shadowOffsetY=-n+this.keyMovement,c?l.shadowOffsetX=this.keyMovement:(l.shadowOffsetX=0,l.shadowOffsetY=-n+this.keyMovement),this.piano.keys){if(this.piano.keys.hasOwnProperty(d))(h=this.piano.keys[d]).sharp==c&&(h.sharp?l.fillRect(this.blackKeyOffset+this.whiteKeyWidth*h.spatial+l.lineWidth/2,n+l.lineWidth/2,this.blackKeyWidth-l.lineWidth,this.blackKeyHeight-l.lineWidth):l.fillRect(this.whiteKeyWidth*h.spatial+l.lineWidth/2,n+l.lineWidth/2,this.whiteKeyWidth-l.lineWidth,this.whiteKeyHeight-l.lineWidth))}}}for(var d in this.piano.keys){var h;if(this.piano.keys.hasOwnProperty(d))(h=this.piano.keys[d]).sharp?h.rect=new s(this.blackKeyOffset+this.whiteKeyWidth*h.spatial,0,this.blackKeyWidth,this.blackKeyHeight):h.rect=new s(this.whiteKeyWidth*h.spatial,0,this.whiteKeyWidth,this.whiteKeyHeight)}}redraw(){var e=Date.now(),t=e-1e3,i=e-100,n=e-1e3;a.lsSettings.removeKeyFade||this.ctx.save(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(var o=0;o<2;o++){a.lsSettings.removeKeyFade||(this.ctx.globalAlpha=1),!a.lsSettings.removeKeyShadows&&this.shadowRender&&this.ctx.drawImage(this.shadowRender[o],0,0);var s=!!o;for(var l in this.piano.keys){if(!this.piano.keys.hasOwnProperty(l))continue;var c=this.piano.keys[l];if(c.sharp!=s)continue;a.lsSettings.removeKeyFade||(c.loaded?c.timeLoaded>t?this.ctx.globalAlpha=(e-c.timeLoaded)/1e3*.8+.2:this.ctx.globalAlpha=1:this.ctx.globalAlpha=.2);var d=0;c.timePlayed>i&&!a.lsSettings.removeNoteBouncing&&(d=Math.floor(this.keyMovement-(e-c.timePlayed)/100*this.keyMovement));var h=Math.floor(c.sharp?this.blackKeyOffset+this.whiteKeyWidth*c.spatial:this.whiteKeyWidth*c.spatial),u=c.sharp?this.blackKeyRender:this.whiteKeyRender;this.ctx.drawImage(u,h,d);var m=c.baseNote[0].toUpperCase();s&&(m+="#"),m+=c.octave+1,te&&(this.ctx.font=(c.sharp?this.blackKeyWidth:this.whiteKeyWidth)/2+"px Arial",this.ctx.fillStyle=c.sharp?"white":"black",this.ctx.textAlign="center",m.includes("#")&&this.ctx.fillText(m,h+(c.sharp?this.blackKeyWidth:this.whiteKeyWidth)/2,d+(c.sharp?this.blackKeyHeight:this.whiteKeyHeight)-30-this.ctx.lineWidth),m=(m=(m=(m=(m=m.replace("C#","D♭")).replace("D#","E♭")).replace("F#","G♭")).replace("G#","A♭")).replace("A#","B♭"),this.ctx.fillText(m,h+(c.sharp?this.blackKeyWidth:this.whiteKeyWidth)/2,d+(c.sharp?this.blackKeyHeight:this.whiteKeyHeight)-10-this.ctx.lineWidth));let o=r[ie];if(o&&c.loaded){let e=(m=(m=(m=(m=(m=m.replace("C#","D♭")).replace("D#","E♭")).replace("F#","G♭")).replace("G#","A♭")).replace("A#","B♭")).slice(0,-1);if(o.includes(e)){let e=this.ctx.globalAlpha;a.lsSettings.removeKeyFade||(this.ctx.globalAlpha=.3),this.ctx.fillStyle="#0f0",c.sharp?this.ctx.fillRect(h,d,this.blackKeyWidth,this.blackKeyHeight):this.ctx.fillRect(h,d,this.whiteKeyWidth,this.whiteKeyHeight),a.lsSettings.removeKeyFade||(this.ctx.globalAlpha=e)}}if(c.blips.length>0){var p,f;c.sharp?(h+=this.blackBlipX,d=this.blackBlipY,p=this.blackBlipWidth,f=this.blackBlipHeight):(h+=this.whiteBlipX,d=this.whiteBlipY,p=this.whiteBlipWidth,f=this.whiteBlipHeight);for(var g=0;g<c.blips.length;g++){var v=c.blips[g];if(v.time>n){let t=Math.round(255*(1-(e-v.time)/1e3*1)).toString(16).padStart(2,"0");this.ctx.fillStyle=v.color+t,this.ctx.fillRect(h,d,p,f)}else c.blips.splice(g,1),--g;d-=Math.floor(1.1*f)}}}}a.lsSettings.removeKeyFade||this.ctx.restore()}renderNoteLyrics(){for(var e in this.noteLyrics)if(this.noteLyrics.hasOwnProperty(Ze)){this.noteLyrics[e],x,this.whiteKeyHeight;this.ctx.fillStyle=key.lyric.color;var t=this.ctx.globalAlpha;a.lsSettings.removeKeyFade||(this.ctx.globalAlpha=t-(now-key.lyric.time)/1e3*t),this.ctx.fillRect(x,y,10,10)}}getHit(e,t){for(var i=0;i<2;i++){var n=!i;for(var a in this.piano.keys)if(this.piano.keys.hasOwnProperty(a)){var s=this.piano.keys[a];if(s.sharp==n&&s.rect?.contains(e,t)){var r=t/(s.sharp?this.blackKeyHeight:this.whiteKeyHeight);return r+=.25,(r*=o)>1&&(r=1),{key:s,v:r}}}}return null}isSupported(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}}class u{constructor(e){this.initialized=!1,this.keys=e.keys,this.loading={},this.notification,this.packs=[],this.piano=e,this.soundSelection=localStorage.soundSelection??"mppclassic",this.addPack({name:"MPP Classic",keys:Object.keys(this.piano.keys),ext:".mp3",url:"assets/sounds/mppclassic/"})}addPack(e,t){this.loading[e.url||e]=!0;let i=i=>{if(void 0!==this.packs.find(e=>i.name===e.name))return console.warn(`Woah woah woah, pack '${e.name??e}' already exists!`);"/"!=i.url.substr(i.url.length-1)&&(i.url=i.url+"/");let n=document.createElement("li");n.classList="pack",n.innerText=i.name+" ("+i.keys.length+" keys)",n.onclick=()=>{this.loadPack(i.name),this.notification.close()},i.html=n,this.packs.push(i),this.packs.sort(),t&&this.loadPack(i.name),delete this.loading[i.url]};if("string"==typeof e){let t=!0;e.match(/^(http|https):\/\//i)&&(t=!1),$.getJSON(e+"/info.json").done(t=>{t.url=e,i(t)})}else i(e)}addPacks(e){for(var t=0;e.length>t;t++)this.addPack(e[t])}init(){if(this.initialized)return console.warn("Sound selector already initialized!");$("#sound-btn").on("click",()=>{if(null!=document.getElementById("Notification-Sound-Selector"))return this.notification.close();for(var e=document.createElement("ul"),t=0;this.packs.length>t;t++){var i=this.packs[t];i.name==this.soundSelection?i.html.classList="pack enabled":i.html.classList="pack",i.html.setAttribute("translated",""),e.appendChild(i.html)}this.notification=new Ke({title:"Sound Selector",html:e,id:"Sound-Selector",duration:-1,target:"#sound-btn"})}),this.initialized=!0,this.loadPack(this.soundSelection,!0)}loadPack(e,t){if(e=this.packs.find(t=>e===t.name)){if("string"==typeof e)return console.warn("Sound pack does not exist! Loading default pack..."),this.loadPack("MPP Classic");if(e.name!==this.soundSelection||t){if(e.keys.length!=Object.keys(this.piano.keys).length){this.piano.keys={};for(var i=0;e.keys.length>i;i++)this.piano.keys[e.keys[i]]=this.keys[e.keys[i]];this.piano.renderer.resize()}for(var i in this.piano.keys)this.piano.keys.hasOwnProperty(i)&&(()=>{var t=this.piano.keys[i];t.loaded=!1;let n=!0;e.url.match(/^(http|https):\/\//i),this.piano.audio.load(t.note,e.url+t.note+e.ext,function(){t.loaded=!0,t.timeLoaded=Date.now()})})();localStorage&&(localStorage.soundSelection=e.name),this.soundSelection=e.name}}}removePack(e){for(var t=0;this.packs.length>t;t++){var i=this.packs[t];if(i.name==e){this.packs.splice(t,1),i.name==this.soundSelection&&this.loadPack(this.packs[0].name);break}}console.warn("Sound pack not found!")}}class m{constructor(e,t){this.note=e+t,this.baseNote=e,this.octave=t,this.sharp=-1!=e.indexOf("s"),this.loaded=!1,this.timeLoaded=0,this.domElement=null,this.timePlayed=0,this.blips=[]}}class p{constructor(e){this.rootElement=e}init(){window.AudioContext=window.AudioContext||window.webkitAudioContext||void 0,this.audio=(new c).init(),this.renderer=(new h).init(this),this.keys={};var e=0,i=0,n=0,o=[2,1,2,1,1],a=(t,a)=>{var s=new m(t,a);this.keys[s.note]=s,s.sharp?(s.spatial=i,i+=o[n%5],++n):(s.spatial=e,++e)};if(t)a("c",2);else{a("a",-1),a("as",-1),a("b",-1);for(var s="c cs d ds e f fs g gs a as b".split(" "),r=0;r<7;r++)for(var l in s)a(s[l],r);a("c",7)}return window.addEventListener("resize",()=>{this.renderer.resize()}),this}bufferPlay(t,i,n,o=0){if(a.lsSettings.trackNPS&&a.npsTracker.noteOn(),!this.keys.hasOwnProperty(t)||!n)return;const s=this.keys[t];s.lastHitTime=performance.now()+o,s.lastColor=n.color;s._blipBuffer||(s._blipBuffer=new Array(17).fill(null),s._blipHead=0,s._blipTail=0,s._blipCount=0),s.loaded&&this.audio.volume>0&&this.audio.play(s.note,i,o,n.id),this._midiBuffer||(this._midiBuffer={buf:new Array(500),head:0,tail:0,count:0}),this._blipBuffer||(this._blipBuffer={buf:new Array(1e3),head:0,tail:0,count:0});const r=this._midiBuffer;r.count<r.buf.length&&(r.buf[r.tail]={note:s.note,vol:100*i,delay:o,participantId:n.id},r.tail=(r.tail+1)%r.buf.length,r.count++);const l=this._blipBuffer;if(l.count<l.buf.length&&(l.buf[l.tail]={key:s,color:n.color,participant:n},l.tail=(l.tail+1)%l.buf.length,l.count++),!this._flusherRunning){this._flusherRunning=!0;const t=()=>{for(let t=0;t<125&&r.count>0;t++){const t=r.buf[r.head];t&&e&&e(t.note,t.vol,t.delay,t.participantId),r.head=(r.head+1)%r.buf.length,r.count--}for(let e=0;e<250&&l.count>0;e++){const e=l.buf[l.head],t=e.key,i=Date.now();t._blipBuffer[t._blipTail]={time:i,color:e.color},t._blipTail=(t._blipTail+1)%17,t._blipCount<17?t._blipCount++:t._blipHead=(t._blipHead+1)%17,t.blips=[];for(let e=0;e<t._blipCount;e++)t.blips.push(t._blipBuffer[(t._blipHead+e)%17]);if(!a.lsSettings.removeNameBouncing&&e.participant.nameDiv&&!e.participant.nameDiv.__isBouncing){const t=e.participant.nameDiv;t.__isBouncing=!0,t.classList.add("play"),setTimeout(()=>{t.classList.remove("play"),t.__isBouncing=!1},30)}l.head=(l.head+1)%l.buf.length,l.count--}r.count>0||l.count>0?requestAnimationFrame(t):this._flusherRunning=!1};requestAnimationFrame(t)}}play(t,i,n,o=0){if(a.lsSettings.trackNPS&&a.npsTracker.noteOn(),this.keys.hasOwnProperty(t)&&n){var s=this.keys[t];if(s.loaded&&this.audio.volume>0&&!a.lsSettings.disableAudioEngine&&this.audio.play(s.note,i,o,n.id),e&&e(s.note,100*i,o,n.id),o<=0){let e=a.lsSettings.blipLimit;if(s.timePlayed=Date.now(),a.lsSettings.enableBlipLimit&&s.blips.length>=e&&s.blips.shift(),s.blips.push({time:s.timePlayed,color:n.color}),!a.lsSettings.removeNameBouncing){var r=$(n.nameDiv);r.addClass("play"),setTimeout(function(){r.removeClass("play")},30)}}else setTimeout(()=>{let e=a.lsSettings.blipLimit;if(s.timePlayed=Date.now(),a.lsSettings.enableBlipLimit&&s.blips.length>=e&&s.blips.shift(),s.blips.push({time:s.timePlayed,color:n.color}),!a.lsSettings.removeNameBouncing){var t=$(n.nameDiv);t.addClass("play"),setTimeout(function(){t.removeClass("play")},30)}},o)}}stop(t,i,n=0){if(this.keys.hasOwnProperty(t)){var o=this.keys[t];o.loaded&&this.audio.volume>0&&!a.lsSettings.disableAudioEngine&&this.audio.stop(o.note,n,i.id),e&&e(o.note,0,n,i.id)}}}var f=new p($("#piano")[0]).init(),g=new u(f);g.addPacks(["assets/sounds/Emotional/","assets/sounds/Emotional_2.0/","assets/sounds/GreatAndSoftPiano/","assets/sounds/HardAndToughPiano/","assets/sounds/HardPiano/","assets/sounds/Harp/","assets/sounds/Harpsicord/","assets/sounds/LoudAndProudPiano/","assets/sounds/MLG/","assets/sounds/Music_Box/","assets/sounds/NewPiano/","assets/sounds/Orchestra/","assets/sounds/Piano2/","assets/sounds/PianoSounds/","assets/sounds/Rhodes_MK1/","assets/sounds/SoftPiano/","assets/sounds/Steinway_Grand/","assets/sounds/Untitled/","assets/sounds/Vintage_Upright/","assets/sounds/Vintage_Upright_Soft/"]),g.init();var v=!1,w=!1,b={},k={};function C(e,t){!B.preventsPlaying()&&_e.spend(1)&&(b[e]=!0,k[e]=!0,a.lsSettings.enableBufferedBlips?f.bufferPlay(e,void 0!==t?t:o,B.getOwnParticipant(),0):f.play(e,void 0!==t?t:o,B.getOwnParticipant(),0),B.startNote(e,t))}function S(e){b[e]&&(b[e]=!1,!v&&!w||nt?_e.spend(1)&&(f.stop(e,B.getOwnParticipant(),0),B.stopNote(e),k[e]=!1):k[e]=!0)}function E(){w=!0}function D(){if(w=!1,!v)for(var e in k)k.hasOwnProperty(e)&&k[e]&&!b[e]&&(k[e]=!1,_e.spend(1)&&(f.stop(e,B.getOwnParticipant(),0),B.stopNote(e)))}function P(e,t=window.location.href){e=e.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}if("multiplayerpiano.com"===window.location.hostname){$("#chat-input")[0].autocomplete="off";let e=document.createElement("a");e.href="https://docs.google.com/document/d/1wQvGwQdaI8PuEjSWxKDDThVIoAlCYIxQOyfyi4o6HcM/edit?usp=sharing",e.title="Multiplayer Piano Rules",e.target="_blank";let t=document.createElement("button");t.style="height: 24px; font-size: 12px; background: #111; border: 1px solid #444; padding: 5px; cursor: pointer; line-height: 12px; border-radius: 2px; -webkit-border-radius: 2px; -moz-border-radius: 2px; overflow: hidden; white-space: nowrap; color: #fff; position: absolute; right: 6px; top: 0px; z-index: 20001;",t.innerText="Rules",e.appendChild(t),document.body.appendChild(e)}function T(){let e=decodeURIComponent(window.location.search).replace("?c=","");return"/"==e.substr(0,1)&&(e=e.substr(1)),e||(e=P("c")),e||(e="lobby"),e}var A,M=T();if("discord"===P("callback")){var _=P("code");_&&(A={type:"discord",code:_}),history.pushState({name:"lobby"},"Piano > lobby","/"),M="lobby"}var B=new Client(a.lsSettings.connectUrl??"wss://mppclone.com");A&&B.setLoginInfo(A),B.setChannel(M),B.on("disconnect",function(e){});var L,O,N,I,K=!0,R=!1,W=!1;window.addEventListener("focus",function(e){K=!0,R=!1,W=!1;var t=Object.keys(MPP.client.ppl).length;document.title=t>0?"Piano ("+t+")":"Multiplayer Piano"}),window.addEventListener("blur",function(e){K=!1}),B.on("status",function(e){$("#status").text(e)}),B.on("count",function(e){if(e>0){if($("#status").html('<span class="number" translated>'+e+"</span> "+window.i18nextify.i18next.t("people are playing",{count:e})),!K&&(R||W))return;document.title="Piano ("+e+")"}else document.title="Multiplayer Piano"}),function(){let e=!1;B.on("hi",function(t){if(!e){e=!0,t.motd||(t.motd="This site makes a lot of sound! You may want to adjust the volume before continuing."),document.getElementById("motd-text").innerHTML=t.motd,Fe("#motd"),$(document).off("keydown",Ge);var i=function(e){((e.path||e.composedPath&&e.composedPath()).includes(document.getElementById("motd"))||e.target===document.getElementById("motd"))&&je(),document.removeEventListener("click",i),f.audio.resume()};document.addEventListener("click",i),B.permissions.clearChat&&$("#clearchat-btn").show(),B.permissions.vanish?$("#vanish-btn").show():$("#vanish-btn").hide()}})}(),function(){function e(e){var i;Boolean(e.nameDiv)?(i=e.nameDiv,$(i).empty()):((i=document.createElement("div")).addEventListener("mousedown",e=>L(e,i)),i.addEventListener("touchstart",e=>L(e,i)),i.style.display="none",$(i).fadeIn(2e3),i.id="namediv-"+e._id,i.className="name",i.participantId=e.id,$("#names")[0].appendChild(i),e.nameDiv=i),i.style.backgroundColor=e.color||"#777";var o="object"==typeof e.tag?e.tag.text:e.tag;"BOT"===o&&(i.title="This is an authorized bot."),"MOD"===o&&(i.title="This user is an official moderator of the site."),"ADMIN"===o&&(i.title="This user is an official administrator of the site."),"OWNER"===o&&(i.title="This user is the owner of the site."),"MEDIA"===o&&(i.title="This is a well known person on Twitch, Youtube, or another platform."),"DEV"===o&&(i.title="This user has contributed code to the site."),t(e);var a=!1;if(e.vanished){a=!0;var s=document.createElement("div");s.className="nametag",s.textContent="VANISH",s.style.backgroundColor="#00ffcc",s.id="namevanish-"+e._id,e.nameDiv.appendChild(s)}if(e.tag){a=!0;var r=document.createElement("div");r.className="nametag",r.textContent=o||"",r.style.backgroundColor=n(e.tag),r.id="nametag-"+e._id,e.nameDiv.appendChild(r)}if(e.afk){var l=document.createElement("div");l.className="nametag",l.textContent="AFK",l.style.backgroundColor="#00000040",l.style["margin-left"]="5px",l.style["margin-right"]="0px",l.style.float="right",l.id="afktag-"+e._id,e.nameDiv.appendChild(l)}var c=document.createElement("div");c.className="nametext",c.textContent=e.name||"",c.id="nametext-"+e._id,a&&(c.style.float="left"),e.nameDiv.appendChild(c),e.nameDiv.setAttribute("translated","");var d=$("#names .name");d.sort(function(e,t){return e.id>t.id?1:e.id<t.id?-1:0}),$("#names").html(d)}function t(e){e.id===B.participantId?$(e.nameDiv).addClass("me"):$(e.nameDiv).removeClass("me"),B.channel.crown&&B.channel.crown.participantId===e.id?($(e.nameDiv).addClass("owner"),$(e.cursorDiv).addClass("owner")):($(e.nameDiv).removeClass("owner"),$(e.cursorDiv).removeClass("owner")),-1!==z.indexOf(e._id)?$(e.nameDiv).addClass("muted-notes"):$(e.nameDiv).removeClass("muted-notes"),-1!==V.indexOf(e._id)?$(e.nameDiv).addClass("muted-chat"):$(e.nameDiv).removeClass("muted-chat")}function n(e){return"object"==typeof e?e.color:"BOT"===e?"#55f":"OWNER"===e?"#a00":"ADMIN"===e?"#f55":"MOD"===e?"#0a0":"MEDIA"===e?"#f5f":"#777"}function o(e){let t=B.ppl[e.id];ue(t)||t&&t.cursorDiv&&(Z?t.cursorDiv.style.transform="translate3d("+e.x+"vw, "+e.y+"vh, 0)":(t.cursorDiv.style.left=e.x+"%",t.cursorDiv.style.top=e.y+"%"))}B.on("participant added",function(t){if(!ue(t)){t.displayX=150,t.displayY=50;var o="object"==typeof t.tag?t.tag.text:t.tag;if(e(t),B.participantId===t.id&&!i||ne.includes(t.id)||oe)t.cursorDiv=void 0;else{var a;if((a=document.createElement("div")).className="cursor",a.style.display="none",t.cursorDiv=$("#cursors")[0].appendChild(a),$(t.cursorDiv).fadeIn(2e3),(a=document.createElement("div")).className="name",a.style.backgroundColor=t.color||"#777",t.tag){var s=document.createElement("span");s.className="curtag",s.textContent=o||"",s.style.backgroundColor=n(t.tag),s.id="nametag-"+t._id,a.appendChild(s)}var r=document.createElement("span");r.className="nametext",r.textContent=t.name||"",a.setAttribute("translated",""),a.appendChild(r),t.cursorDiv.appendChild(a)}}}),B.on("participant removed",function(e){if(!ue(e)){var t=$(e.nameDiv),i=$(e.cursorDiv);i.fadeOut(2e3),t.fadeOut(2e3,function(){t.remove(),i.remove(),e.nameDiv=void 0,e.cursorDiv=void 0})}}),B.on("participant update",function(t){if(!ue(t)){var i=t.name||"",n=t.color||"#777";e(t),$(t.cursorDiv).find(".name .nametext").text(i),$(t.cursorDiv).find(".name").css("background-color",n)}}),B.on("ch",function(e){for(var i in B.ppl){if(B.ppl.hasOwnProperty(i))t(B.ppl[i])}}),B.on("participant added",function(e){ue(e)||t(e)}),B.on("m",o),B.on("participant added",o)}(),N=$('<div id="crown"></div>').appendTo(document.body).hide(),I=$("<span></span>").appendTo(N),N.click(function(){B.sendArray([{m:"chown",id:B.participantId}])}),B.on("ch",function(e){if(e.ch.crown){var t=e.ch.crown;if(t.participantId&&B.ppl[t.participantId])N.hide();else{var i=t.time+2e3-B.serverTimeOffset,n=t.time+15e3-B.serverTimeOffset;I.text(""),N.show(),i-Date.now()<=0?N.css({left:t.endPos.x+"%",top:t.endPos.y+"%"}):(N.css({left:t.startPos.x+"%",top:t.startPos.y+"%"}),N.addClass("spin"),N.animate({left:t.endPos.x+"%",top:t.endPos.y+"%"},2e3,"linear",function(){N.removeClass("spin")})),clearInterval(O),O=setInterval(function(){var e=Date.now();if(e>=i){var t=n-e;t>0?I.text(Math.ceil(t/1e3)+"s"):(I.text(""),clearInterval(O))}},1e3)}}else N.hide()}),B.on("disconnect",function(){N.fadeOut(2e3)}),B.on("n",function(e){var t=e.t-B.serverTimeOffset+1e3-Date.now(),i=B.findParticipantById(e.p);if(-1===z.indexOf(i._id))for(var n=0;n<e.n.length;n++){var s=e.n[n],r=t+(s.d||0);if(r<0)r=0;else if(r>1e4)continue;if(s.s)f.stop(s.n,i,r);else{var l=void 0!==s.v?parseFloat(s.v):o;l?l<0?l=0:l>1&&(l=1):l=0,a.lsSettings.enableBufferedBlips?f.bufferPlay(s.n,l,i,r):f.play(s.n,l,i,r),nt&&f.stop(s.n,i,r+1e3)}}});var H=0,G=-10,F=0,j=-10;setInterval(function(){if(Math.abs(H-G)>.1||Math.abs(F-j)>.1){G=H,j=F,B.sendArray([{m:"m",x:H,y:F}]),i&&B.emit("m",{m:"m",id:B.participantId,x:H,y:F});var e=B.getOwnParticipant();e&&(e.x=H,e.y=F)}},50),$(document).mousemove(function(e){H=(e.pageX/$(window).width()*100).toFixed(2),F=(e.pageY/$(window).height()*100).toFixed(2)}),B.on("ch",function(e){B.isOwner()||B.permissions.chsetAnywhere?$("#room-settings-btn").show():$("#room-settings-btn").hide(),B.channel.settings.lobby||!B.permissions.chownAnywhere&&B.channel.settings.owner_id!==B.user._id?$("#getcrown-btn").hide():$("#getcrown-btn").show()}),$("#room-settings-btn").click(function(e){if(B.channel&&(B.isOwner()||B.permissions.chsetAnywhere)){var t=B.channel.settings;Fe("#room-settings"),setTimeout(function(){$("#room-settings .checkbox[name=visible]").prop("checked",t.visible),$("#room-settings .checkbox[name=chat]").prop("checked",t.chat),$("#room-settings .checkbox[name=crownsolo]").prop("checked",t.crownsolo),$("#room-settings .checkbox[name=nocussing]").prop("checked",t["no cussing"]),$("#room-settings input[name=color]").val(t.color),$("#room-settings input[name=color2]").val(t.color2),$("#room-settings .checkbox[name=noindex]").prop("checked",t.noindex),$("#room-settings .checkbox[name=allowBots]").prop("checked",t.allowBots),$("#room-settings input[name=limit]").val(t.limit)},100)}}),$("#room-settings .submit").click(function(){var e={visible:$("#room-settings .checkbox[name=visible]").is(":checked"),chat:$("#room-settings .checkbox[name=chat]").is(":checked"),crownsolo:$("#room-settings .checkbox[name=crownsolo]").is(":checked"),"no cussing":$("#room-settings .checkbox[name=nocussing]").is(":checked"),noindex:$("#room-settings .checkbox[name=noindex]").is(":checked"),allowBots:$("#room-settings .checkbox[name=allowBots]").is(":checked"),color:$("#room-settings input[name=color]").val(),color2:$("#room-settings input[name=color2]").val(),limit:$("#room-settings input[name=limit]").val()};B.setChannelSettings(e),je()}),$("#room-settings .drop-crown").click(function(){je(),confirm("This will drop the crown...!")&&B.sendArray([{m:"chown"}])}),$("#clearchat-btn").click(function(e){confirm("Are you sure you want to clear chat?")&&B.sendArray([{m:"clearchat"}])}),$("#getcrown-btn").click(function(e){B.sendArray([{m:"chown",id:MPP.client.getOwnParticipant().id}])}),$("#vanish-btn").click(function(e){B.sendArray([{m:"v",vanish:!B.getOwnParticipant().vanished}])}),B.on("participant update",e=>{e._id===B.getOwnParticipant()._id&&(e.vanished?$("#vanish-btn").text("Unvanish"):$("#vanish-btn").text("Vanish"))}),B.on("participant added",e=>{e._id===B.getOwnParticipant()._id&&(e.vanished?$("#vanish-btn").text("Unvanish"):$("#vanish-btn").text("Vanish"))}),B.on("notification",function(e){new Ke(e)}),B.on("ch",function(e){var t=e.ch._id.toLowerCase();"spin"===t||"/spin"===t.substr(-5)?$("#piano").addClass("spin"):$("#piano").removeClass("spin")}),B.on("ch",function(e){let t="",i=!1;e.ch.settings.crownsolo&&(i=!0,t+='<p>This room is set to "only the owner can play."</p>'),e.ch.settings["no cussing"]&&(i=!0,t+='<p>This room is set to "no cussing."</p>');let n=$("#room-notice");i?(n.html(t),n.is(":hidden")&&n.fadeIn(1e3)):n.is(":visible")&&n.fadeOut(1e3)}),B.on("disconnect",function(){$("#room-notice").fadeOut(1e3)});var z=(localStorage.pianoMutes?localStorage.pianoMutes:"").split(",").filter(e=>e),V=(localStorage.chatMutes?localStorage.chatMutes:"").split(",").filter(e=>e),U="true"==localStorage.showIdsInChat,Y="true"==localStorage.showTimestampsInChat,q="true"==localStorage.noChatColors,X="true"==localStorage.noBackgroundColor,J=!localStorage.outputOwnNotes||"true"==localStorage.outputOwnNotes,Q="true"==localStorage.virtualPianoLayout,Z="true"==localStorage.smoothCursor,ee="true"==localStorage.showChatTooltips,te="true"==localStorage.showPianoNotes,ie=localStorage.highlightScaleNotes,ne=(localStorage.cursorHides?localStorage.cursorHides:"").split(",").filter(e=>e),oe="true"==localStorage.hideAllCursors,ae="true"==localStorage.hidePiano,se="true"==localStorage.hideChat,re="true"==localStorage.noPreventDefault,le="true"==localStorage.hideBotUsers,ce=11===(new Date).getMonth()&&"false"!==localStorage.snowflakes,de=!localStorage.disableMIDIDrumChannel||"true"==localStorage.disableMIDIDrumChannel;function he(){let e=document.querySelector(".snowflakes");e.style.visibility=ce?"visible":"hidden"}function ue(e){return!!le&&(e?!(!e.tag||"BOT"!==e.tag.text):void 0)}he(),ae?$("#piano").hide():$("#piano").show(),se?$("#chat").hide():$("#chat").show(),Z?$("#cursors").attr("smooth-cursors",""):$("#cursors").removeAttr("smooth-cursors"),function(){new Color("#000000"),new Color("#000000");function e(e,t){var i=new Color(e),n=new Color(t||e);t||n.add(-64,-64,-64);var o=document.getElementById("bottom");document.body.style.setProperty("--color",i.toHexa()),document.body.style.setProperty("--color2",n.toHexa()),o.style.setProperty("--color",i.toHexa()),o.style.setProperty("--color2",n.toHexa())}function t(){e("#220022","#000022")}window.setBackgroundColor=e,window.setBackgroundColorToDefault=t,t(),B.on("ch",function(i){X?t():i.ch.settings&&(i.ch.settings.color?e(i.ch.settings.color,i.ch.settings.color2):t())})}();var me=document.getElementById("volume-slider");me.value=f.audio.volume,$("#volume-label").text("Volume: "+Math.floor(100*f.audio.volume)+"%"),me.addEventListener("input",function(e){var t=+me.value;f.audio.setVolume(t),window.localStorage&&(localStorage.volume=t),$("#volume-label").text("Volume: "+Math.floor(100*t)+"%")});var pe=function(e,t){this.note=e,this.octave=t||0},fe=function(e,t){return{note:new pe(e,t),held:!1}},ge={MPP:{65:fe("gs"),90:fe("a"),83:fe("as"),88:fe("b"),67:fe("c",1),70:fe("cs",1),86:fe("d",1),71:fe("ds",1),66:fe("e",1),78:fe("f",1),74:fe("fs",1),77:fe("g",1),75:fe("gs",1),188:fe("a",1),76:fe("as",1),190:fe("b",1),191:fe("c",2),222:fe("cs",2),49:fe("gs",1),81:fe("a",1),50:fe("as",1),87:fe("b",1),69:fe("c",2),52:fe("cs",2),82:fe("d",2),53:fe("ds",2),84:fe("e",2),89:fe("f",2),55:fe("fs",2),85:fe("g",2),56:fe("gs",2),73:fe("a",2),57:fe("as",2),79:fe("b",2),80:fe("c",3),189:fe("cs",3),173:fe("cs",3),219:fe("d",3),187:fe("ds",3),61:fe("ds",3),221:fe("e",3)},VP:{112:fe("c",-1),113:fe("d",-1),114:fe("e",-1),115:fe("f",-1),116:fe("g",-1),117:fe("a",-1),118:fe("b",-1),49:fe("c"),50:fe("d"),51:fe("e"),52:fe("f"),53:fe("g"),54:fe("a"),55:fe("b"),56:fe("c",1),57:fe("d",1),48:fe("e",1),81:fe("f",1),87:fe("g",1),69:fe("a",1),82:fe("b",1),84:fe("c",2),89:fe("d",2),85:fe("e",2),73:fe("f",2),79:fe("g",2),80:fe("a",2),65:fe("b",2),83:fe("c",3),68:fe("d",3),70:fe("e",3),71:fe("f",3),72:fe("g",3),74:fe("a",3),75:fe("b",3),76:fe("c",4),90:fe("d",4),88:fe("e",4),67:fe("f",4),86:fe("g",4),66:fe("a",4),78:fe("b",4),77:fe("c",5)}},ve=Q?ge.VP:ge.MPP,we=!1,ye=0;function be(e){if(e.target.type)return;var t=parseInt(e.keyCode);let i=Object.keys(f.keys);if(void 0!==ve[t]){var n=ve[t];if(!n.held){n.held=!0;var o=n.note,a=1+o.octave;Q||(e.shiftKey?++a:we||e.ctrlKey?--a:e.altKey&&(a+=2)),o=o.note+a;var s=i.indexOf(o);if(void 0===(o=Q&&e.shiftKey?i[s+ye+1]:i[s+ye]))return;C(o,Me())}return 3==++We&&(He=!0,window.gKnowsYouCanUseKeyboardTimeout&&clearTimeout(gKnowsYouCanUseKeyboardTimeout),localStorage&&(localStorage.knowsYouCanUseKeyboard=!0),window.gKnowsYouCanUseKeyboardNotification&&gKnowsYouCanUseKeyboardNotification.close()),re||e.preventDefault(),e.stopPropagation(),!1}20==t?(we=!0,re||e.preventDefault()):32===t?(E(),re||e.preventDefault()):38===t&&ye<=100?(ye+=12,xe()):40===t&&ye>=-100?(ye-=12,xe()):39===t&&ye<100?(ye++,xe()):37===t&&ye>-100?(ye--,xe()):9==t?re||e.preventDefault():8==t&&(v=!v,re||e.preventDefault())}function xe(){new Ke({title:"Transposing",html:"Transpose level: "+ye,target:"#midi-btn",duration:1500})}function ke(e){if(e.target.type)return;var t=parseInt(e.keyCode);let i=Object.keys(f.keys);if(void 0!==ve[t]){var n=ve[t];if(n.held){n.held=!1;var o=n.note,a=1+o.octave;Q||(e.shiftKey?++a:we||e.ctrlKey?--a:e.altKey&&(a+=2)),o=o.note+a;var s=i.indexOf(o);if(void 0===(o=Q&&e.shiftKey?i[s+ye+1]:i[s+ye]))return;S(o)}return re||e.preventDefault(),e.stopPropagation(),!1}20==t?(we=!1,re||e.preventDefault()):32===t&&(D(),re||e.preventDefault())}function $e(e){if(!e.target.type)return re||e.preventDefault(),e.stopPropagation(),27==e.keyCode||e.keyCode,!1}var Ce=function(e){Ee()},Se=!1;function Ee(){Se||(Se=!0,$("#piano").off("mousedown",Ce),$("#piano").off("touchstart",Ce),$(document).on("keydown",be),$(document).on("keyup",ke),$(window).on("keypress",$e))}function De(){Se&&(Se=!1,$(document).off("keydown",be),$(document).off("keyup",ke),$(window).off("keypress",$e),$("#piano").on("mousedown",Ce),$("#piano").on("touchstart",Ce))}Ee();var Pe,Te,Ae,Me=function(){return.1+F/100*.6},_e=(Pe=0,Te=$("#quota .value"),new NoteQuota(function(e){var t=e/this.max*100;t<=Pe?Te.stop(!0,!0).css("width",t.toFixed(0)+"%"):Te.stop(!0,!0).animate({width:t.toFixed(0)+"%"},2e3,"linear"),Pe=t}));a.lsSettings.forceInfNoteQuota?(B.on("nq",function(e){_e.setParams(NoteQuota.PARAMS_INFINITE)}),B.on("disconnect",function(){_e.setParams(NoteQuota.PARAMS_INFINITE)})):(B.on("nq",function(e){_e.setParams(e)}),B.on("disconnect",function(){_e.setParams(NoteQuota.PARAMS_OFFLINE)}));var Be,Le=!1,Oe="true"===localStorage.knowsHowToDm;B.on("participant removed",e=>{Le&&e._id===Ae._id&&(Ye.endDM(),Ye.endDM())});var Ne,Ie=!1;B.on("participant removed",e=>{Ie&&e._id===Be._id&&MPP.chat.cancelReply()}),function(){L=function(e,t){var n=t,o=$(n);if(o&&o.hasClass("name")){o.addClass("play");var a=n.participantId;if(a==B.participantId)Fe("#rename","input[name=name]"),setTimeout(function(){$("#rename input[name=name]").val(B.ppl[B.participantId].name),$("#rename input[name=color]").val(B.ppl[B.participantId].color)},100);else if(a){var s=B.ppl[a]||null;s&&(i(s),e.stopPropagation())}}};var e=function(e){$("#names .name").removeClass("play")};document.body.addEventListener("mouseup",e),document.body.addEventListener("touchend",e);var t=function(){$(".participant-menu").remove(),$(".participantSpotlight").hide(),document.removeEventListener("mousedown",t),document.removeEventListener("touchstart",t)},i=function(e){if(e){t(),document.addEventListener("mousedown",t),document.addEventListener("touchstart",t),$("#"+e.id).find(".enemySpotlight").show();var i=$('<div class="participant-menu"></div>');$("body").append(i);var n=$(e.nameDiv),o=n.position();i.css({top:o.top+n.height()+15,left:o.left+6,background:e.color||"black"}),i.on("mousedown touchstart",function(e){e.stopPropagation();var n=$(e.target);n.hasClass("menu-item")&&(n.addClass("clicked"),i.fadeOut(200,function(){t()}))}),$('<div class="info"></div>').appendTo(i).text(e._id).on("mousedown touchstart",t=>{navigator.clipboard.writeText(e._id),t.target.innerText="Copied!",setTimeout(()=>{t.target.innerText=e._id},2500)}),-1==z.indexOf(e._id)?$(`<div class="menu-item">${window.i18nextify.i18next.t("Mute Notes")}</div>`).appendTo(i).on("mousedown touchstart",function(t){z.push(e._id),localStorage&&(localStorage.pianoMutes=z.join(",")),$(e.nameDiv).addClass("muted-notes")}):$(`<div class="menu-item">${window.i18nextify.i18next.t("Unmute Notes")}</div>`).appendTo(i).on("mousedown touchstart",function(t){for(var i;-1!=(i=z.indexOf(e._id));)z.splice(i,1);localStorage&&(localStorage.pianoMutes=z.join(",")),$(e.nameDiv).removeClass("muted-notes")}),-1==V.indexOf(e._id)?$(`<div class="menu-item">${window.i18nextify.i18next.t("Mute Chat")}</div>`).appendTo(i).on("mousedown touchstart",function(t){V.push(e._id),localStorage&&(localStorage.chatMutes=V.join(",")),$(e.nameDiv).addClass("muted-chat")}):$(`<div class="menu-item">${window.i18nextify.i18next.t("Unmute Chat")}</div>`).appendTo(i).on("mousedown touchstart",function(t){for(var i;-1!=(i=V.indexOf(e._id));)V.splice(i,1);localStorage&&(localStorage.chatMutes=V.join(",")),$(e.nameDiv).removeClass("muted-chat")}),z.indexOf(e._id)>=0&&V.indexOf(e._id)>=0||$(`<div class="menu-item">${window.i18nextify.i18next.t("Mute Completely")}</div>`).appendTo(i).on("mousedown touchstart",function(t){z.push(e._id),localStorage&&(localStorage.pianoMutes=z.join(",")),V.push(e._id),localStorage&&(localStorage.chatMutes=V.join(",")),$(e.nameDiv).addClass("muted-notes"),$(e.nameDiv).addClass("muted-chat")}),(z.indexOf(e._id)>=0||V.indexOf(e._id)>=0)&&$(`<div class="menu-item">${window.i18nextify.i18next.t("Unmute Completely")}</div>`).appendTo(i).on("mousedown touchstart",function(t){for(var i;-1!=(i=z.indexOf(e._id));)z.splice(i,1);for(;-1!=(i=V.indexOf(e._id));)V.splice(i,1);localStorage&&(localStorage.pianoMutes=z.join(",")),localStorage&&(localStorage.chatMutes=V.join(",")),$(e.nameDiv).removeClass("muted-notes"),$(e.nameDiv).removeClass("muted-chat")}),Le&&Ae._id===e._id?$(`<div class="menu-item">${window.i18nextify.i18next.t("End Direct Message")}</div>`).appendTo(i).on("mousedown touchstart",function(e){Ye.endDM()}):$(`<div class="menu-item">${window.i18nextify.i18next.t("Direct Message")}</div>`).appendTo(i).on("mousedown touchstart",function(t){Oe||(localStorage.knowsHowToDm=!0,Oe=!0,new Ke({target:"#piano",duration:2e4,title:window.i18nextify.i18next.t("How to DM"),text:window.i18nextify.i18next.t("After you click the button to direct message someone, future chat messages will be sent to them instead of to everyone. To go back to talking in public chat, send a blank chat message, or click the button again.")})),Ye.startDM(e)}),-1==ne.indexOf(e._id)?$(`<div class="menu-item">${window.i18nextify.i18next.t("Hide Cursor")}</div>`).appendTo(i).on("mousedown touchstart",function(t){ne.push(e._id),localStorage&&(localStorage.cursorHides=ne.join(",")),$(e.cursorDiv).hide()}):$(`<div class="menu-item">${window.i18nextify.i18next.t("Show Cursor")}</div>`).appendTo(i).on("mousedown touchstart",function(t){for(var i;-1!=(i=ne.indexOf(e._id));)ne.splice(i,1);localStorage&&(localStorage.cursorHides=ne.join(",")),$(e.cursorDiv).show()}),$(`<div class="menu-item">${window.i18nextify.i18next.t("Mention")}</div>`).appendTo(i).on("mousedown touchstart",function(t){$("#chat-input")[0].value+="@"+e.id+" ",setTimeout(()=>{$("#chat-input").focus()},1)}),(B.isOwner()||B.permissions.chownAnywhere)&&(B.channel.settings.lobby||$(`<div class="menu-item give-crown">${window.i18nextify.i18next.t("Give Crown")}</div>`).appendTo(i).on("mousedown touchstart",function(t){confirm("Give room ownership to "+e.name+"?")&&B.sendArray([{m:"chown",id:e.id}])}),$(`<div class="menu-item kickban">${window.i18nextify.i18next.t("Kickban")}</div>`).appendTo(i).on("mousedown touchstart",function(t){var i=prompt("How many minutes? (0-300)","30");if(null!==i){var n=60*(i=parseFloat(i)||0)*1e3;B.sendArray([{m:"kickban",_id:e._id,ms:n}])}})),B.permissions.siteBan&&$(`<div class="menu-item site-ban">${window.i18nextify.i18next.t("Site Ban")}</div>`).appendTo(i).on("mousedown touchstart",function(t){Fe("#siteban"),setTimeout(function(){$("#siteban input[name=id]").val(e._id),$("#siteban input[name=reasonText]").val("Discrimination against others"),$("#siteban input[name=reasonText]").attr("disabled",!0),$("#siteban select[name=reasonSelect]").val("Discrimination against others"),$("#siteban input[name=durationNumber]").val(5),$("#siteban input[name=durationNumber]").attr("disabled",!1),$("#siteban select[name=durationUnit]").val("hours"),$("#siteban textarea[name=note]").val(""),$("#siteban p[name=errorText]").text(""),B.permissions.siteBanAnyReason?$("#siteban select[name=reasonSelect] option[value=custom]").attr("disabled",!1):$("#siteban select[name=reasonSelect] option[value=custom]").attr("disabled",!0)},100)}),B.permissions.usersetOthers&&$(`<div class="menu-item set-color">${window.i18nextify.i18next.t("Set Color")}</div>`).appendTo(i).on("mousedown touchstart",function(t){var i=prompt("What color?",e.color);null!==i&&B.sendArray([{m:"setcolor",_id:e._id,color:i}])}),B.permissions.usersetOthers&&$(`<div class="menu-item set-name">${window.i18nextify.i18next.t("Set Name")}</div>`).appendTo(i).on("mousedown touchstart",function(t){var i=prompt("What name?",e.name);null!==i&&B.sendArray([{m:"setname",_id:e._id,name:i}])}),i.fadeIn(100)}}}();class Ke extends EventEmitter{constructor(e){if(super(),this instanceof Ke==!1)throw"yeet";e=e||{};this.id="Notification-"+(e.id||Math.random()),this.title=e.title||"",this.text=e.text||"",this.html=e.html||"",this.target=$(e.target||"#piano"),this.duration=e.duration||3e4,this.class=e.class||"classic";var t=this,i=$("#"+this.id);return i.length>0&&i.remove(),this.domElement=$('<div class="notification"><div class="notification-body"><div class="title"></div><div class="text"></div></div><div class="x" translated>X</div></div>'),this.domElement[0].id=this.id,this.domElement.addClass(this.class),this.domElement.find(".title").text(this.title),this.text.length>0?this.domElement.find(".text").text(this.text):this.html instanceof HTMLElement?this.domElement.find(".text")[0].appendChild(this.html):this.html.length>0&&this.domElement.find(".text").html(this.html),document.body.appendChild(this.domElement.get(0)),this.position(),this.onresize=function(){t.position()},window.addEventListener("resize",this.onresize),this.domElement.find(".x").click(function(){t.close()}),this.duration>0&&setTimeout(function(){t.close()},this.duration),this}position(){var e=this.target.offset(),t=e.left-this.domElement.width()/2+this.target.width()/4,i=e.top-this.domElement.height()-8,n=this.domElement.width();t+n>$("body").width()&&(t-=t+n-$("body").width()),t<0&&(t=0),this.domElement.offset({left:t,top:i})}close(){window.removeEventListener("resize",this.onresize),this.domElement.fadeOut(500,()=>{this.domElement.remove(),this.emit("close")})}}var Re,We=0,He=!1;function Ge(e){27==e.keyCode&&(je(),re||e.preventDefault(),e.stopPropagation())}function Fe(e,t){Ye&&Ye.blur(),De(),$(document).on("keydown",Ge),$("#modal #modals > *").hide(),$("#modal").fadeIn(250),$(e).show(),setTimeout(function(){$(e).find(t).focus()},100),Re=e}function je(){$(document).off("keydown",Ge),$("#modal").fadeOut(100),$("#modal #modals > *").hide(),Ee(),Re=null}localStorage&&localStorage.knowsYouCanUseKeyboard&&(He=!0),He||(window.gKnowsYouCanUseKeyboardTimeout=setTimeout(function(){window.gKnowsYouCanUseKeyboardNotification=new Ke({title:window.i18nextify.i18next.t("Did you know!?!"),text:window.i18nextify.i18next.t("You can play the piano with your keyboard, too.  Try it!"),target:"#piano",duration:1e4})},3e4)),window.localStorage&&(localStorage.volume?(me.value=localStorage.volume,f.audio.setVolume(localStorage.volume),$("#volume-label").html(window.i18nextify.i18next.t("Volume")+"<span translated>: "+Math.floor(100*f.audio.volume)+"%</span>")):localStorage.volume=f.audio.volume,window.gHasBeenHereBefore=localStorage.gHasBeenHereBefore||!1,gHasBeenHereBefore,localStorage.gHasBeenHereBefore=!0),$("#room > .info").text("--"),B.on("ch",function(e){var t=e.ch,i=$("#room > .info");i.text(t._id),t.settings.lobby?i.addClass("lobby"):i.removeClass("lobby"),t.settings.chat?i.removeClass("no-chat"):i.addClass("no-chat"),t.settings.crownsolo?i.addClass("crownsolo"):i.removeClass("crownsolo"),t.settings["no cussing"]?i.addClass("no-cussing"):i.removeClass("no-cussing"),t.settings.visible?i.removeClass("not-visible"):i.addClass("not-visible")}),B.on("ls",function(e){for(var t in e.u)if(e.u.hasOwnProperty(t)){var i=e.u[t],n=$('#room .info[roomid="'+(i.id+"").replace(/[\\"']/g,"\\$&").replace(/\u0000/g,"\\0")+'"]');0==n.length&&((n=$('<div class="info"></div>')).attr("roomname",i._id),n.attr("roomid",i.id),$("#room .more").append(n)),n.attr("translated",""),n.text(i.count+"/"+("limit"in i.settings?i.settings.limit:20)+" "+i._id),i.settings.lobby?n.addClass("lobby"):n.removeClass("lobby"),i.settings.chat?n.removeClass("no-chat"):n.addClass("no-chat"),i.settings.crownsolo?n.addClass("crownsolo"):n.removeClass("crownsolo"),i.settings["no cussing"]?n.addClass("no-cussing"):n.removeClass("no-cussing"),i.settings.visible?n.removeClass("not-visible"):n.addClass("not-visible"),i.banned?n.addClass("banned"):n.removeClass("banned")}}),$("#room").on("click",function(e){if(e.stopPropagation(),$(e.target).hasClass("info")&&$(e.target).parents(".more").length){$("#room .more").fadeOut(250);var t=$(e.target).attr("roomname");return void 0!==t&&Ve(t,"right"),!1}$(e.target).hasClass("new")&&Fe("#new-room","input[name=name]");var i=function(e){$(e.target).is("#room .more")||($(document).off("mousedown",i),$("#room .more").fadeOut(250),B.sendArray([{m:"-ls"}]))};$(document).on("mousedown",i),$("#room .more .info").remove(),$("#room .more").show(),B.sendArray([{m:"+ls"}])}),$("#new-room-btn").on("click",function(e){e.stopPropagation(),Fe("#new-room","input[name=name]")}),$("#play-alone-btn").on("click",function(e){e.stopPropagation(),Ve("Room"+Math.floor(1e12*Math.random()),"right",{visible:!1}),setTimeout(function(){new Ke({id:"share",title:window.i18nextify.i18next.t("Playing alone"),html:window.i18nextify.i18next.t("You are playing alone in a room by yourself, but you can always invite friends by sending them the link.")+'<br><a href="'+location.href+'">'+location.href+"</a>",duration:25e3})},1e3)}),$("#account-btn").on("click",function(e){e.stopPropagation(),Fe("#account"),B.accountInfo?($("#account #account-info").show(),"discord"===B.accountInfo.type&&($("#account #avatar-image").prop("src",B.accountInfo.avatar),$("#account #logged-in-user-text").text(B.accountInfo.username+"#"+B.accountInfo.discriminator))):$("#account #account-info").hide()});var ze=$("#modal .bg")[0];function Ve(e,t,i,n){i||(i={}),t||(t="right"),void 0===n&&(n=!0);var o="left"==t?"right":"left";if(e||(e="lobby"),!B.channel||B.channel._id!==e){if(n){let t="/?c="+encodeURIComponent(e).replace("'","%27");if(!window.history||!history.pushState)return void(window.location=t);history.pushState({depth:Ue+=1,name:e},"Piano > "+e,t)}B.setChannel(e,i);var a=0;$("#piano").addClass("ease-out").addClass("slide-"+o),setTimeout(function(){$("#piano").removeClass("ease-out").removeClass("slide-"+o).addClass("slide-"+t)},a+=100),setTimeout(function(){$("#piano").addClass("ease-in").removeClass("slide-"+t)},a+=100),setTimeout(function(){$("#piano").removeClass("ease-in")},a+=100)}}$(ze).on("click",function(e){e.target==ze&&je()}),function(){function e(){var e=$("#new-room .text[name=name]").val(),t={visible:$("#new-room .checkbox[name=visible]").is(":checked"),chat:!0};$("#new-room .text[name=name]").val(""),je(),Ve(e,"right",t),setTimeout(function(){new Ke({id:"share",title:window.i18nextify.i18next.t("Created a Room"),html:window.i18nextify.i18next.t("You can invite friends to your room by sending them the link.")+'<br><a href="'+location.href+'">'+location.href+"</a>",duration:25e3})},1e3)}$("#new-room .submit").click(function(t){e()}),$("#new-room .text[name=name]").keypress(function(t){if(13==t.keyCode)e();else{if(27!=t.keyCode)return;je()}return re||t.preventDefault(),t.stopPropagation(),!1})}();var Ue=0;$(window).on("popstate",function(e){var t=e.state?e.state.depth:0,i=t<=Ue?"left":"right";Ue=t,Ve(T(),i,null,!1)}),function(){function e(){var e={name:$("#rename input[name=name]").val(),color:$("#rename input[name=color]").val()};je(),B.sendArray([{m:"userset",set:e}])}$("#rename .submit").click(function(t){e()}),$("#rename .text[name=name]").keypress(function(t){if(13==t.keyCode)e();else{if(27!=t.keyCode)return;je()}return re||t.preventDefault(),t.stopPropagation(),!1})}(),function(){function e(){var e={m:"siteban"};e.id=$("#siteban .text[name=id]").val();var t,i=$("#siteban select[name=durationUnit]").val();if("permanent"===i){if(!B.permissions.siteBanAnyDuration)return void $("#siteban p[name=errorText]").text("You don't have permission to ban longer than 1 month. Contact a higher staff to ban the user for longer.");e.permanent=!0}else{var n=0;switch(i){case"seconds":n=1e3;break;case"minutes":n=6e4;break;case"hours":n=36e5;break;case"days":n=864e5;break;case"weeks":n=6048e5;break;case"months":n=2592e6;break;case"years":n=31536e6}var o=n*parseFloat($("#siteban input[name=durationNumber]").val());if(o<0)return void $("#siteban p[name=errorText]").text("Invalid duration.");if(o>2592e6&&!B.permissions.siteBanAnyDuration)return void $("#siteban p[name=errorText]").text("You don't have permission to ban longer than 1 month. Contact a higher staff to ban the user for longer.");e.duration=o}if("custom"===$("#siteban select[name=reasonSelect]").val()){if(0===(t=$("#siteban .text[name=reasonText]").val()).length)return void $("#siteban p[name=errorText]").text("Please provide a reason.")}else t=$("#siteban select[name=reasonSelect]").val();e.reason=t;var a=$("#siteban textarea[name=note]").val();a&&(e.note=a),je(),B.sendArray([e])}function t(t){if(13==t.keyCode)e();else{if(27!=t.keyCode)return;je()}return re||t.preventDefault(),t.stopPropagation(),!1}$("#siteban .submit").click(function(t){e()}),$("#siteban select[name=reasonSelect]").change(function(e){"custom"===this.value?($("#siteban .text[name=reasonText]").attr("disabled",!1),$("#siteban .text[name=reasonText]").val("")):($("#siteban .text[name=reasonText]").attr("disabled",!0),$("#siteban .text[name=reasonText]").val(this.value))}),$("#siteban select[name=durationUnit]").change(function(e){"permanent"===this.value?$("#siteban .text[name=durationNumber]").attr("disabled",!0):$("#siteban .text[name=durationNumber]").attr("disabled",!1)}),$("#siteban .text[name=id]").keypress(t),$("#siteban .text[name=reasonText]").keypress(t),$("#siteban .text[name=note]").keypress(t)}(),$("#account .logout-btn").click(function(e){delete localStorage.token,delete B.accountInfo,B.stop(),B.start(),je()}),$("#account .login-discord").click(function(e){location.replace(encodeURI(`https://discord.com/api/oauth2/authorize?client_id=926633278100877393&redirect_uri=${location.origin}/?callback=discord&response_type=code&scope=identify email`))});for(var Ye=function(){B.on("ch",function(e){e.ch.settings.chat?Ye.show():Ye.hide()}),B.on("disconnect",function(e){}),B.on("c",function(e){if(Ye.clear(),e.c)for(var t=0;t<e.c.length;t++)Ye.receive(e.c[t])}),B.on("a",function(e){Ye.receive(e),a.receiveMessage(e)}),B.on("dm",function(e){Ye.receive(e)}),$("#chat input").on("focus",function(e){De(),$("#chat").addClass("chatting"),Ye.scrollToBottom()}),$(document).mousedown(function(e){!$("#chat").has(e.target).length>0&&Ye.blur()}),document.addEventListener("touchstart",function(e){for(var t in e.changedTouches){var i=e.changedTouches[t];!$("#chat").has(i.target).length>0&&Ye.blur()}}),$(document).on("keydown",function(e){$("#chat").hasClass("chatting")?27==e.keyCode?(Ye.blur(),re||e.preventDefault(),e.stopPropagation()):13==e.keyCode&&$("#chat input").focus():Re||27!=e.keyCode&&13!=e.keyCode||$("#chat input").focus()}),$("#chat input").on("keydown",function(e){if(13==e.keyCode){if(MPP.client.isConnected()){var t=$(this).val();0==t.length?(Le&&Ye.endDM(),Ie&&Ye.cancelReply(),setTimeout(function(){Ye.blur()},100)):(Ye.send(t),$(this).val(""),setTimeout(function(){Ye.blur()},100))}re||e.preventDefault(),e.stopPropagation()}else 27==e.keyCode?(Ye.blur(),re||e.preventDefault(),e.stopPropagation()):9==e.keyCode&&(re||e.preventDefault(),e.stopPropagation())});var e=[];return{startDM:function(e){Le=!0,Ae=e,$("#chat-input")[0].placeholder="Direct messaging "+e.name+"."},endDM:function(){Le=!1,$("#chat-input")[0].placeholder=window.i18nextify.i18next.t("You can chat with this thing.")},startReply:function(e,t){$(`#msg-${Ne}`).css({"background-color":"unset",border:"1px solid #00000000"}),Ie=!0,Be=e,Ne=t,$("#chat-input")[0].placeholder=`Replying to ${e.name}`},startDmReply:function(e,t){$(`#msg-${Ne}`).css({"background-color":"unset",border:"1px solid #00000000"}),Ie=!0,Le=!0,Ne=t,Be=e,Ae=e,$("#chat-input")[0].placeholder=`Replying to ${e.name} in a DM.`},cancelReply:function(){Le&&(Le=!1),Ie=!1,$(`#msg-${Ne}`).css({"background-color":"unset",border:"1px solid #00000000"}),$("#chat-input")[0].placeholder=window.i18nextify.i18next.t("You can chat with this thing.")},show:function(){$("#chat").fadeIn()},hide:function(){$("#chat").fadeOut()},clear:function(){$("#chat li").remove()},scrollToBottom:function(){var e=$("#chat ul").get(0);e.scrollTop=e.scrollHeight-e.clientHeight},blur:function(){$("#chat").hasClass("chatting")&&($("#chat input").get(0).blur(),$("#chat").removeClass("chatting"),Ye.scrollToBottom(),Ee())},send:function(e){Ie?Le?(B.sendArray([{m:"dm",reply_to:Ne,_id:Be._id,message:e}]),setTimeout(()=>{MPP.chat.cancelReply()},100)):(B.sendArray([{m:"a",reply_to:Ne,_id:Be._id,message:e}]),setTimeout(()=>{MPP.chat.cancelReply()},100)):Le?B.sendArray([{m:"dm",_id:Ae._id,message:e}]):B.sendArray([{m:"a",message:e}])},receive:function(t){if("dm"===t.m){if(-1!=V.indexOf(t.sender._id))return}else if(-1!=V.indexOf(t.p._id))return;var i=`<li id="msg-${t.id}">`,n=!1;"dm"===t.m&&t.sender._id!==B.user._id&&t.recipient._id!==B.user._id||(i+='<span class="reply"/>'),Y&&(i+='<span class="timestamp"/>'),"dm"===t.m&&(t.sender._id===B.user._id?i+='<span class="sentDm"/>':t.recipient._id===B.user._id?i+='<span class="receivedDm"/>':(i+='<span class="otherDm"/>',n=!0)),n?(U&&(i+='<span class="id"/>'),i+='<span class="name"/><span class="dmArrow"/>',U&&(i+='<span class="id2"/>'),i+='<span class="name2"/><span class="message"/>'):(U&&(i+='<span class="id"/>'),i+='<span class="name"/>',t.r&&(i+='<span class="replyLink"/>'),i+='<span class="message"/>');var o=$(i);if(o.find(".reply").text("➦"),t.r){var a=e.find(e=>e.id===t.r);K||a?.p?._id===B.user._id&&(document.title="You have received a reply!",W=!0),a?(o.find(".replyLink").text(`➥ ${"dm"===a.m?a.sender.name:a.p.name}`),o.find(".replyLink").css({background:`${("dm"===a?.m?a?.sender?.color:a?.p?.color)??"gray"}`}),o.find(".replyLink").on("click",e=>{$("#chat-input").focus(),document.getElementById(`msg-${a?.id}`).scrollIntoView({behavior:"smooth"}),$(`#msg-${a?.id}`).css({border:`1px solid ${"dm"===a?.m?a.sender?.color:a.p?.color}80`,"background-color":`${"dm"===a?.m?a.sender?.color:a.p?.color}20`}),setTimeout(()=>{$(`#msg-${a?.id}`).css({"background-color":"unset",border:"1px solid #00000000"})},5e3)})):(o.find(".replyLink").text("➥ Unknown Message"),o.find(".replyLink").css({background:"gray"}))}"dm"===t.m&&(t.sender._id===B.user._id?(o.find(".sentDm").text("To"),o.find(".sentDm").css("color","#ff55ff")):t.recipient._id===B.user._id?(o.find(".receivedDm").text("From"),o.find(".receivedDm").css("color","#ff55ff")):(o.find(".otherDm").text("DM"),o.find(".otherDm").css("color","#ff55ff"),o.find(".dmArrow").text("->"),o.find(".dmArrow").css("color","#ff55ff"))),Y&&o.find(".timestamp").text(new Date(t.t).toLocaleTimeString());let s=parseMarkdown(parseContent(t.a),parseUrl).replace(/@([\da-f]{24})/g,(e,t)=>{let i=B.ppl[t];if(i){let e=parseContent(i.name);return i.id===B.getOwnParticipant().id?(K||(R=!0,document.title=window.i18nextify.i18next.t("You were mentioned!")),`<span class="mention" style="background-color: ${i.color};">${e}</span>`):`@${e}`}return e});o.find(".message").html(s),"dm"===t.m?(q||o.find(".message").css("color",t.sender.color||"white"),U&&(t.sender._id===B.user._id?o.find(".id").text(t.recipient._id.substring(0,6)):o.find(".id").text(t.sender._id.substring(0,6))),t.sender._id===B.user._id?(q||o.find(".name").css("color",t.recipient.color||"white"),o.find(".name").text(t.recipient.name+":"),ee&&(o[0].title=t.recipient._id)):t.recipient._id===B.user._id?(q||o.find(".name").css("color",t.sender.color||"white"),o.find(".name").text(t.sender.name+":"),ee&&(o[0].title=t.sender._id)):(q||o.find(".name").css("color",t.sender.color||"white"),q||o.find(".name2").css("color",t.recipient.color||"white"),o.find(".name").text(t.sender.name),o.find(".name2").text(t.recipient.name+":"),U&&o.find(".id").text(t.sender._id.substring(0,6)),U&&o.find(".id2").text(t.recipient._id.substring(0,6)),ee&&(o[0].title=t.sender._id))):(q||o.find(".message").css("color",t.p.color||"white"),q||o.find(".name").css("color",t.p.color||"white"),o.find(".name").text(t.p.name+":"),q||o.find(".message").css("color",t.p.color||"white"),U&&o.find(".id").text(t.p._id.substring(0,6)),ee&&(o[0].title=t.p._id)),o.find(".id").on("click",e=>{"dm"===t.m?(navigator.clipboard.writeText(t.sender._id===B.user._id?t.recipient._id:t.sender._id),o.find(".id").text("Copied"),setTimeout(()=>{o.find(".id").text((t.sender._id===B.user._id?t.recipient._id:t.sender._id).substring(0,6))},2500)):(navigator.clipboard.writeText(t.p._id),o.find(".id").text("Copied"),setTimeout(()=>{o.find(".id").text(t.p._id.substring(0,6))},2500))}),o.find(".id2").on("click",e=>{navigator.clipboard.writeText(t.recipient._id),o.find(".id2").text("Copied"),setTimeout(()=>{o.find(".id2").text(t.recipient._id.substring(0,6))},2500)}),o.find(".reply").on("click",e=>{if("dm"!==t.m)MPP.chat.startReply(t.p,t.id,t.a),setTimeout(()=>{$(`#msg-${t.id}`).css({border:`1px solid ${"dm"===t?.m?t.sender?.color:t.p?.color}80`,"background-color":`${"dm"===t?.m?t.sender?.color:t.p?.color}20`})},100),setTimeout(()=>{$("#chat-input").focus()},100);else if("dm"===t.m){let e=t.sender._id===B.user._id?t.recipient:t.sender;B.ppl[e._id]?(MPP.chat.startDmReply(e,t.id),setTimeout(()=>{$(`#msg-${t.id}`).css({border:`1px solid ${"dm"===t?.m?t.sender?.color:t.p?.color}80`,"background-color":`${"dm"===t?.m?t.sender?.color:t.p?.color}20`})},100),setTimeout(()=>{$("#chat-input").focus()},100)):new Ke({target:"#piano",title:"User not found.",text:"The user who you are trying to reply to in a DM is not found, so a DM could not be started."})}}),$("#chat ul").append(o),e.push(t);for(var r=$("#chat ul li").get(),l=1;l<=50&&l<=r.length;l++)r[r.length-l].style.opacity=1-.03*l;if(r.length>50&&(r[0].style.display="none"),r.length>256&&(e.shift(),$(r[0]).remove()),$("#chat").hasClass("chatting")){var c=$("#chat ul").get(0);c.scrollTop>c.scrollHeight-c.offsetHeight-50&&Ye.scrollToBottom()}else Ye.scrollToBottom()}}}(),qe=-12,Xe=["a-1","as-1","b-1"],Je="c cs d ds e f fs g gs a as b".split(" "),Qe=0;Qe<7;Qe++)for(var Ze in Je)Xe.push(Je[Ze]+Qe);Xe.push("c7");var et="[]";function tt(){B.sendArray([{m:"devices",list:JSON.parse(et)}])}B.on("connect",tt);var it={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0};!async function(){if(navigator.requestMIDIAccess){let l=await navigator.requestMIDIAccess();function t(e){if(e.target.enabled){var t=15&e.data[0],i=e.data[0]>>4,n=e.data[1],o=e.data[2];if(!de||9!=t)if(8==i||9==i&&0==o)S(Xe[n-9+qe+ye+it[t]]);else if(9==i)void 0!==e.target.volume&&(o*=e.target.volume),C(Xe[n-9+qe+ye+it[t]],o/127);else if(11==i)v||64==n&&(o>20?E():D());else if(14==i){var a=e.data[1]+(e.data[2]<<7)-8192;a=Math.round(a/1e3),it[t]=a}}}function i(e){return{type:e.type,manufacturer:e.manufacturer,name:e.name,version:e.version,enabled:e.enabled,volume:e.volume}}function o(){var e=[];if(l.inputs.size>0)for(var t=l.inputs.values(),n=t.next();n&&!n.done;n=t.next()){var o=n.value;e.push(i(o))}if(l.outputs.size>0)for(var a=l.outputs.values(),s=a.next();s&&!s.done;s=a.next()){var r=s.value;e.push(i(r))}var c=JSON.stringify(e);c!==et&&(et=c,tt())}function a(){if(l.inputs.size>0)for(var i=l.inputs.values(),n=i.next();n&&!n.done;n=i.next()){var a=n.value;a.onmidimessage=t,!1!==a.enabled&&(a.enabled=!0),void 0===a.volume&&(a.volume=1)}if(l.outputs.size>0){for(var s=l.outputs.values(),c=s.next();c&&!c.done;c=s.next()){var d=c.value;void 0===d.volume&&(d.volume=1)}e=function(e,t,i,n){if(J||n!==B.participantId){var o=Xe.indexOf(e);if(-1!=o){o=o+9-qe;for(var a=l.outputs.values(),s=a.next();s&&!s.done;s=a.next())try{var r=s.value;if(r.enabled){var c=t;i??=0,void 0!==r.volume&&(c*=r.volume),r.send([144,o,c],window.performance.now()+i)}}catch(e){console.error(e);continue}}}}}r(!1),o()}var s;function r(e){var t=document.createElement("ul");let i=JSON.parse(localStorage["hm.midiToggles"]??"{}");if(l.inputs.size>0)for(var a=l.inputs.values(),r=a.next();r&&!r.done;r=a.next()){var c=r.value;if((p=document.createElement("li")).connectionId=c.id,p.classList.add("connection"),i[c.name]&&(p.classList.add("enabled"),c.enabled=!0),p.textContent=c.name,p.addEventListener("click",function(e){for(var t=l.inputs.values(),n=t.next();n&&!n.done;n=t.next()){var a=n.value;if(a.id===e.target.connectionId)return a.enabled=!a.enabled,i[a.name]=a.enabled,localStorage["hm.midiToggles"]=JSON.stringify(i),e.target.classList.toggle("enabled"),void o()}}),n){var d=document.createElement("canvas");Object.assign(d,{width:16*window.devicePixelRatio,height:16*window.devicePixelRatio,className:"knob"}),p.appendChild(d),(d=new Knob(d,0,2,.01,c.volume,"volume")).canvas.style.width="16px",d.canvas.style.height="16px",d.canvas.style.float="right",d.on("change",function(e){c.volume=e.value}),d.emit("change",d)}t.appendChild(p)}else t.textContent="(none)";var h=document.createElement("ul");if(l.outputs.size>0)for(var u=l.outputs.values(),m=u.next();m&&!m.done;m=u.next()){var p,f=m.value;if((p=document.createElement("li")).connectionId=f.id,p.classList.add("connection"),i[f.name]&&(p.classList.add("enabled"),f.enabled=!0),p.textContent=f.name,p.addEventListener("click",function(e){for(var t=l.outputs.values(),n=t.next();n&&!n.done;n=t.next()){var a=n.value;if(a.id===e.target.connectionId)return a.enabled=!a.enabled,i[a.name]=a.enabled,localStorage["hm.midiToggles"]=JSON.stringify(i),e.target.classList.toggle("enabled"),void o()}}),n){d=document.createElement("canvas");Object.assign(d,{width:16*window.devicePixelRatio,height:16*window.devicePixelRatio,className:"knob"}),p.appendChild(d),(d=new Knob(d,0,2,.01,f.volume,"volume")).canvas.style.width="16px",d.canvas.style.height="16px",d.canvas.style.float="right",d.on("change",function(e){f.volume=e.value}),d.emit("change",d)}h.appendChild(p)}else h.textContent="(none)";h.setAttribute("translated",""),t.setAttribute("translated","");var g=document.createElement("div"),v=document.createElement("h1");v.textContent="Inputs",g.appendChild(v),g.appendChild(t),(v=document.createElement("h1")).textContent="Outputs",g.appendChild(v),g.appendChild(h),s=new Ke({id:"MIDI-Connections",title:"MIDI Connections",duration:e?"-1":"4500",html:g,target:"#midi-btn"})}l.addEventListener("statechange",function(e){e instanceof MIDIConnectionEvent&&a()}),a(),document.getElementById("midi-btn").addEventListener("click",function(e){document.getElementById("Notification-MIDI-Connections")?s.close():r(!0)})}}(),window.onerror=function(e,t,i){},window.MPP={get press(){return C},set press(e){C=e},get release(){return S},set release(e){S=e},get pressSustain(){return E},set pressSustain(e){E=e},get releaseSustain(){return D},set releaseSustain(e){D=e},addons:{hyperMod:a},piano:f,client:B,chat:Ye,noteQuota:_e,soundSelector:g};var nt=!1,ot=f.audio,at=f.audio.context,st=at.createGain();st.gain.value=.05,st.connect(ot.synthGain);var rt,lt=["sine","square","sawtooth","triangle"],ct=1,dt="square",ht=0,ut=.2,mt=.5,pt=2;function ft(e,t){var i=Xe.indexOf(e);i=i+9-qe;var n=440*Math.pow(2,(i-69)/12);this.osc=at.createOscillator(),this.osc.type=dt,this.osc.frequency.value=n,this.gain=at.createGain(),this.gain.gain.value=0,this.osc.connect(this.gain),this.gain.connect(st),this.osc.start(t),this.gain.gain.setValueAtTime(0,t),this.gain.gain.linearRampToValueAtTime(1,t+ht),this.gain.gain.linearRampToValueAtTime(mt,t+ht+ut)}ft.prototype.stop=function(e){this.gain.gain.linearRampToValueAtTime(0,e+pt),this.osc.stop(e+pt)},document.getElementById("synth-btn").addEventListener("click",function(){rt?rt.close():function(){var e=document.createElement("div");!function(){var t=document.createElement("input");Object.assign(t,{type:"button",value:window.i18nextify.i18next.t("ON/OFF"),className:nt?"switched-on":"switched-off"}),t.addEventListener("click",function(e){if(nt=!nt,t.className=nt?"switched-on":"switched-off",!nt)for(var i in ot.playings)if(ot.playings.hasOwnProperty(i)){var n=ot.playings[i];n&&n.voice&&(n.voice.osc.stop(),n.voice=void 0)}}),e.appendChild(t)}();var t=document.createElement("canvas");Object.assign(t,{width:32*window.devicePixelRatio,height:32*window.devicePixelRatio,className:"knob"}),e.appendChild(t),(t=new Knob(t,0,100,.1,50,"mix","%")).canvas.style.width="32px",t.canvas.style.height="32px",t.on("change",function(e){var t=e.value/100;ot.pianoGain.gain.value=1-t,ot.synthGain.gain.value=t}),t.emit("change",t),function(){dt=lt[ct];var t=document.createElement("input");Object.assign(t,{type:"button",value:window.i18nextify.i18next.t(lt[ct])}),t.addEventListener("click",function(e){++ct>=lt.length&&(ct=0),dt=lt[ct],t.value=window.i18nextify.i18next.t(dt)}),e.appendChild(t)}(),t=document.createElement("canvas"),Object.assign(t,{width:32*window.devicePixelRatio,height:32*window.devicePixelRatio,className:"knob"}),e.appendChild(t),(t=new Knob(t,0,1,.001,ht,"osc1 attack","s")).canvas.style.width="32px",t.canvas.style.height="32px",t.on("change",function(e){ht=e.value}),t.emit("change",t),t=document.createElement("canvas"),Object.assign(t,{width:32*window.devicePixelRatio,height:32*window.devicePixelRatio,className:"knob"}),e.appendChild(t),(t=new Knob(t,0,2,.001,ut,"osc1 decay","s")).canvas.style.width="32px",t.canvas.style.height="32px",t.on("change",function(e){ut=e.value}),t.emit("change",t),t=document.createElement("canvas"),Object.assign(t,{width:32*window.devicePixelRatio,height:32*window.devicePixelRatio,className:"knob"}),e.appendChild(t),(t=new Knob(t,0,1,.001,mt,"osc1 sustain","x")).canvas.style.width="32px",t.canvas.style.height="32px",t.on("change",function(e){mt=e.value}),t.emit("change",t),t=document.createElement("canvas"),Object.assign(t,{width:32*window.devicePixelRatio,height:32*window.devicePixelRatio,className:"knob"}),e.appendChild(t),(t=new Knob(t,0,2,.001,pt,"osc1 release","s")).canvas.style.width="32px",t.canvas.style.height="32px",t.on("change",function(e){pt=e.value}),t.emit("change",t),(rt=new Ke({title:"Synthesize",html:e,duration:-1,target:"#synth-btn"})).on("close",function(){var e=document.getElementById("tooltip");e&&e.parentNode.removeChild(e),rt=null})}()}),function(){if("multiplayerpiano.com"===window.location.hostname){var e;(t=document.getElementById("client-settings-btn")).addEventListener("click",function(){var t,i;e?e.close():(t=document.createElement("div"),(i=document.createElement("div")).classList="setting",i.innerText="Show user IDs in chat",U&&i.classList.toggle("enabled"),i.onclick=function(){i.classList.toggle("enabled"),localStorage.showIdsInChat=i.classList.contains("enabled"),U=i.classList.contains("enabled")},t.appendChild(i),function(){var e=document.createElement("div");e.classList="setting",e.innerText="Timestamps in chat",Y&&e.classList.toggle("enabled"),e.onclick=function(){e.classList.toggle("enabled"),localStorage.showTimestampsInChat=e.classList.contains("enabled"),Y=e.classList.contains("enabled")},t.appendChild(e)}(),function(){var e=document.createElement("div");e.classList="setting",e.innerText="No chat colors",q&&e.classList.toggle("enabled"),e.onclick=function(){e.classList.toggle("enabled"),localStorage.noChatColors=e.classList.contains("enabled"),q=e.classList.contains("enabled")},t.appendChild(e)}(),function(){var e=document.createElement("div");e.classList="setting",e.innerText="Force dark background",X&&e.classList.toggle("enabled"),e.onclick=function(){e.classList.toggle("enabled"),localStorage.noBackgroundColor=e.classList.contains("enabled"),X=e.classList.contains("enabled"),B.channel.settings.color&&!X?setBackgroundColor(B.channel.settings.color,B.channel.settings.color2):setBackgroundColorToDefault()},t.appendChild(e)}(),function(){var e=document.createElement("div");e.classList="setting",e.innerText="Output own notes to MIDI",J&&e.classList.toggle("enabled"),e.onclick=function(){e.classList.toggle("enabled"),localStorage.outputOwnNotes=e.classList.contains("enabled"),J=e.classList.contains("enabled")},t.appendChild(e)}(),function(){var e=document.createElement("div");e.classList="setting",e.innerText="Virtual Piano layout",Q&&e.classList.toggle("enabled"),e.onclick=function(){e.classList.toggle("enabled"),localStorage.virtualPianoLayout=e.classList.contains("enabled"),Q=e.classList.contains("enabled"),ve=Q?ge.VP:ge.MPP},t.appendChild(e)}(),function(){var e=document.createElement("div");e.classList="setting",e.innerText="Show _id tooltips",ee&&e.classList.toggle("enabled"),e.onclick=function(){e.classList.toggle("enabled"),localStorage.showChatTooltips=e.classList.contains("enabled"),ee=e.classList.contains("enabled")},t.appendChild(e)}(),function(){var e=document.createElement("div");e.classList="setting",e.innerText="Show Piano Notes",te&&e.classList.toggle("enabled"),e.onclick=function(){e.classList.toggle("enabled"),localStorage.showPianoNotes=e.classList.contains("enabled"),te=e.classList.contains("enabled")},t.appendChild(e)}(),function(){var e=document.createElement("div");e.classList="setting",e.innerText="Enable smooth cursors",Z&&e.classList.toggle("enabled");let i=Object.values(B.ppl);e.onclick=function(){e.classList.toggle("enabled"),localStorage.smoothCursor=e.classList.contains("enabled"),(Z=e.classList.contains("enabled"))?$("#cursors").attr("smooth-cursors",""):$("#cursors").removeAttr("smooth-cursors"),Z?i.forEach(function(e){e.cursorDiv&&(e.cursorDiv.style.left="",e.cursorDiv.style.top="",e.cursorDiv.style.transform="translate3d("+e.x+"vw, "+e.y+"vh, 0)")}):i.forEach(function(e){e.cursorDiv&&(e.cursorDiv.style.left=e.x+"%",e.cursorDiv.style.top=e.y+"%",e.cursorDiv.style.transform="")})},t.appendChild(e)}(),function(){var e=document.createElement("select");e.classList="setting",e.style="color: inherit; width: calc(100% - 2px);",e.setAttribute("translated","");let i=Object.keys(r),n=document.createElement("option");n.value=n.innerText="No highlighted notes",n.selected=!ie,e.appendChild(n);for(let t of i){let i=document.createElement("option");i.value=t,i.innerText=t,i.selected=t===ie,e.appendChild(i)}ie&&(e.value=ie),e.onchange=function(){localStorage.highlightScaleNotes=e.value,ie=e.value},t.appendChild(e)}(),function(){var e=document.createElement("div");e.classList="setting",e.innerText="Hide all cursors",oe&&e.classList.toggle("enabled"),e.onclick=function(){e.classList.toggle("enabled"),localStorage.hideAllCursors=e.classList.contains("enabled"),(oe=e.classList.contains("enabled"))?$("#cursors").hide():$("#cursors").show()},t.appendChild(e)}(),(e=new Ke({title:"Client Settings",html:t,duration:-1,target:"#client-settings-btn"})).on("close",function(){var t=document.getElementById("tooltip");t&&t.parentNode.removeChild(t),e=null}))})}else{var t=document.getElementById("client-settings-btn"),i=document.getElementById("client-settings-content"),n=document.getElementsByClassName("client-settings-tablink"),o=document.getElementById("client-settings-ok-btn");function a(e,t,i,n,o,a){let s=document.createElement("input");s.type="checkbox",s.id=e,s.checked=i,s.onclick=a;let r=document.createElement("label");r.innerText=window.i18nextify.i18next.t(t+":")+" ",r.appendChild(s),o.appendChild(r),n&&o.appendChild(document.createElement("br"))}t.addEventListener("click",e=>{e.stopPropagation(),Fe("#client-settings")}),o.addEventListener("click",e=>{e.stopPropagation(),je()}),window.changeClientSettingsTab=(e,t)=>{i.innerHTML="";for(let e=0;e<n.length;e++)n[e].className=n[e].className.replace(" active","");switch(e.currentTarget.className+=" active",t.toLowerCase()){case"chat":var o=document.createElement("div");a("show-timestamps-in-chat","Show timestamps in chat",Y,!0,o,()=>{Y=!Y,localStorage.showTimestampsInChat=Y}),a("show-user-ids-in-chat","Show user IDs in chat",U,!0,o,()=>{U=!U,localStorage.showIdsInChat=U}),a("show-id-tooltips","Show ID tooltips",ee,!0,o,()=>{ee=!ee,localStorage.showChatTooltips=ee}),a("no-chat-colors","No chat colors",q,!0,o,()=>{q=!q,localStorage.noChatColors=q}),a("hide-chat","Hide chat",se,!1,o,()=>{se=!se,localStorage.hideChat=se,se?$("#chat").hide():$("#chat").show()}),i.appendChild(o);break;case"midi":o=document.createElement("div");a("output-own-notes-to-midi","Output own notes to MIDI",J,!0,o,()=>{J=!J,localStorage.outputOwnNotes=J}),a("disable-midi-drum-channel","Disable MIDI Drum Channel (channel 10)",de,!0,o,()=>{de=!de,localStorage.disableMIDIDrumChannel=de}),i.appendChild(o);break;case"piano":o=document.createElement("div");a("virtual-piano-layout","Virtual Piano layout",Q,!0,o,()=>{Q=!Q,localStorage.virtualPianoLayout=Q,ve=Q?ge.VP:ge.MPP}),a("show-piano-notes","Show piano notes",te,!0,o,()=>{te=!te,localStorage.showPianoNotes=te}),a("hide-piano","Hide piano",ae,!0,o,()=>{ae=!ae,localStorage.hidePiano=ae,ae?$("#piano").hide():$("#piano").show()});var s=document.createElement("select");s.classList="setting",s.style="width: calc(58.7% - 2px);",s.onchange=()=>{localStorage.highlightScaleNotes=s.value,ie=s.value};let e=Object.keys(r),t=document.createElement("option");t.value=t.innerText="None",t.selected=!ie,s.appendChild(t);for(let t of e){let e=document.createElement("option");e.value=t,e.innerText=t,e.selected=t===ie,s.appendChild(e)}ie&&(s.value=ie);var l=document.createElement("label");l.setAttribute("for",s.id),l.innerText="Highlighted notes: ",o.appendChild(l),o.appendChild(s),i.appendChild(o);break;case"misc":o=document.createElement("div");a("dont-use-prevent-default","Don't use prevent default",q,!0,o,()=>{re=!re,localStorage.noPreventDefault=re}),a("force-dark-background","Force dark background",X,!0,o,()=>{X=!X,localStorage.noBackgroundColor=X,B.channel.settings.color&&!X?setBackgroundColor(B.channel.settings.color,B.channel.settings.color2):setBackgroundColorToDefault()});let n=Object.values(B.ppl);a("enable-smooth-cursors","Enable smooth cursors",Z,!0,o,()=>{Z=!Z,localStorage.smoothCursor=Z,Z?($("#cursors").attr("smooth-cursors",""),n.forEach(function(e){e.cursorDiv&&(e.cursorDiv.style.left="",e.cursorDiv.style.top="",e.cursorDiv.style.transform="translate3d("+e.x+"vw, "+e.y+"vh, 0)")})):($("#cursors").removeAttr("smooth-cursors"),n.forEach(function(e){e.cursorDiv&&(e.cursorDiv.style.left=e.x+"%",e.cursorDiv.style.top=e.y+"%",e.cursorDiv.style.transform="")}))}),a("hide-all-cursors","Hide all cursors",oe,!0,o,()=>{oe=!oe,localStorage.hideAllCursors=oe,oe?$("#cursors").hide():$("#cursors").show()}),a("hide-bot-users","Hide all bots",le,!0,o,()=>{le=!le,localStorage.hideBotUsers=le}),11===(new Date).getMonth()&&a("snowflakes","Enable snowflakes",ce,!0,o,()=>{ce=!ce,localStorage.snowflakes=ce,he()}),i.appendChild(o)}},changeClientSettingsTab({currentTarget:document.getElementsByClassName("client-settings-tablink")[0]},"Chat")}}();var gt;!function(){gt=r;var e=["DodgerBlue","OliveDrab","Gold","Pink","SlateBlue","LightBlue","Violet","PaleGreen","SteelBlue","SandyBrown","Chocolate","Crimson"],t=!1,i=null,n=[],o=0;function a(t,i,n){return t.color=e[Math.random()*e.length|0],t.x=Math.random()*i,t.y=Math.random()*n-n,t.diameter=10*Math.random()+5,t.tilt=10*Math.random()-10,t.tiltAngleIncrement=.07*Math.random()+.05,t.tiltAngle=0,t}function s(){var e=window.innerWidth,s=window.innerHeight;window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout(e,16.6666667)};var r=document.getElementById("confetti-canvas");null===r&&((r=document.createElement("canvas")).setAttribute("id","confetti-canvas"),r.setAttribute("style","display:block;z-index:999999;pointer-events:none;position:absolute;top:0;left:0"),document.body.appendChild(r),r.width=e,r.height=s,window.addEventListener("resize",function(){r.width=window.innerWidth,r.height=window.innerHeight},!0));for(var l=r.getContext("2d");n.length<500;)n.push(a({},e,s));t=!0,null===i&&function e(){l.clearRect(0,0,window.innerWidth,window.innerHeight),0===n.length?i=null:(!function(){var e,i=window.innerWidth,s=window.innerHeight;o+=.01;for(var r=0;r<n.length;r++)e=n[r],!t&&e.y<-15?e.y=s+100:(e.tiltAngle+=e.tiltAngleIncrement,e.x+=Math.sin(o),e.y+=.5*(Math.cos(o)+e.diameter+2),e.tilt=15*Math.sin(e.tiltAngle)),(e.x>i+20||e.x<-20||e.y>s)&&(t&&n.length<=500?a(e,i,s):(n.splice(r,1),r--))}(),function(e){for(var t,i,o=0;o<n.length;o++)t=n[o],e.beginPath(),e.lineWidth=t.diameter,e.strokeStyle=t.color,e.shadowColor="rgba(0, 0, 0, .3)",e.shadowBlur=4,e.shadowOffsetY=2,e.shadowOffsetX=0,i=t.x+t.tilt,e.moveTo(i+t.diameter/2,t.y),e.lineTo(i,t.y+t.tilt+t.diameter/2),e.stroke()}(l),i=requestAnimFrame(e))}()}function r(){t=!1}}(),window!==top&&alert("Hey, it looks like you're visiting our site through another website. Consider playing Multiplayer Piano directly at https://multiplayerpiano.net"),(async()=>{let e=document.getElementById("languages");[{code:"bg",name:"Bulgarian",native:"Български"},{code:"cs",name:"Czech",native:"Česky"},{code:"de",name:"German",native:"Deutsch"},{code:"en",name:"English",native:"English"},{code:"es",name:"Spanish",native:"Español"},{code:"fr",name:"French",native:"Français"},{code:"hu",name:"Hungarian",native:"Magyar"},{code:"is",name:"Icelandic",native:"Íslenska"},{code:"ja",name:"Japanese",native:"日本語"},{code:"ko",name:"Korean",native:"한국어"},{code:"lv",name:"Latvian",native:"Latviešu"},{code:"nb",name:"Norwegian Bokmål",native:"Norsk bokmål"},{code:"nl",name:"Dutch",native:"Nederlands"},{code:"pl",name:"Polish",native:"Polski"},{code:"pt",name:"Portuguese",native:"Português"},{code:"ru",name:"Russian",native:"Русский"},{code:"sk",name:"Slovak",native:"Slovenčina"},{code:"sv",name:"Swedish",native:"Svenska"},{code:"tr",name:"Turkish",native:"Türkçe"},{code:"zh",name:"Chinese",native:"中文"}].forEach(t=>{let i=document.createElement("option");i.value=t.code,i.innerText=t.native,t.code==i18nextify.i18next.language.split("-")[0]&&(i.selected=!0),i.setAttribute("translated",""),e.appendChild(i)}),document.getElementById("lang-btn").addEventListener("click",()=>{Fe("#language")}),document.querySelector("#language > button").addEventListener("click",async e=>{await i18nextify.i18next.changeLanguage(document.querySelector("#languages").selectedOptions[0].value),i18nextify.forceRerender(),je()})})(),B.start(),Object.assign(globalThis,{Renderer:d,CanvasRenderer:h,Piano:p,PianoKey:m,Rect:s,AudioEngine:l,AudioEngineWeb:c,SoundSelector:u,SiteNotification:Ke})});