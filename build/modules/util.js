const GeneratorFunction=Object.getPrototypeOf(function*(){}).constructor,AsyncFunction=Object.getPrototypeOf(async function(){}).constructor,AsyncGeneratorFunction=Object.getPrototypeOf(async function*(){}).constructor;var parseContent=t=>t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),markdownRegex=/((?:\\|)(?:\|\|.+?\|\||```.+?```|``.+?``|`.+?`|\*\*\*.+?\*\*\*|\*\*.+?\*\*|\*.+?\*|___.+?___|__.+?__|_.+?_(?:\s|$)|~~.+?~~))/g,getTextContent=t=>t.indexOf(">")>-1&&t.indexOf("</")>-1&&t.slice(t.indexOf(">")+1,t.lastIndexOf("</"))||t,getLinkTextContent=t=>{var e=t.indexOf(">"),s=t.lastIndexOf("</"),n=e>s?-1:e;return(n>-1||s>-1)&&t.slice(n>-1?n+1:0,s>-1?s:t.length)||t},parseUrl=t=>t.replace(url_regex,t=>{var e=getLinkTextContent(t);return`<a rel="noreferer noopener" target="_blank" class="chatLink" href="${e}">${e}</a>`}),parseMarkdown=(t,e=t=>t)=>t.split(markdownRegex).map(t=>{var s=t.endsWith("~~"),n=t.endsWith("___"),i=t.endsWith("__"),a=t.endsWith("_"),r=t.endsWith("***"),h=t.endsWith("**"),o=t.endsWith("*"),l=t.endsWith("```"),d=t.endsWith("``"),c=t.endsWith("`"),u=t.endsWith("||");if(t.startsWith("\\~~")&&s||t.startsWith("\\___")&&n||t.startsWith("\\__")&&i||t.startsWith("\\_")&&a||t.startsWith("\\***")&&r||t.startsWith("\\**")&&h||t.startsWith("\\*")&&o||t.startsWith("\\```")&&l||t.startsWith("\\``")&&d||t.startsWith("\\`")&&c||t.startsWith("\\||")&&u)return e(t.slice(1));if(t.startsWith("~~")&&s)return(m=parseMarkdown(getTextContent(t.slice(2,t.length-2)),e)).trim().length<1?t:`<del class="markdown">${m}</del>`;if(t.startsWith("___")&&n)return(m=parseMarkdown(getTextContent(t.slice(3,t.length-3)),e)).trim().length<1?t:`<em class="markdown"><u class="markdown">${m}</u></em>`;if(t.startsWith("__")&&i)return(m=parseMarkdown(getTextContent(t.slice(2,t.length-2)),e)).trim().length<1?t:`<u class="markdown">${m}</u>`;if(t.startsWith("***")&&r)return(m=parseMarkdown(getTextContent(t.slice(3,t.length-3)),e)).trim().length<1?t:`<em class="markdown"><strong class="markdown">${m}</strong></em>`;if(t.startsWith("**")&&h)return(m=parseMarkdown(getTextContent(t.slice(2,t.length-2)),e)).trim().length<1?t:`<strong class="markdown">${m}</strong>`;if(t.startsWith("*")&&o||t.startsWith("_")&&a)return(m=parseMarkdown(getTextContent(t.slice(1,t.length-1)),e)).trim().length<1?t:`<em class="markdown">${m}</em>`;if(t.startsWith("`")&&c){var m,g=t.startsWith("```")&&l?3:t.startsWith("``")&&d?2:1;return(m=getTextContent(t.slice(g,t.length-g))).trim().length<1?t:`<code class="markdown">${m}</code>`}return t.startsWith("||")&&u?(m=parseMarkdown(getTextContent(t.slice(2,t.length-2)),e)).trim().length<1?t:`<span class="markdown spoiler">${m}</span>`:e(t)}).join("");function hashFnv32a(t,e,s){var n,i,a=void 0===s?2166136261:s;for(n=0,i=t.length;n<i;n++)a^=t.charCodeAt(n),a+=(a<<1)+(a<<4)+(a<<7)+(a<<8)+(a<<24);return e?("0000000"+(a>>>0).toString(16)).substr(-8):a>>>0}function round(t,e,s){return Math.round((t-s)/e)*e+s}class EventEmitter{constructor(){this._events={}}on(t,e){this._events.hasOwnProperty(t)||(this._events[t]=[]),this._events[t].push(e)}off(t,e){if(this._events.hasOwnProperty(t)){var s=this._events[t].indexOf(e);s<0||this._events[t].splice(s,1)}}emit(t){if(this._events.hasOwnProperty(t)){var e=this._events[t].slice(0);if(!(e.length<1))for(var s=Array.prototype.slice.call(arguments,1),n=0;n<e.length;n++)e[n].apply(this,s)}}}class Knob extends EventEmitter{constructor(t,e,s,n,i,a,r){super(),this.min=e||0,this.max=s||10,this.step=n||.01,this.value=i||this.min,this.knobValue=(this.value-this.min)/(this.max-this.min),this.name=a||"",this.unit=r||"";var h=n.toString().indexOf(".");-1==h&&(h=n.toString().length-1),this.fixedPoint=n.toString().substr(h).length-1,this.dragY=0,this.mouse_over=!1,this.canvas=t,this.ctx=t.getContext("2d"),this.radius=.3333*this.canvas.width,this.baseImage=document.createElement("canvas"),this.baseImage.width=t.width,this.baseImage.height=t.height;var o=this.baseImage.getContext("2d");o.fillStyle="#444",o.shadowColor="rgba(0, 0, 0, 0.5)",o.shadowBlur=5,o.shadowOffsetX=.02*this.canvas.width,o.shadowOffsetY=.02*this.canvas.width,o.beginPath(),o.arc(this.canvas.width/2,this.canvas.height/2,this.radius,0,2*Math.PI),o.fill();var l=!1;(()=>{let e=t=>{if(t.screenY!==this.dragY){var e=-(t.screenY-this.dragY),s=.0075;t.ctrlKey&&(s*=.05),this.setKnobValue(this.knobValue+e*s),this.dragY=t.screenY,this.redraw()}t.preventDefault(),d()},s=t=>{null===t.toElement&&null===t.relatedTarget&&n()},n=()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseout",s),document.removeEventListener("mouseup",n),this.emit("release",this),l=!1,this.mouse_over||c()};t.addEventListener("mousedown",t=>{var i=this.translateMouseEvent(t);this.contains(i.x,i.y)&&(l=!0,this.dragY=t.screenY,d(),document.addEventListener("mousemove",e),document.addEventListener("mouseout",s),document.addEventListener("mouseup",n))}),t.addEventListener("keydown",t=>{38==t.keyCode?(this.setValue(this.value+this.step),d()):40==t.keyCode&&(this.setValue(this.value-this.step),d())})})();let d=()=>{var t=document.getElementById("tooltip");if(!t){t=document.createElement("div"),document.body.appendChild(t),t.id="tooltip";var e=this.canvas.getBoundingClientRect();t.style.left=e.left+"px",t.style.top=e.bottom+"px"}t.textContent=this.name,this.name&&(t.textContent+=": "),t.textContent+=this.valueString()+this.unit},c=()=>{var t=document.getElementById("tooltip");t&&t.parentElement.removeChild(t)};this.canvas.addEventListener("mousemove",t=>{var e=this.translateMouseEvent(t);this.contains(e.x,e.y)?(this.mouse_over=!0,d()):(this.mouse_over=!1,l||c())}),this.canvas.addEventListener("mouseout",t=>{this.mouse_over=!1,l||c()}),this.redraw()}redraw(){var t=.28*this.canvas.width,e=.03*this.canvas.width;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.baseImage,0,0);var s=this.knobValue;s*=2*Math.PI*.8,s+=Math.PI/2,s+=2*Math.PI*.1;var n=this.canvas.width/2,i=Math.cos(s)*t+n,a=Math.sin(s)*t+n;this.ctx.fillStyle="#fff",this.ctx.beginPath(),this.ctx.arc(i,a,e,0,2*Math.PI),this.ctx.fill()}setKnobValue(t){t<0?t=0:t>1&&(t=1),this.knobValue=t,this.setValue(t*(this.max-this.min)+this.min)}setValue(t){(t=round(t,this.step,this.min))<this.min?t=this.min:t>this.max&&(t=this.max),this.value!==t&&(this.value=t,this.knobValue=(t-this.min)/(this.max-this.min),this.redraw(),this.emit("change",this))}valueString(){return this.value.toFixed(this.fixedPoint)}contains(t,e){return t-=this.canvas.width/2,e-=this.canvas.height/2,Math.sqrt(Math.pow(t,2)+Math.pow(e,2))<this.radius}translateMouseEvent(t){var e=t.target;return{x:t.clientX-e.getBoundingClientRect().left-e.clientLeft+e.scrollLeft,y:t.clientY-(e.getBoundingClientRect().top-e.clientTop+e.scrollTop)}}}var url_regex=new RegExp("(?:(?:(?:https?|ftp):)?\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z0-9\\u00a1-\\uffff][a-z0-9\\u00a1-\\uffff_-]{0,62})?[a-z0-9\\u00a1-\\uffff]\\.)+(?:[a-z\\u00a1-\\uffff]{2,}\\.?))(?::\\d{2,5})?(?:[/?#]\\S*)?","ig");Object.assign(globalThis,{EventEmitter:EventEmitter,Knob:Knob,GeneratorFunction:GeneratorFunction,AsyncFunction:AsyncFunction,AsyncGeneratorFunction:AsyncGeneratorFunction,parseMarkdown:parseMarkdown,parseContent:parseContent,parseUrl:parseUrl});